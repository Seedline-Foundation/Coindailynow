# ๐๏ธ JOY TOKEN (JY) RATE SYSTEM ARCHITECTURE

## ๐ System Overview Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        SUPER ADMIN DASHBOARD                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Current JY Rate: $1.50 USD                                       โ โ
โ  โ  [Update Rate] [View History] [Manage Settings]                   โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ GraphQL Mutation
                               โ updateJoyTokenRate()
                               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         GRAPHQL API LAYER                               โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  Queries:                    โ  Mutations:                         โ โ
โ  โ  โข joyTokenRate              โ  โข updateJoyTokenRate               โ โ
โ  โ  โข platformSettings          โ  โข updateCEPointsRate               โ โ
โ  โ  โข joyTokenRateHistory       โ  โข updatePlatformConfig             โ โ
โ  โ  โข convertCurrency           โ                                     โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                               โ
                               โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   PLATFORM SETTINGS SERVICE                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ  PlatformSettingsService.ts                                       โ โ
โ  โ  โโ getJoyTokenRate() โโโโโโโโโโโโโโบ [PUBLIC]                     โ โ
โ  โ  โโ updateJoyTokenRate() โโโโโโโโโโโบ [SUPER ADMIN ONLY]           โ โ
โ  โ  โโ getJoyTokenRateHistory() โโโโโโโบ [SUPER ADMIN]                โ โ
โ  โ  โโ updateCEPointsRate() โโโโโโโโโโโบ [SUPER ADMIN ONLY]           โ โ
โ  โ  โโ convertCurrency() โโโโโโโโโโโโโโบ [PUBLIC]                     โ โ
โ  โ  โโ convertCEPointsToJY() โโโโโโโโโโบ [PUBLIC]                     โ โ
โ  โ  โโ getPlatformSettings() โโโโโโโโโโบ [SUPER ADMIN]                โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
                   โ                                โ
                   โผ                                โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     PERMISSION SERVICE              โ  โ    WALLET SERVICE            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ isSuperAdmin() โโโโโบ Verify   โ โ  โ  โ Uses current JY rate   โ โ
โ  โ                      super     โ โ  โ  โ for all conversions    โ โ
โ  โ                      admin     โ โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                      role      โ โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           DATABASE (Prisma)                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  PlatformSettings (Singleton)                                   โ   โ
โ  โ  โโ id: "platform-001"                                          โ   โ
โ  โ  โโ joyTokenUsdRate: 1.50          โโโโโ CONFIGURABLE           โ   โ
โ  โ  โโ joyTokenSymbol: "JY"                                        โ   โ
โ  โ  โโ lastRateUpdate: 2025-10-21                                  โ   โ
โ  โ  โโ rateUpdatedBy: "admin-123"                                  โ   โ
โ  โ  โโ rateUpdateReason: "Platform growth"                         โ   โ
โ  โ  โโ previousRate: 1.00                                          โ   โ
โ  โ  โโ cePointsToJyRate: 100          โโโโโ CONFIGURABLE           โ   โ
โ  โ  โโ defaultCurrency: "JY"                                       โ   โ
โ  โ  โโ supportedCurrencies: "JY,USD,EUR,KES,NGN"                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  CurrencyRateHistory (Audit Log)                                โ   โ
โ  โ  โโ id: "history-003"                                           โ   โ
โ  โ  โโ currency: "JY"                                              โ   โ
โ  โ  โโ usdRate: 1.50                                               โ   โ
โ  โ  โโ previousRate: 1.25                                          โ   โ
โ  โ  โโ changePercentage: +20.0                                     โ   โ
โ  โ  โโ updatedBy: "admin-123"                                      โ   โ
โ  โ  โโ updateReason: "100K users milestone"                        โ   โ
โ  โ  โโ notes: "Rewarding early adopters"                           โ   โ
โ  โ  โโ effectiveFrom: 2025-10-21T10:00:00Z                         โ   โ
โ  โ  โโ effectiveTo: null (current rate)                            โ   โ
โ  โ                                                                  โ   โ
โ  โ  โโ id: "history-002"                                           โ   โ
โ  โ  โโ usdRate: 1.25                                               โ   โ
โ  โ  โโ effectiveTo: 2025-10-21T10:00:00Z (replaced)                โ   โ
โ  โ  โโ ...                                                          โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Rate Update Flow

```
โโโโโโโโโโโโโโโโ
โ Super Admin  โ
โ   Updates    โ
โ   JY Rate    โ
โโโโโโโโฌโโโโโโโโ
       โ
       โ 1. Submit new rate + reason
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  GraphQL Mutation            โ
โ  updateJoyTokenRate(1.50)    โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 2. Authenticate & authorize
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PlatformSettingsService     โ
โ  โข Verify super admin        โ
โ  โข Validate rate (0 < r < 1M)โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 3. Get current settings
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Database: PlatformSettings  โ
โ  Current rate: 1.00          โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 4. Calculate changes
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Change Calculation          โ
โ  โข Old rate: $1.00           โ
โ  โข New rate: $1.50           โ
โ  โข Change: +50%              โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ                         โ                        โ
       โ 5a. Update settings     โ 5b. Create history     โ
       โผ                         โผ                        โ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโโโโโ         โ
โ PlatformSettings โ    โ CurrencyRateHistory  โ         โ
โ โข rate = 1.50    โ    โ โข new record         โ         โ
โ โข prev = 1.00    โ    โ โข usdRate = 1.50     โ         โ
โ โข updatedBy      โ    โ โข previousRate = 1.00โ         โ
โ โข updateReason   โ    โ โข change% = +50      โ         โ
โโโโโโโโโโโโโโโโโโโโ    โ โข effectiveFrom: now โ         โ
                        โ โข reason & notes     โ         โ
                        โโโโโโโโโโโโโโโโโโโโโโโโ         โ
                                   โ                     โ
                                   โ 5c. Expire old      โ
                                   โผ                     โ
                        โโโโโโโโโโโโโโโโโโโโโโโโ         โ
                        โ Old History Records  โ         โ
                        โ โข effectiveTo = now  โโโโโโโโโโโ
                        โโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ 6. Return result
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Response to Super Admin     โ
โ  โ Rate updated!             โ
โ  Old: $1.00 โ New: $1.50     โ
โ  Change: +50%                โ
โ  All future conversions      โ
โ  will use new rate           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฐ Currency Conversion Flow

```
USER DEPOSITS $100 USD
โโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโ
โ User         โ
โ Deposits     โ
โ $100 USD     โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Payment Gateway (Stripe)    โ
โ  Charges: $100 USD           โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Request JY conversion
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PlatformSettingsService     โ
โ  getJoyTokenRate()           โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Returns current rate
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Current Rate: $1.50/JY      โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Calculate JY amount
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Conversion                  โ
โ  $100 รท $1.50 = 66.67 JY     โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Credit wallet
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  User Wallet                 โ
โ  + 66.67 JY                  โ
โ  ($100 USD value)            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


USER WITHDRAWS 100 JY
โโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโ
โ User         โ
โ Withdraws    โ
โ 100 JY       โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  WalletService               โ
โ  Check balance (100 JY)      โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Request USD conversion
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PlatformSettingsService     โ
โ  getJoyTokenRate()           โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Returns current rate
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Current Rate: $1.50/JY      โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Calculate USD amount
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Conversion                  โ
โ  100 JY ร $1.50 = $150 USD   โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โ Send to bank
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Payment Gateway             โ
โ  Transfer: $150 USD          โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโ
โ User's Bank  โ
โ + $150 USD   โ
โโโโโโโโโโโโโโโโ
```

---

## ๐ญ Rate Impact Visualization

```
SCENARIO: Rate increases from $1.00 to $1.50
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

USER A - Has 1000 JY in wallet
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Before Rate Change                      โ
โ Balance: 1000 JY                        โ
โ USD Value: $1,000                       โ
โ Rate: $1.00/JY                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
                   โ Super admin updates rate
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ After Rate Change                       โ
โ Balance: 1000 JY  โโโ SAME              โ
โ USD Value: $1,500 โโโ +50% VALUE! ๐    โ
โ Rate: $1.50/JY                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


USER B - Wants to deposit $100 USD
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Before Rate Change                      โ
โ Deposits: $100 USD                      โ
โ Receives: 100 JY                        โ
โ Rate: $1.00/JY                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
                   โ Rate change occurs
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ After Rate Change                       โ
โ Deposits: $100 USD                      โ
โ Receives: 66.67 JY โโโ LESS JY          โ
โ Rate: $1.50/JY                          โ
โ (Because JY is more valuable now)       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


USER C - Wants to withdraw 100 JY
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Before Rate Change                      โ
โ Withdraws: 100 JY                       โ
โ Receives: $100 USD                      โ
โ Rate: $1.00/JY                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
                   โ Rate change occurs
                   โ
                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ After Rate Change                       โ
โ Withdraws: 100 JY                       โ
โ Receives: $150 USD โโโ MORE USD! ๐     โ
โ Rate: $1.50/JY                          โ
โ (Because JY is more valuable now)       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Security & Authorization Flow

```
โโโโโโโโโโโโโโโโ
โ User Request โ
โโโโโโโโฌโโโโโโโโ
       โ
       โ Who is making the request?
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Authentication Check       โ
โ  (JWT Token verification)   โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โโโโโ Not authenticated โโโโโโโโบ โ 401 Unauthorized
       โ
       โ Authenticated
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  What operation?            โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
       โ
       โโโโโ Read Operations (joyTokenRate, convertCurrency)
       โ     โโโโบ โ Allowed for everyone
       โ
       โโโโโ Admin Operations (platformSettings, history)
       โ     โ
       โ     โผ
       โ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ     โ  PermissionService          โ
       โ     โ  isSuperAdmin(userId)?      โ
       โ     โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
       โ            โ
       โ            โโโโโ Yes โโโบ โ Allowed
       โ            โ
       โ            โโโโโ No โโโโบ โ 403 Forbidden
       โ
       โโโโโ Update Operations (updateJoyTokenRate)
             โ
             โผ
             โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ  PermissionService          โ
             โ  isSuperAdmin(userId)?      โ
             โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โโโโโ Yes โโโบ Validate input
                    โ             โ
                    โ             โผ
                    โ             โโโโโโโโโโโโโโโโโโโโโโโ
                    โ             โ Rate Validation     โ
                    โ             โ 0 < rate < 1,000,000โ
                    โ             โโโโโโโโฌโโโโโโโโโโโโโโโ
                    โ                    โ
                    โ                    โโโโ Valid โโโบ โ Update
                    โ                    โ
                    โ                    โโโโ Invalid โโบ โ 400 Bad Request
                    โ
                    โโโโโ No โโโโบ โ 403 Forbidden
```

---

## ๐ Data Flow Summary

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    DATA FLOW OVERVIEW                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PUBLIC ENDPOINTS (No auth required)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
joyTokenRate โโโโโโโโโโโบ Get current JY/USD rate
convertCurrency โโโโโโโโบ Convert between currencies
convertCEPointsToJY โโโโบ Convert CE Points to JY


AUTHENTICATED ENDPOINTS (User must be logged in)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
(None - all read operations are public)


SUPER ADMIN ENDPOINTS (Super admin role required)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
platformSettings โโโโโโโโโโโบ View all platform settings
joyTokenRateHistory โโโโโโโโบ View rate change history
updateJoyTokenRate โโโโโโโโโบ Change JY/USD rate
updateCEPointsRate โโโโโโโโโบ Change CE conversion rate
updatePlatformConfig โโโโโโโบ Update platform settings


AUTO-TRIGGERED EVENTS
โโโโโโโโโโโโโโโโโโโโโโ
Rate Update โโโโบ Creates history record
Rate Update โโโโบ Expires old history records
Rate Update โโโโบ Logs admin, reason, timestamp
Rate Update โโโโบ Calculates percentage change
```

---

## ๐ฏ Integration Points

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              SYSTEM INTEGRATION POINTS                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

FINANCE SERVICE
โโโโโโโโโโโโโโโ
โข Deposit operations use current rate for USDโJY conversion
โข Withdrawal operations use current rate for JYโUSD conversion
โข Payment processing shows USD equivalent
โข Transaction records include rate used

WALLET SERVICE
โโโโโโโโโโโโโโ
โข Balance displays show JY with USD equivalent
โข Transaction history includes USD values
โข Wallet creation defaults to JY currency

REWARDS SERVICE
โโโโโโโโโโโโโโโ
โข CE Points conversion uses configured rate
โข Reward calculations consider JY value

PAYMENT GATEWAYS
โโโโโโโโโโโโโโโโ
โข Stripe: Charges USD, credits JY
โข PayPal: Charges USD, credits JY
โข Mobile Money: Charges local currency, credits JY
โข Crypto: Receives crypto, credits JY
โข All use current JY rate for conversion

USER INTERFACE
โโโโโโโโโโโโโโ
โข Wallet page shows balance in JY + USD
โข Payment forms show both JY and USD amounts
โข Pricing displays updated with current rate
โข Super admin panel for rate management

REPORTING & ANALYTICS
โโโโโโโโโโโโโโโโโโโโโ
โข Financial reports include rate used
โข Rate change impact analysis
โข Revenue tracking in both JY and USD
โข Historical rate data for audits
```

---

**Architecture Version:** 1.0.0  
**Last Updated:** October 21, 2025  
**Status:** Production Ready โ
