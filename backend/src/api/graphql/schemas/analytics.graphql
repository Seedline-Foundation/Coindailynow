# Analytics System GraphQL Schema
# Task 18: Advanced Analytics System

type AnalyticsEvent {
  id: ID!
  userId: ID
  sessionId: String!
  eventType: String!
  resourceId: ID
  resourceType: String
  properties: JSON
  metadata: AnalyticsMetadata!
  timestamp: DateTime!
}

type AnalyticsMetadata {
  userAgent: String!
  deviceType: DeviceType!
  country: String!
  region: String!
  language: String!
  referrer: String
  sessionDuration: Int
  ipAddress: String!
  africanMarketContext: AfricanMarketContext
}

type AfricanMarketContext {
  country: String!
  exchange: String
  mobileMoneyProvider: String
  localCurrency: String!
  timezone: String!
  networkConditions: NetworkCondition
}

enum DeviceType {
  MOBILE
  TABLET
  DESKTOP
  OTHER
}

enum NetworkCondition {
  FAST
  SLOW
  OFFLINE
}

type UserBehaviorAnalytics {
  userId: ID!
  sessionAnalytics: SessionAnalytics!
  engagementMetrics: UserEngagementMetrics!
  contentPreferences: ContentPreferences!
  africanMarketBehavior: AfricanMarketBehavior!
  deviceUsagePatterns: DeviceUsagePatterns!
}

type SessionAnalytics {
  averageSessionDuration: Float!
  pagesPerSession: Float!
  bounceRate: Float!
  sessionsCount: Int!
  lastSessionAt: DateTime!
  sessionTimeDistribution: TimeDistribution!
}

type UserEngagementMetrics {
  totalEngagements: Int!
  engagementRate: Float!
  avgReadingTime: Float!
  socialShares: Int!
  commentsCount: Int!
  likesCount: Int!
  bookmarksCount: Int!
  subscriptionEngagement: SubscriptionEngagement!
}

type SubscriptionEngagement {
  planType: String!
  subscriptionDate: DateTime!
  paymentMethod: String!
  churnRisk: Float!
  lifetimeValue: Float!
}

type ContentPreferences {
  preferredCategories: [CategoryPreference!]!
  readingTimePreference: ReadingTimePreference!
  contentTypePreference: ContentTypePreference!
  languagePreferences: [LanguagePreference!]!
}

type CategoryPreference {
  categoryId: ID!
  categoryName: String!
  engagementScore: Float!
  readingTime: Float!
  shareRate: Float!
}

enum ReadingTimePreference {
  SHORT
  MEDIUM
  LONG
}

type ContentTypePreference {
  articles: Float!
  marketAnalysis: Float!
  news: Float!
  tutorials: Float!
  interviews: Float!
}

type LanguagePreference {
  language: String!
  engagementRate: Float!
  readingTime: Float!
}

type AfricanMarketBehavior {
  preferredExchanges: [String!]!
  mobileMoneyUsage: MobileMoneyUsage!
  localCurrencyFocus: String!
  crossBorderInterest: Boolean!
  remittanceInterest: Boolean!
  tradingExperienceLevel: TradingExperienceLevel!
}

type MobileMoneyUsage {
  provider: String!
  frequency: MobileMoneyFrequency!
  transactionTypes: [String!]!
  averageAmount: Float!
}

enum TradingExperienceLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum MobileMoneyFrequency {
  LOW
  MEDIUM
  HIGH
}

type DeviceUsagePatterns {
  primaryDevice: DeviceType!
  deviceDistribution: DeviceDistribution!
  operatingSystem: String!
  browserPreference: String!
  networkSpeedPreference: NetworkSpeedPreference!
}

type DeviceDistribution {
  mobile: Float!
  tablet: Float!
  desktop: Float!
  other: Float!
}

enum NetworkSpeedPreference {
  FAST
  OPTIMIZED
}

type TimeDistribution {
  hourly: JSON!
  daily: JSON!
  monthly: JSON!
}

type ContentPerformanceAnalytics {
  contentId: ID!
  contentType: String!
  performanceMetrics: ContentPerformanceMetrics!
  audienceAnalytics: AudienceAnalytics!
  engagementAnalytics: ContentEngagementAnalytics!
  africanMarketPerformance: AfricanMarketPerformance!
  conversionMetrics: ConversionMetrics!
}

type ContentPerformanceMetrics {
  totalViews: Int!
  uniqueViews: Int!
  avgReadingTime: Float!
  completionRate: Float!
  bounceRate: Float!
  returnVisitorRate: Float!
  peakViewingTime: DateTime!
  geographicReach: Int!
}

type AudienceAnalytics {
  demographics: DemographicsData!
  geographicDistribution: [GeographicDistribution!]!
  deviceBreakdown: DeviceDistribution!
  trafficSources: [TrafficSource!]!
  newVsReturning: NewVsReturningUsers!
}

type DemographicsData {
  ageGroups: [AgeGroupData!]!
  languages: [LanguageDistribution!]!
  subscriptionTiers: [SubscriptionTierData!]!
}

type AgeGroupData {
  ageRange: String!
  percentage: Float!
  engagementRate: Float!
}

type LanguageDistribution {
  language: String!
  percentage: Float!
  avgReadingTime: Float!
}

type SubscriptionTierData {
  tier: String!
  percentage: Float!
  conversionRate: Float!
}

type GeographicDistribution {
  country: String!
  region: String!
  percentage: Float!
  engagementScore: Float!
  averageSessionDuration: Float!
}

type TrafficSource {
  source: String!
  medium: String!
  percentage: Float!
  conversionRate: Float!
  bounceRate: Float!
}

type NewVsReturningUsers {
  newUsers: Int!
  returningUsers: Int!
}

type ContentEngagementAnalytics {
  socialShares: [SocialShareData!]!
  comments: CommentAnalytics!
  reactions: ReactionAnalytics!
  bookmarks: Int!
  emailShares: Int!
  printActions: Int!
}

type SocialShareData {
  platform: String!
  shares: Int!
  clicks: Int!
  engagement: Int!
}

type CommentAnalytics {
  totalComments: Int!
  averageCommentLength: Float!
  sentimentScore: Float!
  topContributors: [String!]!
  moderationActions: Int!
}

type ReactionAnalytics {
  likes: Int!
  loves: Int!
  helpful: Int!
  insightful: Int!
  totalReactions: Int!
}

type AfricanMarketPerformance {
  countryPerformance: [CountryPerformance!]!
  exchangeMentions: [ExchangeMentionData!]!
  mobileMoneyInteractions: [MobileMoneyInteractionData!]!
  localCurrencyEngagement: [LocalCurrencyData!]!
}

type CountryPerformance {
  country: String!
  views: Int!
  engagementRate: Float!
  avgReadingTime: Float!
  conversionRate: Float!
  mobileUsagePercent: Float!
}

type ExchangeMentionData {
  exchange: String!
  mentions: Int!
  clickThroughRate: Float!
  userInteractions: Int!
}

type MobileMoneyInteractionData {
  provider: String!
  interactions: Int!
  conversionToSubscription: Int!
}

type LocalCurrencyData {
  currency: String!
  mentions: Int!
  priceQueries: Int!
  conversionRequests: Int!
}

type ConversionMetrics {
  subscriptionConversions: Int!
  emailSignups: Int!
  socialFollows: Int!
  newsletterSignups: Int!
  downloadActions: Int!
  affiliateClicks: Int!
  revenueGenerated: Float!
}

type AfricanMarketInsights {
  topCountries: [CountryInsight!]!
  exchangePopularity: [ExchangeInsight!]!
  mobileMoneyAdoption: [MobileMoneyInsight!]!
  languageUsage: [LanguageUsageInsight!]!
  crossBorderActivity: CrossBorderInsight!
}

type CountryInsight {
  country: String!
  userCount: Int!
  contentViews: Int!
  revenueContribution: Float!
  growthRate: Float!
}

type ExchangeInsight {
  exchange: String!
  mentions: Int!
  userInteractions: Int!
  contentAssociation: Int!
}

type MobileMoneyInsight {
  provider: String!
  userCount: Int!
  transactionVolume: Float!
  subscriptionConversions: Int!
}

type LanguageUsageInsight {
  language: String!
  userCount: Int!
  contentAvailable: Int!
  engagementRate: Float!
}

type CrossBorderInsight {
  totalCrossBorderUsers: Int!
  popularRoutes: [CrossBorderRoute!]!
  remittanceInterest: Float!
}

type CrossBorderRoute {
  fromCountry: String!
  toCountry: String!
  userCount: Int!
  transactionInterest: Float!
}

type RealTimeAnalytics {
  onlineUsers: Int!
  livePageViews: Int!
  activeContent: [ActiveContent!]!
  trendingTopics: [TrendingTopic!]!
  systemPerformance: SystemPerformanceMetrics!
}

type ActiveContent {
  contentId: ID!
  title: String!
  currentViewers: Int!
  engagementRate: Float!
}

type TrendingTopic {
  topic: String!
  mentions: Int!
  engagementScore: Float!
  growth: Float!
}

type SystemPerformanceMetrics {
  responseTime: Float!
  cacheHitRate: Float!
  errorRate: Float!
  serverLoad: Float!
}

type TopContent {
  contentId: ID!
  title: String!
  views: Int!
  engagementScore: Float!
  conversionRate: Float!
}

type AnalyticsResponse {
  data: JSON!
  metadata: AnalyticsResponseMetadata!
  error: AnalyticsError
}

type AnalyticsResponseMetadata {
  totalRecords: Int!
  processedRecords: Int!
  query: JSON!
  executionTime: Float!
  cacheHit: Boolean!
}

type AnalyticsError {
  code: String!
  message: String!
}

type AnalyticsHealth {
  status: AnalyticsHealthStatus!
  dataLatency: Float!
  processingQueue: Int!
  errorRate: Float!
  lastProcessedEvent: DateTime!
}

enum AnalyticsHealthStatus {
  HEALTHY
  DEGRADED
  UNHEALTHY
}

type AnalyticsExport {
  exportId: ID!
  query: JSON!
  format: ExportFormat!
  status: ExportStatus!
  downloadUrl: String
  expiresAt: DateTime!
  createdAt: DateTime!
}

enum ExportFormat {
  CSV
  JSON
  PDF
}

enum ExportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

type CleanupResult {
  deletedRecords: Int!
}

# Input Types
input AnalyticsEventInput {
  userId: ID
  sessionId: String
  eventType: String!
  resourceId: ID
  resourceType: String
  properties: JSON
  metadata: AnalyticsMetadataInput!
}

input AnalyticsMetadataInput {
  userAgent: String!
  deviceType: String!
  country: String!
  region: String!
  language: String!
  referrer: String
  sessionDuration: Int
  ipAddress: String!
  africanMarketContext: AfricanMarketContextInput
}

input AfricanMarketContextInput {
  country: String!
  exchange: String
  mobileMoneyProvider: String
  localCurrency: String!
  timezone: String!
  networkConditions: String
}

input MobileMoneyEventInput {
  provider: String!
  amount: Float!
  currency: String!
  transactionType: String!
  status: String!
}

input DateRangeInput {
  startDate: DateTime!
  endDate: DateTime!
}

input AnalyticsQueryInput {
  dateRange: DateRangeInput!
  filters: AnalyticsFiltersInput
  groupBy: String
  metrics: [String!]!
  sortBy: SortOptionsInput
  limit: Int
}

input AnalyticsFiltersInput {
  userIds: [ID!]
  contentIds: [ID!]
  categories: [String!]
  countries: [String!]
  deviceTypes: [String!]
  eventTypes: [String!]
  subscriptionTiers: [String!]
  africanExchanges: [String!]
  mobileMoneyProviders: [String!]
}

input SortOptionsInput {
  field: String!
  direction: String!
}

input ExportOptionsInput {
  format: ExportFormat!
  includePersonalData: Boolean!
}

extend type Query {
  # User Analytics
  getUserBehaviorAnalytics(userId: ID!): UserBehaviorAnalytics!
  getSessionAnalytics(userId: ID!, dateRange: DateRangeInput!): SessionAnalytics!
  
  # Content Analytics  
  getContentPerformanceAnalytics(contentId: ID!): ContentPerformanceAnalytics!
  getTopPerformingContent(limit: Int): [TopContent!]!
  
  # Market Insights
  getAfricanMarketInsights(dateRange: DateRangeInput!): AfricanMarketInsights!
  
  # Real-time Analytics
  getRealTimeAnalytics: RealTimeAnalytics!
  
  # Advanced Queries
  queryAnalytics(query: AnalyticsQueryInput!): AnalyticsResponse!
  
  # System Health
  getAnalyticsHealth: AnalyticsHealth!
}

extend type Mutation {
  # Event Tracking
  trackEvent(eventData: AnalyticsEventInput!): AnalyticsEvent!
  trackMobileMoneyEvent(userId: ID!, mobileMoneyData: MobileMoneyEventInput!): AnalyticsEvent!
  
  # Data Management
  exportUserData(userId: ID!, options: ExportOptionsInput!): AnalyticsExport!
  cleanupOldData: CleanupResult!
}

# Custom scalar for JSON data
scalar JSON
scalar DateTime