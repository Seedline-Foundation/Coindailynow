# Finance Operations GraphQL Schema
# Wallet and Transaction Management System

# ============================================================================
# INPUT TYPES
# ============================================================================

"""
Input for deposit operations
"""
input DepositInput {
  userId: ID!
  walletId: ID!
  amount: Float!
  currency: String!
  method: PaymentMethod!
  externalReference: String
  metadata: JSON
}

"""
Input for withdrawal operations
"""
input WithdrawalInput {
  userId: ID!
  walletId: ID!
  amount: Float!
  currency: String!
  destinationType: WithdrawalDestinationType!
  destinationAddress: String!
  otpCode: String
  metadata: JSON
}

"""
Input for transfer operations
"""
input TransferInput {
  fromUserId: ID!
  fromWalletId: ID!
  toUserId: ID!
  toWalletId: ID!
  amount: Float!
  currency: String!
  description: String
  metadata: JSON
}

"""
Input for payment operations
"""
input PaymentInput {
  userId: ID!
  walletId: ID!
  amount: Float!
  currency: String!
  paymentType: PaymentType!
  referenceId: ID!
  metadata: JSON
}

"""
Input for refund operations
"""
input RefundInput {
  originalTransactionId: ID!
  amount: Float
  reason: String!
  refundType: RefundType!
  metadata: JSON
}

"""
Input for staking operations
"""
input StakingInput {
  userId: ID!
  walletId: ID!
  amount: Float!
  currency: String!
  duration: Int!
  aprRate: Float!
  metadata: JSON
}

"""
Input for conversion operations
"""
input ConversionInput {
  userId: ID!
  walletId: ID!
  fromCurrency: String!
  toCurrency: String!
  amount: Float!
  conversionRate: Float!
  metadata: JSON
}

"""
Input for gift/tip/donation operations
"""
input GiftInput {
  fromUserId: ID!
  fromWalletId: ID!
  toUserId: ID!
  amount: Float!
  currency: String!
  message: String
  metadata: JSON
}

"""
Input for batch transfer recipient
"""
input BatchTransferRecipient {
  toUserId: ID!
  toWalletId: ID!
  amount: Float!
  description: String
}

"""
Input for batch transfer operations
"""
input BatchTransferInput {
  fromUserId: ID!
  fromWalletId: ID!
  transfers: [BatchTransferRecipient!]!
  currency: String!
  metadata: JSON
}

# ============================================================================
# ENUMS
# ============================================================================

enum PaymentMethod {
  CRYPTO
  MOBILE_MONEY
  CARD
  BANK_TRANSFER
  PAYPAL
  STRIPE
  CE_POINTS
  JOY_TOKENS
}

enum WithdrawalDestinationType {
  EXTERNAL_WALLET
  MOBILE_MONEY
  BANK_ACCOUNT
}

enum PaymentType {
  SUBSCRIPTION
  PRODUCT
  SERVICE
  PREMIUM_CONTENT
  BOOST_CAMPAIGN
}

enum RefundType {
  FULL
  PARTIAL
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

# ============================================================================
# OUTPUT TYPES
# ============================================================================

"""
Result of a financial transaction operation
"""
type TransactionResult {
  success: Boolean!
  transactionId: ID
  error: String
  requiresOTP: Boolean
  requiresApproval: Boolean
}

"""
Wallet transaction details
"""
type WalletTransaction {
  id: ID!
  transactionHash: String!
  transactionType: String!
  operationType: String!
  fromWalletId: ID
  toWalletId: ID
  amount: Float!
  currency: String!
  netAmount: Float!
  fee: Float
  status: TransactionStatus!
  paymentMethod: PaymentMethod!
  externalReference: String
  purpose: String
  metadata: JSON
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Wallet information
"""
type Wallet {
  id: ID!
  userId: ID!
  walletType: String!
  currency: String!
  availableBalance: Float!
  lockedBalance: Float!
  stakedBalance: Float!
  totalBalance: Float!
  cePoints: Float!
  joyTokens: Float!
  status: String!
  lastTransactionAt: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
}

"""
Staking record
"""
type Staking {
  id: ID!
  userId: ID!
  walletId: ID!
  amount: Float!
  currency: String!
  status: String!
  aprRate: Float!
  startDate: DateTime!
  endDate: DateTime!
  rewardsEarned: Float!
  autoRenew: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
}

# ============================================================================
# QUERIES
# ============================================================================

extend type Query {
  """
  Get wallet by ID
  """
  getWallet(walletId: ID!): Wallet

  """
  Get user's wallets
  """
  getUserWallets(userId: ID!): [Wallet!]!

  """
  Get wallet transactions
  """
  getWalletTransactions(
    walletId: ID!
    limit: Int
    offset: Int
    status: TransactionStatus
  ): [WalletTransaction!]!

  """
  Get transaction by ID
  """
  getTransaction(transactionId: ID!): WalletTransaction

  """
  Get user's staking records
  """
  getUserStakings(userId: ID!): [Staking!]!

  """
  Get wallet balance
  """
  getWalletBalance(walletId: ID!): Wallet
}

# ============================================================================
# MUTATIONS - DEPOSITS
# ============================================================================

extend type Mutation {
  """
  Deposit from external wallet (blockchain)
  """
  depositFromExternalWallet(input: DepositInput!): TransactionResult!

  """
  Deposit via mobile money (M-Pesa, Orange Money, MTN Money, EcoCash)
  """
  depositViaMobileMoney(input: DepositInput!): TransactionResult!

  """
  Deposit via credit/debit card (Stripe/PayPal)
  """
  depositViaCard(input: DepositInput!): TransactionResult!

  """
  Deposit via bank transfer
  """
  depositViaBankTransfer(input: DepositInput!): TransactionResult!

  # ============================================================================
  # MUTATIONS - WITHDRAWALS
  # ============================================================================

  """
  Withdraw to external wallet
  """
  withdrawToExternalWallet(input: WithdrawalInput!): TransactionResult!

  """
  Withdraw via mobile money
  """
  withdrawViaMobileMoney(input: WithdrawalInput!): TransactionResult!

  """
  Withdraw to bank account
  """
  withdrawToBankAccount(input: WithdrawalInput!): TransactionResult!

  # ============================================================================
  # MUTATIONS - TRANSFERS
  # ============================================================================

  """
  Transfer between users
  """
  transferUserToUser(input: TransferInput!): TransactionResult!

  """
  Admin transfer to user
  """
  transferAdminToUser(input: TransferInput!): TransactionResult!

  """
  User pays platform
  """
  transferUserToWeWallet(input: TransferInput!): TransactionResult!

  """
  Platform pays user
  """
  transferWeWalletToUser(input: TransferInput!): TransactionResult!

  """
  Platform transfers to external wallet
  """
  transferWeWalletToExternal(input: TransferInput!): TransactionResult!

  """
  Batch/bulk transfer to multiple recipients
  """
  batchTransfer(input: BatchTransferInput!): TransactionResult!

  # ============================================================================
  # MUTATIONS - PAYMENTS
  # ============================================================================

  """
  Process subscription payment
  """
  processSubscriptionPayment(input: PaymentInput!): TransactionResult!

  """
  Process product payment
  """
  processProductPayment(input: PaymentInput!): TransactionResult!

  """
  Process service payment
  """
  processServicePayment(input: PaymentInput!): TransactionResult!

  """
  Process premium content payment
  """
  processPremiumContentPayment(input: PaymentInput!): TransactionResult!

  """
  Process boost campaign payment
  """
  processBoostCampaignPayment(input: PaymentInput!): TransactionResult!

  # ============================================================================
  # MUTATIONS - REFUNDS
  # ============================================================================

  """
  Process full refund
  """
  processFullRefund(input: RefundInput!): TransactionResult!

  """
  Process partial refund
  """
  processPartialRefund(input: RefundInput!): TransactionResult!

  """
  Process subscription refund
  """
  processSubscriptionRefund(input: RefundInput!): TransactionResult!

  """
  Handle chargeback
  """
  handleChargeback(input: RefundInput!): TransactionResult!

  # ============================================================================
  # MUTATIONS - STAKING
  # ============================================================================

  """
  Lock tokens for staking
  """
  lockStaking(input: StakingInput!): TransactionResult!

  """
  Unlock staked tokens
  """
  unlockStaking(stakingId: ID!): TransactionResult!

  """
  Claim staking rewards
  """
  claimStakingRewards(stakingId: ID!): TransactionResult!

  # ============================================================================
  # MUTATIONS - CONVERSIONS
  # ============================================================================

  """
  Convert CE Points to platform tokens
  """
  convertToCEPoints(input: ConversionInput!): TransactionResult!

  """
  Convert tokens to CE Points
  """
  convertToJOYTokens(input: ConversionInput!): TransactionResult!

  """
  Convert JOY Tokens to platform tokens
  """
  convertToPlatformTokens(input: ConversionInput!): TransactionResult!

  # ============================================================================
  # MUTATIONS - GIFTS & DONATIONS
  # ============================================================================

  """
  Send gift to another user
  """
  sendGift(input: GiftInput!): TransactionResult!

  """
  Tip content creator
  """
  sendTip(input: GiftInput!): TransactionResult!

  """
  Send donation
  """
  sendDonation(input: GiftInput!): TransactionResult!
}

# ============================================================================
# SUBSCRIPTIONS
# ============================================================================

extend type Subscription {
  """
  Subscribe to wallet balance updates
  """
  walletBalanceUpdated(walletId: ID!): Wallet!

  """
  Subscribe to new transactions
  """
  transactionCreated(walletId: ID!): WalletTransaction!

  """
  Subscribe to transaction status updates
  """
  transactionStatusUpdated(transactionId: ID!): WalletTransaction!
}

# ============================================================================
# SCALARS
# ============================================================================

scalar DateTime
scalar JSON
