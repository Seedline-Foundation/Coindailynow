generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AIAgent {
  id                 String   @id
  name               String
  type               String
  modelProvider      String
  modelName          String
  configuration      String?
  isActive           Boolean  @default(true)
  performanceMetrics String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  AITask             AITask[]

  @@index([isActive])
  @@index([type])
}

model AITask {
  id               String        @id
  agentId          String
  taskType         String
  inputData        String?
  outputData       String?
  status           String        @default("QUEUED")
  priority         String        @default("NORMAL")
  estimatedCost    Float
  actualCost       Float?
  processingTimeMs Int?
  qualityScore     Float?
  errorMessage     String?
  retryCount       Int           @default(0)
  maxRetries       Int           @default(3)
  scheduledAt      DateTime?
  startedAt        DateTime?
  completedAt      DateTime?
  createdAt        DateTime      @default(now())
  workflowStepId   String?
  WorkflowStep     WorkflowStep? @relation(fields: [workflowStepId], references: [id])
  AIAgent          AIAgent       @relation(fields: [agentId], references: [id])

  @@index([status, createdAt])
  @@index([priority, createdAt])
  @@index([agentId, status])
}

model AnalyticsEvent {
  id           String   @id
  userId       String?
  sessionId    String
  eventType    String
  resourceId   String?
  resourceType String?
  properties   String
  metadata     String
  timestamp    DateTime @default(now())
  User         User?    @relation(fields: [userId], references: [id])

  @@index([eventType, timestamp])
  @@index([userId, timestamp])
  @@index([timestamp])
  @@index([sessionId])
  @@index([resourceType])
  @@index([resourceId])
  @@index([eventType])
  @@index([userId])
}

model Article {
  id                 String               @id
  title              String
  slug               String               @unique
  excerpt            String
  content            String
  featuredImageUrl   String?
  authorId           String
  categoryId         String
  tags               String?
  status             String               @default("DRAFT")
  priority           String               @default("NORMAL")
  isPremium          Boolean              @default(false)
  viewCount          Int                  @default(0)
  likeCount          Int                  @default(0)
  commentCount       Int                  @default(0)
  shareCount         Int                  @default(0)
  readingTimeMinutes Int
  seoTitle           String?
  seoDescription     String?
  seoKeywords        String? // SEO keywords for optimization
  metadata           String? // JSON field for AI feedback metadata
  aiGenerated        Boolean? // Whether article was AI-generated
  publishScheduledAt DateTime?
  publishedAt        DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  deletedAt          DateTime?
  Category           Category             @relation(fields: [categoryId], references: [id])
  User               User                 @relation(fields: [authorId], references: [id])
  ArticleTranslation ArticleTranslation[]
  ArticleImage       ArticleImage[]
  ContentWorkflow    ContentWorkflow?
  ContentPipeline    ContentPipeline[]
  UserEngagement     UserEngagement[]
  AutomatedArticle   AutomatedArticle?    @relation("AutomatedToPublished")
  ContentVersion     ContentVersion[]
  KnowledgeBase      KnowledgeBase?
  UserFeedback       UserFeedback[]
  ContentRevisions   ContentRevision[]

  @@index([slug])
  @@index([isPremium])
  @@index([authorId, status])
  @@index([categoryId, publishedAt])
  @@index([status, publishedAt])
}

model ContentRevision {
  id             String   @id @default(cuid())
  articleId      String
  title          String
  excerpt        String
  content        String
  revisionNumber Int
  changeType     String // CREATE, UPDATE, MAJOR_EDIT, MINOR_EDIT, ROLLBACK
  changedBy      String
  changeReason   String? // Optional reason for the change
  changesSummary String? // Brief summary of what changed
  metadata       String? // JSON field for additional revision metadata
  createdAt      DateTime @default(now())
  User           User     @relation(fields: [changedBy], references: [id])
  Article        Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, revisionNumber])
  @@index([articleId, createdAt])
  @@index([changedBy])
}

model ArticleTranslation {
  id                String   @id
  articleId         String
  languageCode      String
  title             String
  excerpt           String
  content           String
  translationStatus String   @default("PENDING")
  aiGenerated       Boolean  @default(true)
  humanReviewed     Boolean  @default(false)
  translatorId      String?
  qualityScore      Int?
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  User              User?    @relation(fields: [translatorId], references: [id])
  Article           Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, languageCode])
  @@index([translationStatus])
  @@index([articleId, languageCode])
}

// TASK 8.2: AI-Generated Visuals
// ============================================================
model ArticleImage {
  id           String  @id @default(uuid())
  articleId    String
  imageType    String // featured, thumbnail, chart, social, gallery, infographic
  imageUrl     String
  thumbnailUrl String?
  altText      String // SEO-optimized alt text
  caption      String?

  // AI Generation Metadata
  aiGenerated      Boolean @default(true)
  generationPrompt String?
  revisedPrompt    String? // DALL-E revised prompt
  dalleModel       String? // dall-e-3, dall-e-2

  // Image Properties
  width   Int?
  height  Int?
  format  String? // png, jpg, webp, avif
  size    Int? // File size in bytes
  quality String? // standard, hd

  // Optimization
  isOptimized       Boolean @default(false)
  optimizedUrl      String?
  webpUrl           String?
  avifUrl           String?
  placeholderBase64 String? // For lazy loading

  // SEO & Performance
  seoKeywords     String? // JSON array of keywords
  loadingPriority String  @default("lazy") // eager, lazy, auto
  aspectRatio     String? // 16:9, 1:1, 4:3
  focalPointX     Float? // 0-1 for smart cropping
  focalPointY     Float? // 0-1 for smart cropping

  // Chart-specific (for market data visualizations)
  chartType   String? // line, bar, pie, candlestick
  chartData   String? // JSON chart configuration
  chartSymbol String? // Crypto symbol for charts

  // Usage Tracking
  viewCount     Int @default(0)
  downloadCount Int @default(0)

  // Status
  status           String  @default("active") // active, archived, deleted
  processingStatus String  @default("completed") // pending, processing, completed, failed
  errorMessage     String?

  // Metadata
  metadata  String? // JSON: additional metadata
  expiresAt DateTime? // For temporary images

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId, imageType])
  @@index([status, processingStatus])
  @@index([chartSymbol])
  @@index([createdAt])
}

model Category {
  id             String     @id
  name           String
  slug           String     @unique
  description    String?
  parentId       String?
  iconUrl        String?
  colorHex       String?
  sortOrder      Int        @default(0)
  isActive       Boolean    @default(true)
  articleCount   Int        @default(0)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  Article        Article[]
  Category       Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  other_Category Category[] @relation("CategoryToCategory")

  @@index([isActive])
  @@index([slug])
}

model CommunityPost {
  id                  String           @id
  authorId            String
  title               String?
  content             String
  postType            String           @default("TEXT")
  parentId            String?
  tokenMentions       String?
  mediaUrls           String?
  upvoteCount         Int              @default(0)
  downvoteCount       Int              @default(0)
  commentCount        Int              @default(0)
  shareCount          Int              @default(0)
  isPinned            Boolean          @default(false)
  isLocked            Boolean          @default(false)
  moderationStatus    String           @default("APPROVED")
  violationReason     String?
  penaltyApplied      String?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime
  deletedAt           DateTime?
  CommunityPost       CommunityPost?   @relation("CommunityPostToCommunityPost", fields: [parentId], references: [id])
  other_CommunityPost CommunityPost[]  @relation("CommunityPostToCommunityPost")
  User                User             @relation(fields: [authorId], references: [id])
  UserEngagement      UserEngagement[]
  Vote                Vote[]

  @@index([parentId])
  @@index([moderationStatus, createdAt])
  @@index([authorId, createdAt])
}

model ComplianceCheck {
  id                     String                   @id
  transactionId          String?
  userId                 String?
  requirementId          String
  amountLimitsCheck      Boolean                  @default(false)
  kycStatusCheck         Boolean                  @default(false)
  sanctionsScreenCheck   Boolean                  @default(false)
  taxComplianceCheck     Boolean                  @default(false)
  passed                 Boolean                  @default(false)
  violations             String?
  checkDetails           String?
  checkedBy              String?
  checkedAt              DateTime                 @default(now())
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  ComplianceRequirement  ComplianceRequirement    @relation(fields: [requirementId], references: [id])
  User                   User?                    @relation(fields: [userId], references: [id])
  MobileMoneyTransaction MobileMoneyTransaction[]

  @@index([requirementId])
  @@index([checkedAt])
  @@index([userId])
  @@index([passed])
}

model ComplianceRequirement {
  id                   String              @id
  country              String
  providerId           String
  kycRequired          Boolean             @default(true)
  maxTransactionAmount Int
  maxDailyAmount       Int
  maxMonthlyAmount     Int
  identityVerification Boolean             @default(false)
  taxReporting         Boolean             @default(false)
  dataRetentionDays    Int                 @default(365)
  restrictions         String?
  regulatoryBody       String?
  licenseRequired      Boolean             @default(false)
  isActive             Boolean             @default(true)
  effectiveFrom        DateTime            @default(now())
  expiresAt            DateTime?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  ComplianceCheck      ComplianceCheck[]
  MobileMoneyProvider  MobileMoneyProvider @relation(fields: [providerId], references: [id])

  @@unique([country, providerId])
  @@index([isActive])
  @@index([providerId])
  @@index([country])
}

model ContentPerformance {
  id               String   @id
  contentId        String
  contentType      String
  date             DateTime
  views            Int      @default(0)
  uniqueViews      Int      @default(0)
  likes            Int      @default(0)
  shares           Int      @default(0)
  comments         Int      @default(0)
  readingTimeAvg   Float    @default(0.0)
  bounceRate       Float    @default(0.0)
  conversionRate   Float    @default(0.0)
  revenueGenerated Float    @default(0.0)

  @@unique([contentId, contentType, date])
  @@index([date])
  @@index([contentType, date])
}

model ContentWorkflow {
  id                    String                 @id
  articleId             String                 @unique
  workflowType          String                 @default("ARTICLE_PUBLISHING")
  currentState          String                 @default("RESEARCH")
  previousState         String?
  priority              String                 @default("NORMAL")
  assignedReviewerId    String?
  completionPercentage  Float                  @default(0)
  estimatedCompletionAt DateTime?
  actualCompletionAt    DateTime?
  errorMessage          String?
  retryCount            Int                    @default(0)
  maxRetries            Int                    @default(3)
  metadata              String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  User                  User?                  @relation(fields: [assignedReviewerId], references: [id])
  Article               Article                @relation(fields: [articleId], references: [id], onDelete: Cascade)
  WorkflowNotification  WorkflowNotification[]
  WorkflowStep          WorkflowStep[]
  WorkflowTransition    WorkflowTransition[]

  @@index([workflowType])
  @@index([assignedReviewerId])
  @@index([priority, createdAt])
  @@index([currentState])
}

model ContentPipeline {
  id           String    @id
  articleId    String?
  status       String // initiated, researching, reviewing, generating, translating, generating_images, optimizing_seo, publishing, completed, failed
  currentStage String
  progress     Int       @default(0)
  qualityScore Float?
  stages       String? // JSON stringified array of PipelineStage[]
  errors       String? // JSON stringified array of strings
  startedAt    DateTime  @default(now())
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  Article      Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([articleId])
  @@index([startedAt])
  @@index([completedAt])
}

model SystemConfiguration {
  id          String   @id
  key         String   @unique
  value       String? // JSON stringified configuration object
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([key])
}

model ExchangeIntegration {
  id                 String    @id
  name               String
  slug               String    @unique
  apiEndpoint        String
  websocketEndpoint  String?
  region             String
  supportedCountries String?
  isActive           Boolean   @default(true)
  rateLimitPerMinute Int       @default(60)
  lastSyncAt         DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime

  @@index([region])
  @@index([isActive])
  @@index([slug])
}

model FraudAnalysis {
  id                     String                   @id
  transactionId          String?
  userId                 String?
  riskLevel              String
  riskScore              Int
  flags                  String
  recommendation         String
  reason                 String
  rulesTriggered         String?
  deviceFingerprint      String?
  ipAddress              String?
  userAgent              String?
  location               String?
  phoneNumber            String?
  amount                 Int?
  velocity               String?
  analyzedAt             DateTime                 @default(now())
  reviewedAt             DateTime?
  reviewedBy             String?
  finalDecision          String?
  notes                  String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  User                   User?                    @relation(fields: [userId], references: [id])
  MobileMoneyTransaction MobileMoneyTransaction[]

  @@index([phoneNumber])
  @@index([analyzedAt])
  @@index([userId])
  @@index([recommendation])
  @@index([riskLevel])
}

model MarketData {
  id             String   @id
  tokenId        String
  exchange       String
  priceUsd       Float
  priceChange24h Float
  volume24h      Float
  marketCap      Float
  timestamp      DateTime @default(now())
  high24h        Float
  low24h         Float
  tradingPairs   String?
  Token          Token    @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@index([exchange, timestamp])
  @@index([tokenId, timestamp])
}

model MobileMoneyProvider {
  id                     String                   @id
  name                   String                   @unique
  code                   String                   @unique
  displayName            String
  country                String
  currency               String
  apiEndpoint            String
  isActive               Boolean                  @default(true)
  supportedCurrencies    String
  minAmount              Int
  maxAmount              Int
  fixedFee               Int                      @default(0)
  percentageFee          Float                    @default(0.0)
  timeout                Int                      @default(300)
  merchantId             String?
  apiKey                 String?
  secretKey              String?
  webhookSecret          String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  ComplianceRequirement  ComplianceRequirement[]
  MobileMoneyTransaction MobileMoneyTransaction[]
  SubscriptionPayment    SubscriptionPayment[]

  @@index([isActive])
  @@index([country])
  @@index([code])
}

model MobileMoneyTransaction {
  id                    String              @id
  userId                String
  providerId            String
  providerTransactionId String?
  amount                Int
  currency              String
  phoneNumber           String
  status                String              @default("PENDING")
  transactionType       String
  description           String
  subscriptionId        String?
  providerFee           Int                 @default(0)
  platformFee           Int                 @default(0)
  totalFee              Int                 @default(0)
  metadata              String?
  failureReason         String?
  fraudAnalysisId       String?
  complianceCheckId     String?
  processedAt           DateTime?
  completedAt           DateTime?
  expiresAt             DateTime?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime
  ComplianceCheck       ComplianceCheck?    @relation(fields: [complianceCheckId], references: [id])
  FraudAnalysis         FraudAnalysis?      @relation(fields: [fraudAnalysisId], references: [id])
  Subscription          Subscription?       @relation(fields: [subscriptionId], references: [id])
  MobileMoneyProvider   MobileMoneyProvider @relation(fields: [providerId], references: [id])
  User                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([providerTransactionId])
  @@index([createdAt])
  @@index([phoneNumber])
  @@index([transactionType])
  @@index([status])
  @@index([providerId])
  @@index([userId])
}

model PasswordReset {
  id          String    @id
  userId      String
  token       String    @unique
  hashedToken String
  expiresAt   DateTime
  isUsed      Boolean   @default(false)
  usedAt      DateTime?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isUsed])
  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model PaymentWebhook {
  id                    String    @id
  provider              String
  eventType             String
  transactionId         String?
  providerTransactionId String?
  status                String?
  amount                Int?
  currency              String?
  phoneNumber           String?
  signature             String
  payload               String
  processed             Boolean   @default(false)
  processedAt           DateTime?
  errorMessage          String?
  retryCount            Int       @default(0)
  maxRetries            Int       @default(3)
  nextRetryAt           DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime

  @@index([createdAt])
  @@index([transactionId])
  @@index([processed])
  @@index([eventType])
  @@index([provider])
}

model RefreshToken {
  id                String    @id
  userId            String
  token             String    @unique
  hashedToken       String
  expiresAt         DateTime
  isRevoked         Boolean   @default(false)
  revokedAt         DateTime?
  revokedBy         String?
  deviceFingerprint String?
  ipAddress         String?
  userAgent         String?
  createdAt         DateTime  @default(now())
  User              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isRevoked])
  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model SecurityEvent {
  id        String   @id
  userId    String?
  eventType String
  severity  String   @default("INFO")
  ipAddress String?
  userAgent String?
  country   String?
  city      String?
  metadata  String?
  createdAt DateTime @default(now())

  @@index([ipAddress])
  @@index([createdAt])
  @@index([severity])
  @@index([eventType])
  @@index([userId])
}

model Session {
  id                 String   @id
  userId             String
  sessionToken       String   @unique
  hashedSessionToken String
  deviceFingerprint  String?
  ipAddress          String?
  userAgent          String?
  country            String?
  city               String?
  isActive           Boolean  @default(true)
  lastActivityAt     DateTime @default(now())
  expiresAt          DateTime
  createdAt          DateTime @default(now())
  User               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([lastActivityAt])
  @@index([isActive])
  @@index([sessionToken])
  @@index([userId])
}

model Subscription {
  id                     String                   @id
  userId                 String                   @unique
  planId                 String
  status                 String                   @default("ACTIVE")
  currentPeriodStart     DateTime
  currentPeriodEnd       DateTime
  trialEnd               DateTime?
  cancelAtPeriodEnd      Boolean                  @default(false)
  cancelledAt            DateTime?
  stripeSubscriptionId   String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  MobileMoneyTransaction MobileMoneyTransaction[]
  SubscriptionPlan       SubscriptionPlan         @relation(fields: [planId], references: [id])
  User                   User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  SubscriptionPayment    SubscriptionPayment[]

  @@index([currentPeriodEnd])
  @@index([status])
}

model SubscriptionPayment {
  id                  String              @id
  subscriptionId      String
  userId              String
  providerId          String
  phoneNumber         String
  amount              Int
  currency            String
  status              String              @default("PENDING")
  billingPeriodStart  DateTime
  billingPeriodEnd    DateTime
  attemptCount        Int                 @default(0)
  maxAttempts         Int                 @default(3)
  nextAttemptAt       DateTime?
  transactionId       String?
  completedAt         DateTime?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  MobileMoneyProvider MobileMoneyProvider @relation(fields: [providerId], references: [id])
  User                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  Subscription        Subscription        @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([billingPeriodEnd])
  @@index([nextAttemptAt])
  @@index([status])
  @@index([userId])
  @@index([subscriptionId])
}

model SubscriptionPlan {
  id              String         @id
  name            String
  description     String
  priceCents      Int
  currency        String         @default("USD")
  billingInterval String
  trialPeriodDays Int            @default(0)
  features        String?
  isActive        Boolean        @default(true)
  sortOrder       Int            @default(0)
  stripePriceId   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  Subscription    Subscription[]

  @@index([isActive])
}

model Tag {
  id            String   @id
  name          String   @unique
  slug          String   @unique
  description   String?
  usageCount    Int      @default(0)
  trendingScore Float    @default(0.0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([trendingScore])
  @@index([usageCount])
}

model Token {
  id                String       @id
  symbol            String       @unique
  name              String
  slug              String       @unique
  description       String?
  logoUrl           String?
  websiteUrl        String?
  whitepaperUrl     String?
  blockchain        String
  contractAddress   String?
  tokenType         String
  marketCap         Float?
  circulatingSupply Float?
  totalSupply       Float?
  maxSupply         Float?
  isMemecoin        Boolean      @default(false)
  isListed          Boolean      @default(true)
  listingStatus     String       @default("APPROVED")
  createdAt         DateTime     @default(now())
  updatedAt         DateTime
  MarketData        MarketData[]

  @@index([tokenType])
  @@index([isListed])
  @@index([slug])
  @@index([symbol])
}

enum UserRole {
  USER
  ADMIN             // Platform managers
  CONTENT_ADMIN
  MARKETING_ADMIN
  TECH_ADMIN
  SUPER_ADMIN
}

model User {
  id                           String                   @id
  email                        String                   @unique
  username                     String                   @unique
  passwordHash                 String
  role                         UserRole                 @default(USER)
  firstName                    String?
  lastName                     String?
  avatarUrl                    String?
  bio                          String?
  location                     String?
  preferredLanguage            String                   @default("en")
  subscriptionTier             String                   @default("FREE")
  emailVerified                Boolean                  @default(false)
  phoneVerified                Boolean                  @default(false)
  twoFactorEnabled             Boolean                  @default(false)
  twoFactorSecret              String?
  createdAt                    DateTime                 @default(now())
  updatedAt                    DateTime                 @updatedAt
  lastLoginAt                  DateTime?
  status                       String                   @default("ACTIVE")
  isShadowBanned               Boolean                  @default(false)
  AnalyticsEvent               AnalyticsEvent[]
  Article                      Article[]
  ArticleTranslation           ArticleTranslation[]
  CommunityPost                CommunityPost[]
  ComplianceCheck              ComplianceCheck[]
  ContentWorkflow              ContentWorkflow[]
  FraudAnalysis                FraudAnalysis[]
  MobileMoneyTransaction       MobileMoneyTransaction[]
  PasswordReset                PasswordReset[]
  RefreshToken                 RefreshToken[]
  Session                      Session[]
  Subscription                 Subscription?
  SubscriptionPayment          SubscriptionPayment[]
  UserEngagement               UserEngagement[]
  UserProfile                  UserProfile?
  Vote                         Vote[]
  WorkflowNotification         WorkflowNotification[]
  WorkflowStep                 WorkflowStep[]
  AdminPermission              AdminPermission[]
  AuditLog                     AuditLog[]
  ApprovedAutomatedArticles    AutomatedArticle[]       @relation("AutomatedArticleApprover")
  APIKey                       APIKey[]
  UserFeedback                 UserFeedback[]
  ViolationReport              ViolationReport[]
  UserPenalty                  UserPenalty[]
  AppliedPenalties             UserPenalty[]            @relation("AppliedPenalties")
  UserReputation               UserReputation?
  FalsePositive                FalsePositive[]
  AIAIOperationLog             AIOperationLog[]
  ComplianceReport             ComplianceReport[]
  UserConsent                  UserConsent[]
  DelegatedPermissionsReceived DelegatedPermission[]    @relation("DelegatedPermissionsReceived")
  DelegatedPermissionsGranted  DelegatedPermission[]    @relation("DelegatedPermissionsGranted")
  Wallets                      Wallet[]
  ContentRevisions             ContentRevision[]
  SecurityLogs                 SecurityLog[]
  FraudAlerts                  FraudAlert[] // Fraud detection alerts
  WithdrawalRequests           WithdrawalRequest[] // Withdrawal requests
  WhitelistChanges             WhitelistChange[] // Whitelist change history
  AdminActions                 AdminAction[]            @relation("AdminActionsPerformed")

  @@index([lastLoginAt])
  @@index([emailVerified])
  @@index([status])
  @@index([subscriptionTier])
  @@index([username])
  @@index([email])
  @@index([role])
}

model UserEngagement {
  id               String         @id
  userId           String?
  articleId        String?
  postId           String?
  actionType       String
  durationSeconds  Int?
  scrollPercentage Float?
  deviceType       String
  userAgent        String
  ipAddress        String
  referrerUrl      String?
  createdAt        DateTime       @default(now())
  CommunityPost    CommunityPost? @relation(fields: [postId], references: [id])
  Article          Article?       @relation(fields: [articleId], references: [id])
  User             User?          @relation(fields: [userId], references: [id])

  @@index([postId, actionType])
  @@index([articleId, actionType])
  @@index([userId, createdAt])
}

model UserProfile {
  userId                  String   @id
  bio                     String?
  location                String?
  website                 String?
  socialMedia             String?
  tradingExperience       String?
  investmentPortfolioSize String?
  preferredExchanges      String?
  notificationPreferences String?
  privacySettings         String?
  contentPreferences      String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime
  User                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Vote {
  id            String        @id
  userId        String
  postId        String
  voteType      String
  createdAt     DateTime      @default(now())
  CommunityPost CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  User          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
}

model WorkflowNotification {
  id               String          @id
  workflowId       String
  recipientId      String
  notificationType String
  title            String
  message          String
  priority         String          @default("NORMAL")
  channel          String?
  sentAt           DateTime?
  readAt           DateTime?
  status           String          @default("PENDING")
  errorMessage     String?
  metadata         String?
  createdAt        DateTime        @default(now())
  User             User            @relation(fields: [recipientId], references: [id])
  ContentWorkflow  ContentWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([status])
  @@index([recipientId])
  @@index([workflowId])
}

model WorkflowStep {
  id                  String          @id
  workflowId          String
  stepName            String
  stepOrder           Int
  status              String          @default("PENDING")
  assigneeId          String?
  estimatedDurationMs Int?
  actualDurationMs    Int?
  startedAt           DateTime?
  completedAt         DateTime?
  output              String?
  errorMessage        String?
  qualityScore        Float?
  humanFeedback       String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  AITask              AITask[]
  User                User?           @relation(fields: [assigneeId], references: [id])
  ContentWorkflow     ContentWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([stepName])
  @@index([assigneeId])
  @@index([status])
  @@index([workflowId, stepOrder])
}

model WorkflowTransition {
  id                String          @id
  workflowId        String
  fromState         String
  toState           String
  transitionType    String
  triggeredBy       String?
  triggerConditions String?
  transitionReason  String?
  metadata          String?
  createdAt         DateTime        @default(now())
  ContentWorkflow   ContentWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([fromState, toState])
  @@index([workflowId])
}

model AuditEvent {
  id        String   @id @default(cuid())
  type      String
  action    String
  userId    String?
  resource  String?
  success   Boolean  @default(true)
  severity  String   @default("low")
  category  String   @default("general")
  details   String? // JSON string
  ipAddress String?
  userAgent String?
  timestamp DateTime @default(now())

  @@index([type, timestamp])
  @@index([userId, timestamp])
  @@index([severity, timestamp])
  @@index([category, timestamp])
  @@index([success, timestamp])
}

model DeviceTrust {
  id          String   @id @default(cuid())
  deviceId    String   @unique
  userId      String
  fingerprint String
  trustScore  Float    @default(0.0)
  isActive    Boolean  @default(true)
  lastSeen    DateTime @default(now())
  ipAddress   String?
  userAgent   String?
  location    String?
  riskFactors String? // JSON string
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId, isActive])
  @@index([deviceId])
  @@index([trustScore])
}

// Modular Marquee System
model Marquee {
  id          String    @id @default(cuid())
  name        String // Admin-friendly name
  title       String? // Display title (e.g., "Trending", "Hot Coins")
  type        String    @default("token") // token, news, custom
  position    String    @default("header") // header, footer, content
  isActive    Boolean   @default(false)
  isPublished Boolean   @default(false)
  startDate   DateTime? // When to start showing
  endDate     DateTime? // When to stop showing
  priority    Int       @default(1) // Higher priority shows first

  // Styling Configuration
  styles MarqueeStyle?

  // Content Configuration
  items MarqueeItem[]

  // Metadata
  createdBy String? // User ID who created
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Analytics
  impressions Int @default(0)
  clicks      Int @default(0)

  @@index([isActive, isPublished])
  @@index([type, position])
  @@index([priority])
  @@index([startDate, endDate])
}

model MarqueeStyle {
  id        String  @id @default(cuid())
  marqueeId String  @unique
  marquee   Marquee @relation(fields: [marqueeId], references: [id], onDelete: Cascade)

  // Animation Settings
  speed        Float   @default(50.0) // Animation duration in seconds
  direction    String  @default("left") // left, right
  pauseOnHover Boolean @default(true)

  // Visual Settings
  backgroundColor String @default("#1f2937") // bg-gray-900
  textColor       String @default("#ffffff")
  fontSize        String @default("14px")
  fontWeight      String @default("normal")
  height          String @default("48px")
  borderRadius    String @default("0px")

  // Border and Effects
  borderWidth String @default("0px")
  borderColor String @default("#transparent")
  shadowColor String @default("transparent")
  shadowBlur  String @default("0px")

  // Icon Settings
  showIcons Boolean @default(true)
  iconColor String  @default("#f59e0b") // text-amber-500
  iconSize  String  @default("20px")

  // Layout Settings
  itemSpacing       String @default("32px") // gap between items
  paddingVertical   String @default("12px")
  paddingHorizontal String @default("16px")

  // Advanced Settings
  gradient  String? // CSS gradient string
  customCSS String? // Additional custom CSS

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MarqueeItem {
  id        String  @id @default(cuid())
  marqueeId String
  marquee   Marquee @relation(fields: [marqueeId], references: [id], onDelete: Cascade)

  // Content
  type        String // token, news, custom, link
  title       String // Main text to display
  subtitle    String? // Secondary text
  description String? // Tooltip or additional info

  // Links and Actions
  linkUrl    String? // Where to go when clicked
  linkTarget String  @default("_self") // _self, _blank

  // Token-specific fields
  symbol           String? // For token type
  price            Float? // Current price
  change24h        Float? // Price change
  changePercent24h Float? // Percentage change
  marketCap        Float? // Market capitalization
  volume24h        Float? // 24h volume
  isHot            Boolean @default(false) // Hot/trending indicator

  // Custom styling per item
  textColor String? // Override default text color
  bgColor   String? // Background color for this item
  icon      String? // Icon name or emoji
  iconColor String? // Icon color

  // Positioning and Display
  order     Int     @default(0) // Display order
  isVisible Boolean @default(true)

  // Analytics
  clicks Int @default(0)

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([marqueeId, order])
  @@index([type, isVisible])
}

model MarqueeTemplate {
  id          String  @id @default(cuid())
  name        String // Template name
  description String? // Template description
  category    String  @default("general") // general, crypto, news, finance
  isDefault   Boolean @default(false)

  // Template Configuration (JSON)
  styleConfig String // JSON string of MarqueeStyle
  itemsConfig String? // JSON string of sample items

  // Usage tracking
  usageCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category, isDefault])
}

// Admin Permission Model for RBAC
model AdminPermission {
  id          String   @id @default(cuid())
  adminId     String
  resource    String // users, content, analytics, ai, system, etc.
  actions     String // JSON array: ["create", "read", "update", "delete"]
  constraints String? // JSON object for additional rules
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  admin       User     @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@unique([adminId, resource])
  @@index([adminId])
  @@index([resource])
}

// Audit Log Model for tracking all admin actions
model AuditLog {
  id         String   @id @default(cuid())
  adminId    String
  action     String // login, logout, create_user, delete_article, etc.
  resource   String // user, article, category, etc.
  resourceId String? // ID of the affected resource
  details    String // JSON object with action details
  ipAddress  String
  userAgent  String
  status     String   @default("success") // success, failure
  timestamp  DateTime @default(now())
  admin      User     @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId, timestamp])
  @@index([action, timestamp])
  @@index([resource, resourceId])
  @@index([timestamp])
}

// Admin Role Model for predefined role templates
model AdminRole {
  id          String   @id @default(cuid())
  name        String   @unique // CONTENT_ADMIN, MARKETING_ADMIN, etc.
  displayName String // Content Administrator
  description String?
  permissions String // JSON array of permission objects
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
  @@index([isActive])
}

model BlacklistedIP {
  id        String    @id @default(cuid())
  ipAddress String    @unique
  userId    String?
  reason    String
  isActive  Boolean   @default(true)
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([ipAddress])
  @@index([userId])
  @@index([isActive])
  @@index([expiresAt])
}

// SEO Metadata Model for comprehensive SEO management
model SEOMetadata {
  id             String   @id @default(cuid())
  contentId      String // ID of the content (article, page, etc.)
  contentType    String // article, page, category, author
  metadata       String // JSON string of SEOMetadata interface
  raometa        String // JSON string of RAOMetadata interface
  structuredData String? // JSON-LD structured data
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([contentId, contentType])
  @@index([contentId])
  @@index([contentType])
  @@index([isActive])
  @@index([updatedAt])
}

// SEO Dashboard & Analytics Models for Task 60
model SEOKeyword {
  id               String       @id @default(cuid())
  keyword          String       @unique
  searchVolume     Int          @default(0)
  difficulty       Int          @default(0) // 0-100 scale
  cpc              Float        @default(0.0)
  currentPosition  Int? // Current SERP position
  previousPosition Int? // Previous position for comparison
  positionChange   Int? // Change from previous check
  targetPosition   Int          @default(1)
  targetUrl        String? // Target URL for this keyword
  contentId        String? // Associated content
  contentType      String? // article, page, etc.
  country          String       @default("global") // Target country/region
  language         String       @default("en")
  isActive         Boolean      @default(true) // Track if keyword is being monitored
  lastChecked      DateTime     @default(now()) // Last ranking check
  ranking          SEORanking[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  @@index([keyword])
  @@index([currentPosition])
  @@index([country, language])
  @@index([contentId])
  @@index([isActive])
}

model SEORanking {
  id               String     @id @default(cuid())
  keywordId        String
  keyword          SEOKeyword @relation(fields: [keywordId], references: [id], onDelete: Cascade)
  position         Int // SERP position
  url              String // Ranking URL
  title            String? // Page title in SERP
  snippet          String? // Meta description in SERP
  searchVolume     Int        @default(0) // Search volume for this keyword
  clicks           Int        @default(0)
  impressions      Int        @default(0)
  ctr              Float      @default(0.0)
  avgPosition      Float      @default(0.0)
  previousPosition Int? // Previous day position
  positionChange   Int? // Change from previous
  date             DateTime   @default(now()) // Date of this ranking check
  checkDate        DateTime   @default(now())
  createdAt        DateTime   @default(now())

  @@index([keywordId, checkDate])
  @@index([position])
  @@index([checkDate])
  @@index([date])
}

model SEOPageAnalysis {
  id          String  @id @default(cuid())
  url         String  @unique
  contentId   String? // Link to content
  contentType String? // article, page, etc.

  // SEO Scores
  overallScore     Int @default(0) // 0-100
  technicalScore   Int @default(0)
  contentScore     Int @default(0)
  mobileScore      Int @default(0)
  performanceScore Int @default(0)

  // Technical SEO
  hasH1              Boolean @default(false)
  hasMetaDescription Boolean @default(false)
  hasCanonical       Boolean @default(false)
  hasStructuredData  Boolean @default(false)
  hasAMP             Boolean @default(false)

  // Content Analysis
  wordCount        Int   @default(0)
  readabilityScore Int   @default(0) // Flesch-Kincaid
  keywordDensity   Float @default(0.0)
  internalLinks    Int   @default(0)
  externalLinks    Int   @default(0)
  imageCount       Int   @default(0)
  imagesMissingAlt Int   @default(0)

  // Performance Metrics
  loadTime               Float @default(0.0) // seconds
  timeToFirstByte        Float @default(0.0)
  firstContentfulPaint   Float @default(0.0)
  largestContentfulPaint Float @default(0.0)
  cumulativeLayoutShift  Float @default(0.0)

  // Issues
  issues SEOIssue[]

  // RAO Metrics
  raoScore              Int   @default(0) // 0-100
  llmCitations          Int   @default(0)
  aiOverviewAppearances Int   @default(0)
  semanticRelevance     Float @default(0.0)

  lastAnalyzed DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([url])
  @@index([contentId])
  @@index([overallScore])
  @@index([lastAnalyzed])
}

model SEOIssue {
  id     String          @id @default(cuid())
  pageId String
  page   SEOPageAnalysis @relation(fields: [pageId], references: [id], onDelete: Cascade)

  severity       String // critical, error, warning, info
  category       String // technical, content, performance, mobile, rao
  type           String // missing-h1, slow-load, broken-link, etc.
  message        String
  recommendation String
  affectedUrl    String? // URL with the issue
  metadata       String? // JSON with additional data

  isResolved Boolean   @default(false)
  resolvedAt DateTime?
  resolvedBy String? // User ID

  detectedAt DateTime @default(now())
  createdAt  DateTime @default(now())

  @@index([pageId, isResolved])
  @@index([severity, isResolved])
  @@index([category])
  @@index([detectedAt])
  @@index([type])
}

model SEOAlert {
  id             String  @id @default(cuid())
  type           String // ranking-drop, issue-detected, competitor-change, rao-update
  severity       String // critical, warning, info
  title          String
  message        String
  metadata       String // JSON with additional data
  resourceType   String? // keyword, article, page, etc.
  resourceId     String? // ID of related resource
  actionRequired Boolean @default(false)

  isRead     Boolean @default(false)
  isResolved Boolean @default(false)

  assignedTo String? // User ID
  resolvedAt DateTime?
  resolvedBy String? // User ID

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isRead, isResolved])
  @@index([severity])
  @@index([type])
  @@index([assignedTo])
  @@index([createdAt])
  @@index([resourceType, resourceId])
}

model SEOCompetitor {
  id       String  @id @default(cuid())
  domain   String  @unique
  name     String
  isActive Boolean @default(true)

  // Metrics
  domainAuthority Int @default(0)
  pageAuthority   Int @default(0)
  backlinks       Int @default(0)
  keywords        Int @default(0)
  traffic         Int @default(0)

  // Tracking
  lastScraped DateTime?
  analysis    SEOCompetitorAnalysis[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([domain])
  @@index([isActive])
}

model SEOCompetitorAnalysis {
  id           String        @id @default(cuid())
  competitorId String
  competitor   SEOCompetitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  keywordsRanking  Int    @default(0) // How many keywords they rank for
  topKeywords      String // JSON array
  averagePosition  Float  @default(0.0)
  contentPublished Int    @default(0) // New content count
  backlinksGained  Int    @default(0)

  analysisDate DateTime @default(now())

  @@index([competitorId, analysisDate])
  @@index([analysisDate])
}

model SEORankingPrediction {
  id        String @id @default(cuid())
  keywordId String
  url       String

  // Prediction Data
  currentPosition   Int
  predictedPosition Int // Predicted position in 30 days
  confidence        Float  @default(0.0) // 0-1
  trend             String // up, down, stable

  // Factors
  contentQuality     Float @default(0.0)
  technicalScore     Float @default(0.0)
  backlinks          Int   @default(0)
  competitorStrength Float @default(0.0)

  // Timeline
  predictionDate DateTime @default(now())
  targetDate     DateTime // 30 days from prediction

  createdAt DateTime @default(now())

  @@index([keywordId])
  @@index([predictionDate])
  @@index([trend])
}

model RAOPerformance {
  id          String @id @default(cuid())
  contentId   String
  contentType String // article, page, etc.
  url         String

  // LLM Citations
  llmCitations     Int    @default(0)
  citationSources  String // JSON array: [ChatGPT, Claude, Gemini, etc.]
  citationContexts String // JSON array of contexts

  // AI Overview Appearances
  aiOverviews     Int    @default(0)
  overviewSources String // JSON array

  // Semantic Analysis
  semanticRelevance Float  @default(0.0) // 0-1
  entityRecognition String // JSON of recognized entities
  topicCoverage     Float  @default(0.0) // 0-1

  // Quality Metrics
  contentStructure Int @default(0) // 0-100
  factualAccuracy  Int @default(0) // 0-100
  sourceAuthority  Int @default(0) // 0-100

  // Tracking
  trackingDate DateTime @default(now())

  @@index([contentId])
  @@index([llmCitations])
  @@index([aiOverviews])
  @@index([trackingDate])
}

model SEOBacklink {
  id              String  @id @default(cuid())
  sourceUrl       String
  targetUrl       String
  anchorText      String?
  domainAuthority Int     @default(0)
  pageAuthority   Int     @default(0)
  isDoFollow      Boolean @default(true)
  isActive        Boolean @default(true)

  firstSeen   DateTime @default(now())
  lastChecked DateTime @default(now())

  @@index([targetUrl, isActive])
  @@index([sourceUrl])
  @@index([domainAuthority])
  @@index([lastChecked])
}

model ContentSEOOptimization {
  id          String @id @default(cuid())
  contentId   String @unique
  contentType String // article, page, etc.

  // SEO Score Components
  overallScore     Int @default(0) // 0-100
  titleScore       Int @default(0)
  descriptionScore Int @default(0)
  keywordScore     Int @default(0)
  readabilityScore Int @default(0)
  technicalScore   Int @default(0)

  // Optimized Content
  optimizedTitle       String?
  optimizedDescription String?
  optimizedKeywords    String // JSON array
  suggestedHeadlines   String // JSON array of AI suggestions

  // Internal Links
  internalLinks      String // JSON array of link suggestions
  internalLinksCount Int    @default(0)
  externalLinksCount Int    @default(0)
  brokenLinksCount   Int    @default(0)

  // Readability Metrics
  fleschKincaidGrade      Float @default(0.0)
  fleschReadingEase       Float @default(0.0)
  averageWordsPerSentence Float @default(0.0)
  averageSyllablesPerWord Float @default(0.0)
  complexWordsPercent     Float @default(0.0)

  // RAO Content Structure
  semanticChunks   String // JSON array of content chunks
  canonicalAnswers String // JSON array
  entityMentions   String // JSON array
  factClaims       String // JSON array

  // AI Analysis
  aiHeadlineSuggestions String // JSON array
  aiContentSuggestions  String // JSON array
  aiKeywordSuggestions  String // JSON array

  // Issues and Recommendations
  issues          String // JSON array of SEO issues
  recommendations String // JSON array of recommendations

  // Tracking
  lastOptimized       DateTime @default(now())
  optimizedBy         String? // userId
  optimizationVersion Int      @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([contentId])
  @@index([overallScore])
  @@index([lastOptimized])
  @@index([contentType])
}

model HeadlineOptimization {
  id                String @id @default(cuid())
  contentId         String
  originalHeadline  String
  optimizedHeadline String

  // CTR Prediction
  predictedCTR Float  @default(0.0)
  actualCTR    Float?

  // Analysis
  emotionalScore Int    @default(0) // 0-100
  powerWords     String // JSON array
  lengthScore    Int    @default(0)
  clarityScore   Int    @default(0)

  // A/B Testing
  isActive    Boolean @default(false)
  impressions Int     @default(0)
  clicks      Int     @default(0)

  createdAt     DateTime  @default(now())
  testStartedAt DateTime?
  testEndedAt   DateTime?

  @@index([contentId, isActive])
  @@index([predictedCTR])
  @@index([createdAt])
}

model InternalLinkSuggestion {
  id              String  @id @default(cuid())
  sourceContentId String? // Optional for backward compatibility
  targetContentId String? // Optional for backward compatibility
  sourceUrl       String // Added for Task 63
  targetUrl       String
  anchorText      String
  contextSentence String? // Made optional

  // Relevance
  relevanceScore  Float   @default(0.0) // 0-1
  topicSimilarity Float   @default(0.0)
  priority        String? // high, medium, low (Added for Task 63)
  reason          String? // Added for Task 63

  // Status
  status         String    @default("suggested") // suggested, implemented, rejected
  implementedAt  DateTime?
  isRejected     Boolean   @default(false) // Added for Task 63
  rejectedReason String? // Added for Task 63

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sourceContentId, status])
  @@index([relevanceScore])
  @@index([status])
  @@index([sourceUrl])
  @@index([targetUrl])
  @@index([priority])
  @@index([implementedAt])
}

model ReadabilityAnalysis {
  id        String @id @default(cuid())
  contentId String @unique

  // Flesch-Kincaid Metrics
  fleschKincaidGrade Float @default(0.0)
  fleschReadingEase  Float @default(0.0)

  // Text Statistics
  wordCount               Int   @default(0)
  sentenceCount           Int   @default(0)
  paragraphCount          Int   @default(0)
  averageWordsPerSentence Float @default(0.0)
  averageSyllablesPerWord Float @default(0.0)

  // Complexity
  complexWordsCount   Int   @default(0)
  complexWordsPercent Float @default(0.0)
  longSentencesCount  Int   @default(0)

  // Grade Level
  gradeLevel     String // Elementary, Middle School, High School, College, Professional
  targetAudience String // General, Technical, Expert

  // Improvements
  suggestions String // JSON array

  analyzedAt DateTime @default(now())

  @@index([contentId])
  @@index([fleschKincaidGrade])
  @@index([gradeLevel])
}

// Task 62: AI-Driven Content Automation System
model ContentFeedSource {
  id            String    @id @default(cuid())
  name          String
  url           String
  type          String // RSS, API, SCRAPER, TWITTER, TELEGRAM
  category      String // CRYPTO, FINANCE, BLOCKCHAIN, DEFI, MEMECOINS
  region        String? // NIGERIA, KENYA, SOUTH_AFRICA, GHANA, GLOBAL
  isActive      Boolean   @default(true)
  priority      Int       @default(5) // 1-10, higher = more priority
  checkInterval Int       @default(3600) // seconds
  lastCheckedAt DateTime?
  successCount  Int       @default(0)
  failureCount  Int       @default(0)
  configuration String? // JSON config
  createdAt     DateTime  @default(now())
  updatedAt     DateTime

  automatedArticles AutomatedArticle[]

  @@index([isActive, priority])
  @@index([type, category])
  @@index([lastCheckedAt])
}

model AutomatedArticle {
  id                  String    @id @default(cuid())
  feedSourceId        String
  originalUrl         String
  originalTitle       String
  originalContent     String
  originalPublishedAt DateTime?

  // AI Processing
  rewrittenTitle   String?
  rewrittenContent String?
  rewrittenExcerpt String?

  // Optimization
  optimizedHeadline String?
  headlineScore     Float?  @default(0.0)
  seoKeywords       String? // JSON array

  // Categorization
  suggestedCategory String?
  suggestedTags     String? // JSON array
  confidence        Float?  @default(0.0)

  // Translation
  translationStatus   String  @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, FAILED
  translatedLanguages String? // JSON array of language codes

  // Quality
  qualityScore     Float @default(0.0)
  uniquenessScore  Float @default(0.0) // Plagiarism check
  readabilityScore Float @default(0.0)

  // Workflow Status
  status          String    @default("COLLECTED") // COLLECTED, REWRITTEN, OPTIMIZED, TRANSLATED, PENDING_APPROVAL, APPROVED, PUBLISHED, REJECTED
  approvalStatus  String    @default("PENDING") // PENDING, APPROVED, REJECTED
  approvedById    String?
  approvedAt      DateTime?
  rejectionReason String?

  // Publishing
  publishedArticleId String?   @unique
  scheduledPublishAt DateTime?
  publishedAt        DateTime?

  // Metadata
  processingStartedAt   DateTime?
  processingCompletedAt DateTime?
  processingTimeMs      Int?
  errorMessage          String?
  retryCount            Int       @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime

  feedSource       ContentFeedSource @relation(fields: [feedSourceId], references: [id], onDelete: Cascade)
  approvedBy       User?             @relation("AutomatedArticleApprover", fields: [approvedById], references: [id])
  publishedArticle Article?          @relation("AutomatedToPublished", fields: [publishedArticleId], references: [id])

  @@index([feedSourceId, status])
  @@index([status, approvalStatus])
  @@index([qualityScore])
  @@index([scheduledPublishAt])
  @@index([createdAt])
}

model ContentAutomationJob {
  id         String  @id @default(cuid())
  jobType    String // FEED_COLLECTION, REWRITE, OPTIMIZE, CATEGORIZE, TRANSLATE, PUBLISH
  status     String  @default("QUEUED") // QUEUED, RUNNING, COMPLETED, FAILED
  targetId   String? // AutomatedArticle ID or other target
  targetType String? // ARTICLE, BATCH

  // Configuration
  configuration String? // JSON config
  batchSize     Int?

  // Progress
  totalItems     Int @default(0)
  processedItems Int @default(0)
  successCount   Int @default(0)
  failureCount   Int @default(0)

  // Timing
  startedAt        DateTime?
  completedAt      DateTime?
  processingTimeMs Int?

  // Results
  results      String? // JSON results
  errorMessage String?

  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([jobType, status])
  @@index([status, createdAt])
  @@index([startedAt])
}

model ContentAutomationSettings {
  id String @id @default(cuid())

  // General Settings
  isEnabled            Boolean @default(true)
  autoPublish          Boolean @default(false) // Auto-publish approved content
  requireHumanApproval Boolean @default(true)

  // Quality Thresholds
  minQualityScore     Float @default(85.0)
  minUniquenessScore  Float @default(80.0)
  minReadabilityScore Float @default(70.0)

  // Processing Limits
  maxArticlesPerDay   Int @default(50)
  maxArticlesPerFeed  Int @default(10)
  processingBatchSize Int @default(5)

  // Translation Settings
  enableAutoTranslation Boolean @default(true)
  translationLanguages  String // JSON array of language codes

  // Scheduling
  collectionSchedule String @default("0 */3 * * *") // Cron expression
  publishingSchedule String @default("0 8,12,16,20 * * *") // Cron expression

  // AI Configuration
  aiProvider       String @default("openai") // openai, anthropic
  aiModel          String @default("gpt-4-turbo")
  translationModel String @default("nllb-200")

  // Notifications
  notifyOnApprovalNeeded Boolean @default(true)
  notifyOnPublish        Boolean @default(true)
  notifyOnErrors         Boolean @default(true)

  updatedAt DateTime
  updatedBy String?

  @@index([isEnabled])
}

// Task 63: SEO Automation Models
model Redirect {
  id         String  @id @default(cuid())
  fromPath   String  @unique
  toPath     String
  statusCode Int     @default(301) // 301 or 302
  isActive   Boolean @default(true)
  hits       Int     @default(0) // Track redirect usage

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  @@index([fromPath])
  @@index([isActive])
}

model AutomationLog {
  id          String    @id @default(cuid())
  type        String // seo_ranking, seo_links, seo_schema, etc.
  status      String // completed, failed, running
  startedAt   DateTime
  completedAt DateTime?
  duration    Int? // milliseconds
  metadata    String? // JSON with results
  error       String? // Error message if failed

  createdAt DateTime @default(now())

  @@index([type, status])
  @@index([startedAt])
  @@index([createdAt])
}

model ContentAutomationLog {
  id        String   @id @default(cuid())
  jobId     String?
  articleId String?
  level     String // INFO, WARNING, ERROR
  action    String // COLLECTION, REWRITE, CATEGORIZE, TRANSLATE, PUBLISH
  message   String
  details   String? // JSON details
  metadata  String? // JSON metadata
  createdAt DateTime @default(now())

  @@index([jobId])
  @@index([articleId])
  @@index([level, createdAt])
  @@index([action, createdAt])
}

// ========================================
// TASK 64: DISTRIBUTION & VIRAL GROWTH
// ========================================

model DistributionCampaign {
  id              String    @id @default(cuid())
  name            String
  description     String?
  type            String // AUTO_SHARE, EMAIL_NEWSLETTER, PARTNER_SYNDICATION
  status          String    @default("DRAFT") // DRAFT, ACTIVE, PAUSED, COMPLETED
  targetPlatforms String? // JSON array: ["TWITTER", "TELEGRAM", "WHATSAPP", "LINKEDIN"]
  contentFilter   String? // JSON: {categories: [], tags: [], minQuality: 85}
  schedule        String? // Cron expression or JSON schedule
  startDate       DateTime?
  endDate         DateTime?
  articlesShared  Int       @default(0)
  totalReach      Int       @default(0)
  totalEngagement Int       @default(0)
  totalRewards    Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  distributions ContentDistribution[]

  @@index([status, startDate])
  @@index([type, status])
  @@index([createdAt])
}

model ContentDistribution {
  id               String    @id @default(cuid())
  campaignId       String?
  articleId        String
  platform         String // TWITTER, TELEGRAM, WHATSAPP, LINKEDIN, EMAIL, PARTNER_API
  status           String    @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED
  scheduledAt      DateTime?
  publishedAt      DateTime?
  externalId       String? // Platform-specific post/message ID
  reach            Int       @default(0)
  impressions      Int       @default(0)
  clicks           Int       @default(0)
  shares           Int       @default(0)
  engagement       Float     @default(0)
  rewardsGenerated Int       @default(0)
  errorMessage     String?
  metadata         String? // JSON with platform-specific data
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  campaign DistributionCampaign? @relation(fields: [campaignId], references: [id])

  @@index([campaignId, status])
  @@index([articleId, platform])
  @@index([status, scheduledAt])
  @@index([publishedAt])
  @@index([createdAt])
}

model ReferralProgram {
  id             String    @id @default(cuid())
  name           String
  description    String?
  referrerReward Int       @default(100) // Points for referrer
  refereeReward  Int       @default(50) // Points for new user
  minimumShares  Int       @default(1)
  status         String    @default("ACTIVE") // ACTIVE, PAUSED, ENDED
  validFrom      DateTime  @default(now())
  validUntil     DateTime?
  totalReferrals Int       @default(0)
  totalRewards   Int       @default(0)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  referrals Referral[]

  @@index([status, validFrom])
  @@index([createdAt])
}

model Referral {
  id              String    @id @default(cuid())
  programId       String
  referrerId      String
  refereeId       String? // Null until signup
  referralCode    String    @unique
  refereeEmail    String?
  status          String    @default("PENDING") // PENDING, COMPLETED, EXPIRED, INVALID
  contentShared   String? // Article ID or content shared
  sharePlatform   String? // Platform used for sharing
  clickCount      Int       @default(0)
  signupCompleted Boolean   @default(false)
  referrerReward  Int       @default(0)
  refereeReward   Int       @default(0)
  rewardsPaid     Boolean   @default(false)
  completedAt     DateTime?
  expiresAt       DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  program ReferralProgram @relation(fields: [programId], references: [id])

  @@index([referrerId, status])
  @@index([refereeId])
  @@index([referralCode])
  @@index([status, createdAt])
  @@index([programId, status])
}

model UserReward {
  id          String    @id @default(cuid())
  userId      String
  rewardType  String // REFERRAL, SHARE, READ, COMMENT, LIKE, LEADERBOARD, BONUS
  points      Int
  source      String // Article ID, Referral ID, Campaign ID, etc.
  sourceType  String // ARTICLE, REFERRAL, CAMPAIGN, MANUAL
  description String?
  metadata    String? // JSON with additional context
  isProcessed Boolean   @default(false)
  processedAt DateTime?
  expiresAt   DateTime? // For time-limited rewards
  createdAt   DateTime  @default(now())

  @@index([userId, createdAt])
  @@index([rewardType, createdAt])
  @@index([isProcessed])
  @@index([sourceType, source])
  @@index([createdAt])
}

model EngagementLeaderboard {
  id              String   @id @default(cuid())
  userId          String
  period          String // DAILY, WEEKLY, MONTHLY, ALL_TIME
  periodStart     DateTime
  periodEnd       DateTime
  rank            Int
  totalPoints     Int      @default(0)
  sharesCount     Int      @default(0)
  referralsCount  Int      @default(0)
  engagementCount Int      @default(0)
  contentViews    Int      @default(0)
  streakDays      Int      @default(0)
  badges          String? // JSON array of badge IDs
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())

  @@unique([userId, period, periodStart])
  @@index([period, periodStart, rank])
  @@index([userId, period])
  @@index([totalPoints])
  @@index([rank])
}

model PartnerSyndication {
  id               String    @id @default(cuid())
  partnerName      String
  partnerDomain    String
  contactEmail     String
  apiKey           String    @unique
  status           String    @default("ACTIVE") // ACTIVE, SUSPENDED, INACTIVE
  tier             String    @default("BASIC") // BASIC, PREMIUM, ENTERPRISE
  accessLevel      String    @default("PUBLIC") // PUBLIC, PREMIUM, ALL
  articlesShared   Int       @default(0)
  totalRequests    Int       @default(0)
  lastAccessAt     DateTime?
  rateLimitPerHour Int       @default(100)
  widgetCode       String? // Generated widget embed code
  webhookUrl       String?
  metadata         String? // JSON with partner-specific settings
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  requests SyndicationRequest[]

  @@index([status, tier])
  @@index([apiKey])
  @@index([createdAt])
}

model SyndicationRequest {
  id             String   @id @default(cuid())
  partnerId      String
  articleId      String?
  requestType    String // ARTICLE, FEED, WIDGET, SEARCH
  requestPath    String
  responseStatus Int
  responseTime   Int // milliseconds
  bytesServed    Int      @default(0)
  ipAddress      String?
  userAgent      String?
  metadata       String?
  createdAt      DateTime @default(now())

  partner PartnerSyndication @relation(fields: [partnerId], references: [id])

  @@index([partnerId, createdAt])
  @@index([requestType, createdAt])
  @@index([createdAt])
}

model NewsletterCampaign {
  id               String    @id @default(cuid())
  name             String
  subject          String
  content          String // HTML content
  status           String    @default("DRAFT") // DRAFT, SCHEDULED, SENDING, SENT, FAILED
  recipientFilter  String? // JSON: {tier: "PREMIUM", language: "en"}
  totalRecipients  Int       @default(0)
  sentCount        Int       @default(0)
  openCount        Int       @default(0)
  clickCount       Int       @default(0)
  bounceCount      Int       @default(0)
  unsubscribeCount Int       @default(0)
  scheduledAt      DateTime?
  sentAt           DateTime?
  errorMessage     String?
  metadata         String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  sends NewsletterSend[]

  @@index([status, scheduledAt])
  @@index([createdAt])
}

model NewsletterSend {
  id             String    @id @default(cuid())
  campaignId     String
  recipientEmail String
  recipientId    String?
  status         String    @default("PENDING") // PENDING, SENT, OPENED, CLICKED, BOUNCED, FAILED
  sentAt         DateTime?
  openedAt       DateTime?
  clickedAt      DateTime?
  bouncedAt      DateTime?
  errorMessage   String?
  metadata       String?
  createdAt      DateTime  @default(now())

  campaign NewsletterCampaign @relation(fields: [campaignId], references: [id])

  @@index([campaignId, status])
  @@index([recipientEmail])
  @@index([recipientId])
  @@index([status, createdAt])
}

// ========================================
// TASK 65: GLOBAL & AFRICAN LOCALIZATION
// ========================================

model LocalizedContent {
  id           String  @id @default(cuid())
  contentId    String // Article, page, or content ID
  contentType  String // ARTICLE, PAGE, CATEGORY, etc.
  countryCode  String // NG, KE, ZA, GH, etc.
  regionCode   String? // WEST_AFRICA, EAST_AFRICA, etc.
  languageCode String // en, sw, fr, ha, ig, yo, zu, am, etc.

  // Localized Content
  title          String
  excerpt        String?
  content        String
  seoTitle       String?
  seoDescription String?
  keywords       String? // JSON array of localized keywords

  // Regional Customization
  currency          String? // NGN, KES, ZAR, GHS, etc.
  priceLocalization String? // JSON with localized prices
  paymentMethods    String? // JSON array of local payment methods
  legalDisclaimer   String? // Country-specific legal text

  // Status
  status        String    @default("DRAFT") // DRAFT, PUBLISHED, ARCHIVED
  publishedAt   DateTime?
  qualityScore  Float     @default(0)
  humanReviewed Boolean   @default(false)
  reviewedBy    String?

  // Analytics
  views      Int @default(0)
  engagement Int @default(0)
  shareCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([contentId, countryCode, languageCode])
  @@index([contentId, status])
  @@index([countryCode, languageCode])
  @@index([regionCode, status])
  @@index([publishedAt])
}

model RegionConfiguration {
  id          String @id @default(cuid())
  countryCode String @unique
  countryName String
  region      String // WEST_AFRICA, EAST_AFRICA, SOUTHERN_AFRICA, NORTH_AFRICA
  subdomain   String @unique // ng, ke, za, gh

  // Languages
  primaryLanguage    String @default("en")
  supportedLanguages String // JSON array
  defaultLanguage    String @default("en")

  // Localization Settings
  currency     String
  timezone     String
  dateFormat   String @default("DD/MM/YYYY")
  numberFormat String @default("1,000.00")

  // Market Data
  exchangePriority String? // JSON array of prioritized exchanges
  cryptoFocus      String? // JSON array of focused cryptocurrencies

  // Features
  featuresEnabled String? // JSON of country-specific features
  paymentMethods  String? // JSON array of available payment methods

  // SEO
  metaTitle       String?
  metaDescription String?
  targetKeywords  String? // JSON array

  // Status
  isActive   Boolean   @default(true)
  launchDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  seoConfigs  RegionalSEOConfig[]
  influencers AfricanInfluencer[]
  marketData  RegionalMarketData[]

  @@index([region, isActive])
  @@index([subdomain])
  @@index([countryCode])
}

model RegionalSEOConfig {
  id          String @id @default(cuid())
  countryCode String

  // Target Keywords
  primaryKeywords   String // JSON array
  secondaryKeywords String? // JSON array
  longTailKeywords  String? // JSON array

  // Search Engines
  targetSearchEngines String @default("[\"Google\",\"Bing\"]") // JSON array

  // Competitor Keywords
  competitorKeywords String? // JSON array
  keywordGaps        String? // JSON array

  // Performance
  averagePosition  Float @default(0)
  totalImpressions Int   @default(0)
  totalClicks      Int   @default(0)
  averageCTR       Float @default(0)

  // Local Citations
  localDirectories String? // JSON array
  citationCount    Int     @default(0)

  // Tracking
  lastUpdated DateTime  @default(now())
  lastCrawled DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  region RegionConfiguration @relation(fields: [countryCode], references: [countryCode], onDelete: Cascade)

  @@unique([countryCode])
  @@index([countryCode, averagePosition])
  @@index([lastUpdated])
}

model AfricanInfluencer {
  id          String  @id @default(cuid())
  name        String
  username    String?
  platform    String // TWITTER, TELEGRAM, YOUTUBE, INSTAGRAM, LINKEDIN
  profileUrl  String
  countryCode String?
  region      String? // WEST_AFRICA, EAST_AFRICA, etc.

  // Metrics
  followersCount Int   @default(0)
  engagementRate Float @default(0)
  averageLikes   Int   @default(0)
  averageShares  Int   @default(0)

  // Partnership
  partnershipStatus String    @default("PROSPECTIVE") // PROSPECTIVE, CONTACTED, NEGOTIATING, ACTIVE, INACTIVE
  partnershipType   String? // CONTENT_COLLABORATION, SPONSORED_POST, AMBASSADOR, AFFILIATE
  contractStart     DateTime?
  contractEnd       DateTime?
  paymentTerms      String? // JSON

  // Content Focus
  topics   String? // JSON array: crypto, defi, nft, trading
  audience String? // JSON: demographics, interests

  // Performance
  postsPublished  Int @default(0)
  totalReach      Int @default(0)
  totalEngagement Int @default(0)
  conversions     Int @default(0)

  // Contact
  email          String?
  phone          String?
  managerContact String?

  // Notes
  notes String?
  tags  String? // JSON array

  // Tracking
  lastContactDate DateTime?
  lastPostDate    DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  regionConfig RegionConfiguration? @relation(fields: [countryCode], references: [countryCode])
  posts        InfluencerPost[]

  @@index([countryCode, partnershipStatus])
  @@index([platform, partnershipStatus])
  @@index([partnershipStatus, contractEnd])
  @@index([engagementRate])
}

model InfluencerPost {
  id           String  @id @default(cuid())
  influencerId String
  articleId    String?

  // Post Details
  platform String
  postUrl  String
  postType String // ORIGINAL, SHARED, SPONSORED
  content  String?

  // Metrics
  likes    Int @default(0)
  comments Int @default(0)
  shares   Int @default(0)
  views    Int @default(0)
  clicks   Int @default(0)

  // Performance
  engagementRate   Float @default(0)
  reachEstimate    Int   @default(0)
  conversions      Int   @default(0)
  revenueGenerated Float @default(0)

  publishedAt DateTime
  createdAt   DateTime @default(now())

  influencer AfricanInfluencer @relation(fields: [influencerId], references: [id], onDelete: Cascade)

  @@index([influencerId, publishedAt])
  @@index([articleId])
  @@index([platform, publishedAt])
}

model RegionalMarketData {
  id          String @id @default(cuid())
  countryCode String

  // Market Metrics
  totalMarketCap   Float   @default(0)
  tradingVolume24h Float   @default(0)
  activeTraders    Int     @default(0)
  popularExchanges String? // JSON array

  // Top Tokens
  topGainers     String? // JSON array of token data
  topLosers      String? // JSON array of token data
  trendingTokens String? // JSON array

  // Regional Trends
  popularPairs  String? // JSON array
  localProjects String? // JSON array
  adoption      Float   @default(0) // 0-100 adoption score
  sentiment     String  @default("NEUTRAL") // BULLISH, NEUTRAL, BEARISH

  // Fiat Integration
  fiatGateways           String? // JSON array
  mobileMoneyIntegration Boolean @default(false)
  bankingPartners        String? // JSON array

  // Data Source
  dataSource  String
  lastUpdated DateTime @default(now())

  createdAt DateTime @default(now())

  regionConfig RegionConfiguration @relation(fields: [countryCode], references: [countryCode], onDelete: Cascade)

  @@index([countryCode, lastUpdated])
  @@index([lastUpdated])
}

model MediaSyndicationWidget {
  id          String  @id @default(cuid())
  name        String
  description String?
  widgetType  String // ARTICLE_FEED, PRICE_TICKER, MARKET_OVERVIEW, TRENDING

  // Configuration
  targetCountries String // JSON array
  targetLanguages String // JSON array
  contentFilter   String? // JSON filter configuration

  // Styling
  theme     String  @default("light") // light, dark, custom
  customCSS String?
  layout    String  @default("grid") // grid, list, carousel
  maxItems  Int     @default(10)

  // Embed Code
  embedCode String @unique
  iframeUrl String

  // API Access
  apiKey           String @unique
  apiEndpoint      String
  rateLimitPerHour Int    @default(1000)

  // Usage
  installCount  Int @default(0)
  totalRequests Int @default(0)
  totalViews    Int @default(0)
  totalClicks   Int @default(0)

  // Partner Info
  partnerName    String?
  partnerDomain  String?
  partnerContact String?

  // Status
  status String @default("ACTIVE") // ACTIVE, SUSPENDED, INACTIVE

  // Tracking
  lastAccessAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  requests WidgetRequest[]

  @@index([status, targetCountries])
  @@index([widgetType, status])
  @@index([apiKey])
  @@index([embedCode])
}

model WidgetRequest {
  id       String @id @default(cuid())
  widgetId String

  // Request Details
  requestType     String // API, IFRAME, EMBED
  contentReturned String? // JSON of returned content IDs

  // Client Info
  ipAddress String?
  userAgent String?
  referrer  String?
  country   String?

  // Performance
  responseTime Int // milliseconds
  cacheHit     Boolean @default(false)

  createdAt DateTime @default(now())

  widget MediaSyndicationWidget @relation(fields: [widgetId], references: [id], onDelete: Cascade)

  @@index([widgetId, createdAt])
  @@index([country, createdAt])
  @@index([createdAt])
}

model AfricanCryptoIndex {
  id     String  @id @default(cuid())
  name   String  @unique // African Crypto Index, West Africa Index, etc.
  symbol String  @unique // ACI, WAI, EAI, SAI
  region String? // ALL, WEST_AFRICA, EAST_AFRICA, SOUTHERN_AFRICA

  // Index Composition
  constituents       String // JSON array of tokens and weights
  methodology        String // Market cap weighted, equal weighted, etc.
  rebalanceFrequency String    @default("MONTHLY")
  lastRebalance      DateTime?
  nextRebalance      DateTime?

  // Index Value
  currentValue     Float @default(100)
  previousValue    Float @default(100)
  change24h        Float @default(0)
  changePercent24h Float @default(0)
  allTimeHigh      Float @default(100)
  allTimeLow       Float @default(100)

  // Market Metrics
  totalMarketCap   Float @default(0)
  totalVolume24h   Float @default(0)
  averageMarketCap Float @default(0)

  // Performance
  performance7d  Float @default(0)
  performance30d Float @default(0)
  performance1y  Float @default(0)
  volatility     Float @default(0)
  sharpeRatio    Float @default(0)

  // Status
  isActive    Boolean @default(true)
  isPublished Boolean @default(false)

  // Metadata
  description String?
  website     String?
  whitepaper  String?

  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  historicalData IndexHistoricalData[]

  @@index([symbol, isActive])
  @@index([region, isActive])
  @@index([lastUpdated])
}

model IndexHistoricalData {
  id      String @id @default(cuid())
  indexId String

  value         Float
  marketCap     Float @default(0)
  volume24h     Float @default(0)
  change        Float @default(0)
  changePercent Float @default(0)

  timestamp DateTime

  index AfricanCryptoIndex @relation(fields: [indexId], references: [id], onDelete: Cascade)

  @@unique([indexId, timestamp])
  @@index([indexId, timestamp])
  @@index([timestamp])
}

model LocalizationSettings {
  id String @id @default(cuid())

  // Global Settings
  autoLocalization Boolean @default(true)
  defaultLanguage  String  @default("en")
  fallbackLanguage String  @default("en")

  // Regional Priority
  priorityRegions String // JSON array: ["NG", "KE", "ZA", "GH"]

  // Translation Settings
  enableAutoTranslation       Boolean @default(true)
  translationQualityThreshold Float   @default(85)
  requireHumanReview          Boolean @default(true)
  translationProvider         String  @default("nllb-200")

  // Content Distribution
  enableRegionalContent  Boolean @default(true)
  regionalContentPercent Float   @default(50) // % of region-specific content

  // SEO Localization
  enableLocalSEO       Boolean @default(true)
  autoGenerateKeywords Boolean @default(true)

  // Influencer Program
  enableInfluencerNetwork   Boolean @default(true)
  minEngagementRate         Float   @default(2.0)
  maxPartnershipCostPerPost Float   @default(1000)

  // Market Data
  enableAfricanIndex  Boolean @default(true)
  indexUpdateInterval Int     @default(300) // seconds

  // Syndication
  enableMediaSyndication Boolean @default(true)
  maxWidgetsPerPartner   Int     @default(5)

  updatedAt DateTime @updatedAt
  updatedBy String?

  @@index([autoLocalization])
}

// ============================================
// TASK 66: ENGAGEMENT, UX & PERSONALIZATION
// ============================================

model UserPreference {
  id     String @id @default(cuid())
  userId String @unique

  // Content Preferences
  favoriteCategories String // JSON array
  followedAuthors    String // JSON array
  blockedCategories  String // JSON array
  contentLanguages   String // JSON array

  // Reading Preferences
  readingLevel    String @default("INTERMEDIATE") // BEGINNER, INTERMEDIATE, ADVANCED
  contentLength   String @default("MEDIUM") // SHORT, MEDIUM, LONG
  preferredTopics String // JSON array

  // Notification Preferences
  pushEnabled     Boolean @default(true)
  emailDigest     Boolean @default(true)
  digestFrequency String  @default("DAILY") // REALTIME, DAILY, WEEKLY
  priceAlerts     Boolean @default(true)
  breakingNews    Boolean @default(true)

  // Personalization Settings
  aiRecommendations Boolean @default(true)
  voiceNewsEnabled  Boolean @default(false)
  autoPlayVideos    Boolean @default(false)

  // Portfolio & Exclusions (new fields for AI recommendation service)
  portfolioSymbols String @default("[]") // JSON array of token symbols user holds
  excludedTopics   String @default("[]") // JSON array of topics to exclude from recommendations

  // AI Learning Data
  preferences String? // JSON field for AI-generated preferences

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model UserBehavior {
  id     String @id @default(cuid())
  userId String

  // Reading Patterns
  avgReadingTime       Int // seconds
  avgScrollDepth       Float // percentage
  preferredReadingTime String // JSON: {hour: frequency}
  devicePreference     String @default("MOBILE") // MOBILE, TABLET, DESKTOP

  // Engagement Metrics
  articlesRead   Int @default(0)
  articlesShared Int @default(0)
  commentsPosted Int @default(0)
  reactionsGiven Int @default(0)

  // Content Preferences (AI-derived)
  topCategories    String // JSON array with scores
  topAuthors       String // JSON array with scores
  topTags          String // JSON array with scores
  sentimentProfile String // JSON: {positive: 0.7, neutral: 0.2, negative: 0.1}

  // Engagement Score
  engagementScore Float    @default(0) // 0-100
  lastEngagement  DateTime @default(now())

  // Streak Data
  currentStreak Int      @default(0)
  longestStreak Int      @default(0)
  lastVisitDate DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId])
  @@index([userId])
  @@index([engagementScore])
  @@index([lastEngagement])
}

model ContentRecommendation {
  id        String @id @default(cuid())
  userId    String
  articleId String

  // Recommendation Metadata
  recommendationType String // PERSONALIZED, TRENDING, SIMILAR, COLLABORATIVE
  score              Float // 0-1 confidence score
  reason             String // JSON: {factors: [...]}

  // Performance Tracking
  shown        Boolean @default(false)
  clicked      Boolean @default(false)
  read         Boolean @default(false)
  readDuration Int? // seconds

  // Context
  position Int // Position in feed
  context  String // HOME, ARTICLE_END, CATEGORY, SEARCH

  shownAt   DateTime?
  clickedAt DateTime?

  createdAt DateTime @default(now())
  expiresAt DateTime // Recommendations expire after 24 hours

  @@index([userId, shown])
  @@index([userId, clicked])
  @@index([articleId])
  @@index([expiresAt])
  @@index([recommendationType])
}

model ReadingReward {
  id        String @id @default(cuid())
  userId    String
  articleId String

  // Reward Details
  rewardType   String // READ, SHARE, COMMENT, STREAK, MILESTONE
  pointsEarned Int
  multiplier   Float  @default(1.0)

  // Reading Metrics
  readDuration     Int // seconds
  scrollPercentage Float
  completedArticle Boolean @default(false)

  // Gamification
  badgeEarned String? // JSON: {id, name, icon}
  levelUp     Boolean @default(false)

  awardedAt DateTime @default(now())

  @@index([userId, awardedAt])
  @@index([articleId])
  @@index([rewardType])
}

model PushSubscription {
  id     String @id @default(cuid())
  userId String

  // Subscription Details
  endpoint String @unique
  p256dh   String // Encryption key
  auth     String // Auth secret

  // Device Information
  deviceType String // MOBILE, TABLET, DESKTOP
  browser    String
  os         String

  // Subscription Status
  isActive Boolean  @default(true)
  lastUsed DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, isActive])
  @@index([endpoint])
}

model PushNotification {
  id     String  @id @default(cuid())
  userId String? // Null for broadcast

  // Notification Content
  title String
  body  String
  icon  String?
  image String?
  badge String?

  // Action
  actionUrl  String?
  actionData String? // JSON

  // Targeting
  segment String? // ALL, PREMIUM, ACTIVE, etc.
  tags    String? // JSON array

  // Status
  status         String @default("PENDING") // PENDING, SENT, FAILED
  sentCount      Int    @default(0)
  deliveredCount Int    @default(0)
  clickedCount   Int    @default(0)

  // Scheduling
  scheduledFor DateTime?
  sentAt       DateTime?

  createdAt DateTime @default(now())

  @@index([userId, status])
  @@index([status, scheduledFor])
  @@index([createdAt])
}

model VoiceArticle {
  id        String @id @default(cuid())
  articleId String @unique

  // Audio Details
  audioUrl String
  duration Int // seconds
  fileSize Int // bytes
  format   String @default("mp3")

  // Generation Metadata
  voiceModel       String @default("tts-1") // OpenAI TTS model
  voiceType        String @default("alloy") // Voice variant
  generationStatus String @default("COMPLETED")

  // Performance
  playCount           Int   @default(0)
  avgListenPercentage Float @default(0)

  // Quality
  qualityScore       Float?
  transcriptAccuracy Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([articleId])
  @@index([generationStatus])
}

model PWAInstall {
  id     String  @id @default(cuid())
  userId String?

  // Installation Details
  installId String @unique // Client-generated unique ID
  platform  String // ANDROID, IOS, WINDOWS, MAC, LINUX
  browser   String

  // Device Info
  deviceType       String // MOBILE, TABLET, DESKTOP
  screenResolution String
  viewport         String

  // Usage Stats
  isActive      Boolean  @default(true)
  lastUsed      DateTime @default(now())
  sessionCount  Int      @default(0)
  totalDuration Int      @default(0) // seconds

  installedAt   DateTime  @default(now())
  uninstalledAt DateTime?

  @@index([userId])
  @@index([installId])
  @@index([isActive])
  @@index([platform])
}

model EngagementMilestone {
  id     String @id @default(cuid())
  userId String

  // Milestone Details
  type         String // ARTICLES_READ, DAYS_ACTIVE, POINTS_EARNED, SHARES, COMMENTS
  threshold    Int // Milestone threshold
  currentValue Int // Current progress

  // Status
  achieved   Boolean   @default(false)
  achievedAt DateTime?

  // Reward
  rewardPoints     Int     @default(0)
  rewardBadge      String? // JSON badge data
  notificationSent Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, type])
  @@index([achieved])
}

model PersonalizationModel {
  id     String @id @default(cuid())
  userId String @unique

  // Model Weights (AI-generated)
  categoryWeights String // JSON: {category_id: weight}
  authorWeights   String // JSON: {author_id: weight}
  tagWeights      String // JSON: {tag: weight}

  // Behavioral Patterns
  timePreferences      String // JSON: {hour: score}
  lengthPreference     Float // Preferred article length score
  complexityPreference Float // Content complexity score

  // Content Velocity
  newContentWeight Float @default(0.3)
  trendingWeight   Float @default(0.3)
  personalWeight   Float @default(0.4)

  // Model Metadata
  modelVersion       String   @default("1.0")
  lastTrained        DateTime @default(now())
  trainingDataPoints Int      @default(0)
  accuracy           Float? // Model accuracy score

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([lastTrained])
}

// ============= TASK 67: CONTINUOUS SEO UPDATE & ALGORITHM DEFENSE =============

model AlgorithmUpdate {
  id String @id @default(cuid())

  // Update Details
  source      String // GOOGLE, BING, MANUAL, SERP_VOLATILITY
  updateType  String // CORE_UPDATE, SPAM_UPDATE, CONTENT_UPDATE, TECHNICAL_UPDATE
  name        String // E.g., "Google March 2025 Core Update"
  description String?

  // Impact Assessment
  severity           String // CRITICAL, HIGH, MEDIUM, LOW
  affectedCategories String // JSON array: [content, technical, backlinks, etc.]
  estimatedImpact    Float  @default(0.0) // 0-1 scale

  // Our Site Impact
  rankingChanges   Int   @default(0) // Net ranking changes
  trafficChange    Float @default(0.0) // % change
  affectedPages    Int   @default(0)
  affectedKeywords Int   @default(0)

  // Status
  status      String    @default("DETECTED") // DETECTED, ANALYZING, RECOVERING, ADAPTED
  detectedAt  DateTime  @default(now())
  confirmedAt DateTime?
  adaptedAt   DateTime?

  // Response
  responseActions   AlgorithmResponse[]
  recoveryWorkflows SEORecoveryWorkflow[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([source, detectedAt])
  @@index([status])
  @@index([severity])
  @@index([updateType])
}

model AlgorithmResponse {
  id                String          @id @default(cuid())
  algorithmUpdateId String
  algorithmUpdate   AlgorithmUpdate @relation(fields: [algorithmUpdateId], references: [id], onDelete: Cascade)

  // Action Details
  actionType  String // SCHEMA_UPDATE, CONTENT_REFRESH, TECHNICAL_FIX, BACKLINK_AUDIT
  priority    String // URGENT, HIGH, MEDIUM, LOW
  description String

  // Execution
  status                String  @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, FAILED
  automatedAction       Boolean @default(false) // If action can be automated
  executedAutomatically Boolean @default(false)

  // Results
  affectedUrls  String? // JSON array
  successRate   Float? // 0-1
  resultMetrics String? // JSON with metrics

  scheduledAt DateTime?
  executedAt  DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([algorithmUpdateId, status])
  @@index([actionType])
  @@index([priority])
}

model SERPVolatility {
  id String @id @default(cuid())

  // Volatility Metrics
  keyword          String
  previousPosition Int
  currentPosition  Int
  positionChange   Int // Absolute change
  percentageChange Float // % change

  // Context
  category           String? // Content category
  searchIntent       String? // informational, transactional, navigational
  competitorMovement String // JSON: {competitor: change}

  // Detection
  volatilityScore Float   @default(0.0) // 0-1, how volatile
  isAnomaly       Boolean @default(false) // Unusual volatility
  requiresAction  Boolean @default(false)

  // Response
  alertGenerated Boolean @default(false)
  actionTaken    String? // JSON of actions

  checkDate DateTime @default(now())
  createdAt DateTime @default(now())

  @@index([keyword, checkDate])
  @@index([isAnomaly, requiresAction])
  @@index([volatilityScore])
  @@index([checkDate])
}

model SchemaRefresh {
  id String @id @default(cuid())

  // Target Details
  contentId   String
  contentType String // article, page, category
  url         String

  // Schema Details
  schemaType     String // NewsArticle, FAQPage, HowTo, etc.
  previousSchema String // JSON of old schema
  updatedSchema  String // JSON of new schema

  // Changes Applied
  changeReason   String // ALGORITHM_UPDATE, VALIDATION_ERROR, OPTIMIZATION
  changesApplied String // JSON array of specific changes

  // Validation
  validationStatus String  @default("PENDING") // PENDING, VALID, INVALID
  validationErrors String? // JSON array
  googleValidation Boolean @default(false)

  // Impact
  richSnippetBefore Boolean  @default(false)
  richSnippetAfter  Boolean?
  clickRateChange   Float? // CTR change after refresh

  refreshedAt DateTime  @default(now())
  validatedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([contentId])
  @@index([validationStatus])
  @@index([refreshedAt])
  @@index([schemaType])
}

model ContentFreshnessAgent {
  id String @id @default(cuid())

  // Content Details
  contentId   String
  contentType String // article, page
  url         String

  // Freshness Metrics
  publishDate    DateTime
  lastModified   DateTime
  freshnessScore Int      @default(0) // 0-100
  contentAge     Int      @default(0) // Days since publish
  lastUpdateAge  Int      @default(0) // Days since last update

  // Update Requirements
  requiresUpdate Boolean @default(false)
  updateReason   String? // OUTDATED_DATA, ALGORITHM_CHANGE, COMPETITOR_UPDATE
  updatePriority String  @default("MEDIUM") // URGENT, HIGH, MEDIUM, LOW

  // Update Tracking
  updateType     String? // FULL_REWRITE, PARTIAL_UPDATE, DATA_REFRESH, TECHNICAL_FIX
  updatesApplied String? // JSON array of updates

  // Performance
  trafficBefore  Int     @default(0)
  trafficAfter   Int?
  rankingsBefore String // JSON: {keyword: position}
  rankingsAfter  String? // JSON: {keyword: position}

  // Status
  status String @default("MONITORING") // MONITORING, UPDATE_SCHEDULED, UPDATING, COMPLETED

  lastChecked DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  completedAt DateTime?

  createdAt DateTime @default(now())

  @@index([contentId])
  @@index([requiresUpdate, updatePriority])
  @@index([status])
  @@index([freshnessScore])
  @@index([lastChecked])
}

model SEORecoveryWorkflow {
  id                String           @id @default(cuid())
  algorithmUpdateId String?
  algorithmUpdate   AlgorithmUpdate? @relation(fields: [algorithmUpdateId], references: [id])

  // Workflow Details
  name            String
  triggerType     String // ALGORITHM_UPDATE, RANKING_DROP, TRAFFIC_DROP, MANUAL
  triggerSeverity String // CRITICAL, HIGH, MEDIUM, LOW

  // Affected Resources
  affectedUrls     String // JSON array
  affectedKeywords String // JSON array
  estimatedImpact  Float  @default(0.0) // Traffic loss %

  // Recovery Steps
  steps          SEORecoveryStep[]
  totalSteps     Int               @default(0)
  completedSteps Int               @default(0)

  // Status
  status   String @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, FAILED
  progress Int    @default(0) // 0-100

  // Results
  recoveryRate   Float? // % of traffic/rankings recovered
  timeToRecover  Int? // Days taken
  successMetrics String? // JSON with results

  startedAt   DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([triggerType, triggerSeverity])
  @@index([algorithmUpdateId])
}

model SEORecoveryStep {
  id         String              @id @default(cuid())
  workflowId String
  workflow   SEORecoveryWorkflow @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  // Step Details
  stepOrder   Int
  stepType    String // TECHNICAL_FIX, CONTENT_UPDATE, SCHEMA_REFRESH, BACKLINK_AUDIT
  name        String
  description String

  // Execution
  isAutomated          Boolean @default(false)
  automationScript     String? // JSON with automation details
  requiredManualAction String?

  // Dependencies
  dependsOnSteps String? // JSON array of step IDs
  blockedBy      String? // Step ID blocking this step

  // Status
  status String @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, FAILED, SKIPPED

  // Results
  executionLog  String? // JSON execution log
  errorMessage  String?
  impactMetrics String? // JSON with impact data

  startedAt   DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([workflowId, stepOrder])
  @@index([status])
  @@index([stepType])
}

model SEODefenseMetrics {
  id String @id @default(cuid())

  // Time Period
  date   DateTime @default(now())
  period String   @default("DAILY") // HOURLY, DAILY, WEEKLY, MONTHLY

  // Algorithm Monitoring
  algorithmsDetected Int   @default(0)
  criticalUpdates    Int   @default(0)
  responseTime       Float @default(0.0) // Avg hours to respond

  // SERP Volatility
  volatileKeywords   Int   @default(0)
  avgVolatilityScore Float @default(0.0)
  anomaliesDetected  Int   @default(0)

  // Schema Management
  schemasRefreshed Int   @default(0)
  validationRate   Float @default(0.0) // % passing validation
  richSnippetRate  Float @default(0.0) // % with rich snippets

  // Content Freshness
  contentUpdated    Int   @default(0)
  avgFreshnessScore Float @default(0.0)
  urgentUpdates     Int   @default(0)

  // Recovery
  workflowsActive    Int   @default(0)
  workflowsCompleted Int   @default(0)
  avgRecoveryTime    Float @default(0.0) // Days
  avgRecoveryRate    Float @default(0.0) // % recovered

  // Overall Health
  defenseScore    Int   @default(0) // 0-100 overall defense health
  readinessScore  Int   @default(0) // 0-100 preparedness
  adaptationSpeed Float @default(0.0) // Hours to adapt

  createdAt DateTime @default(now())

  @@index([date, period])
  @@index([defenseScore])
}

// ============= TASK 68: PREDICTIVE SEO INTELLIGENCE MODELS =============

model EEATScore {
  id          String @id @default(cuid())
  contentId   String @unique
  contentType String // article, page, author

  // E-E-A-T Components (0-100 each)
  experienceScore        Int @default(0)
  expertiseScore         Int @default(0)
  authoritativenessScore Int @default(0)
  trustworthinessScore   Int @default(0)
  overallScore           Int @default(0)

  // Experience Indicators
  firsthandExperience Boolean @default(false)
  personalInsights    Boolean @default(false)
  uniquePerspective   Boolean @default(false)
  realWorldExamples   Boolean @default(false)

  // Expertise Indicators
  authorCredentials   String // JSON array
  topicDepth          Float   @default(0.0)
  technicalAccuracy   Float   @default(0.0)
  industryRecognition Boolean @default(false)

  // Authoritativeness Indicators
  citations     Int @default(0)
  backlinks     Int @default(0)
  socialShares  Int @default(0)
  brandMentions Int @default(0)

  // Trustworthiness Indicators
  factCheckScore    Float @default(0.0)
  sourcesQuality    Float @default(0.0)
  transparencyScore Float @default(0.0)
  accuracyHistory   Float @default(0.0)

  // AI Analysis
  contentRelevance  Float @default(0.0)
  userSatisfaction  Float @default(0.0)
  engagementQuality Float @default(0.0)

  // Recommendations
  improvements String // JSON array
  strengths    String // JSON array
  weaknesses   String // JSON array

  analyzedAt DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([overallScore])
  @@index([contentType, overallScore])
  @@index([analyzedAt])
}

model CompetitorIntelligence {
  id           String @id @default(cuid())
  competitorId String // Reference to SEOCompetitor
  domain       String

  // Strategy Analysis
  contentStrategy   String // JSON object
  keywordStrategy   String // JSON object
  backlinkStrategy  String // JSON object
  technicalStrategy String // JSON object

  // Performance Metrics
  organicTraffic   Int    @default(0)
  keywordRankings  Int    @default(0)
  topKeywords      String // JSON array
  contentFrequency Float  @default(0.0) // Posts per day
  avgContentLength Int    @default(0)

  // Strengths & Weaknesses
  strengths     String // JSON array
  weaknesses    String // JSON array
  opportunities String // JSON array
  threats       String // JSON array

  // Competitive Gaps
  keywordGaps  String // JSON array - keywords they rank for, we don't
  contentGaps  String // JSON array - topics they cover, we don't
  backlinkGaps String // JSON array - sources linking to them, not us

  // Recommendations
  actionableInsights String // JSON array
  priorityActions    String // JSON array
  estimatedImpact    Float  @default(0.0)

  analyzedAt DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([competitorId])
  @@index([domain])
  @@index([analyzedAt])
}

model SearchForecast {
  id        String @id @default(cuid())
  keywordId String // Reference to SEOKeyword
  keyword   String

  // Forecast Data (30, 60, 90 days)
  forecast30Days String // JSON: {position, searchVolume, clicks, impressions}
  forecast60Days String // JSON
  forecast90Days String // JSON

  // Trend Analysis
  trendDirection String // up, down, stable, volatile
  trendStrength  Float  @default(0.0) // 0-1
  seasonality    String // JSON array of seasonal patterns
  volatility     Float  @default(0.0) // 0-1

  // Search Volume Prediction
  currentVolume       Int   @default(0)
  predictedVolume30   Int   @default(0)
  predictedVolume60   Int   @default(0)
  predictedVolume90   Int   @default(0)
  volumeChangePercent Float @default(0.0)

  // Ranking Prediction
  currentPosition       Int   @default(0)
  predictedPosition30   Int   @default(0)
  predictedPosition60   Int   @default(0)
  predictedPosition90   Int   @default(0)
  positionChangePercent Float @default(0.0)

  // Traffic Prediction
  currentClicks       Int   @default(0)
  predictedClicks30   Int   @default(0)
  predictedClicks60   Int   @default(0)
  predictedClicks90   Int   @default(0)
  clicksChangePercent Float @default(0.0)

  // Confidence Metrics
  confidence  Float @default(0.0) // 0-1
  accuracy    Float @default(0.0) // Historical accuracy
  dataQuality Float @default(0.0) // 0-1

  // Influencing Factors
  factors       String // JSON array
  opportunities String // JSON array
  risks         String // JSON array

  generatedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([keywordId])
  @@index([keyword])
  @@index([trendDirection])
  @@index([generatedAt])
}

model RankingPrediction {
  id        String @id @default(cuid())
  contentId String
  url       String
  keyword   String

  // Current State
  currentRanking Int   @default(0)
  currentScore   Float @default(0.0)
  currentTraffic Int   @default(0)

  // Predictions (7, 14, 30, 60, 90 days)
  predicted7Days  String // JSON: {ranking, score, traffic, confidence}
  predicted14Days String // JSON
  predicted30Days String // JSON
  predicted60Days String // JSON
  predicted90Days String // JSON

  // ML Model Data
  modelVersion      String @default("v1.0")
  modelAccuracy     Float  @default(0.0)
  trainingDataSize  Int    @default(0)
  featureImportance String // JSON object

  // Ranking Factors Analysis
  contentQuality      Float @default(0.0)
  technicalSEO        Float @default(0.0)
  backlinkProfile     Float @default(0.0)
  userEngagement      Float @default(0.0)
  competitivePosition Float @default(0.0)

  // Impact Analysis
  estimatedTrafficGain Int   @default(0)
  estimatedRevenue     Float @default(0.0)
  probabilityTop10     Float @default(0.0)
  probabilityTop3      Float @default(0.0)

  // Recommendations
  quickWins         String // JSON array
  longTermActions   String // JSON array
  requiredResources String // JSON array

  confidence  Float    @default(0.0)
  generatedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([contentId])
  @@index([keyword])
  @@index([currentRanking])
  @@index([generatedAt])
}

model SEOIntelligenceMetrics {
  id     String   @id @default(cuid())
  date   DateTime
  period String // daily, weekly, monthly

  // E-E-A-T Metrics
  avgEEATScore     Float @default(0.0)
  contentAnalyzed  Int   @default(0)
  eeatImprovements Int   @default(0)

  // Competitor Metrics
  competitorsTracked      Int @default(0)
  keywordGapsFound        Int @default(0)
  opportunitiesIdentified Int @default(0)
  actionsRecommended      Int @default(0)

  // Forecast Metrics
  keywordsForecast    Int   @default(0)
  avgForecastAccuracy Float @default(0.0)
  trafficPredicted    Int   @default(0)
  trafficActual       Int   @default(0)

  // Prediction Metrics
  predictionsGenerated  Int   @default(0)
  avgPredictionAccuracy Float @default(0.0)
  top10Predictions      Int   @default(0)
  top3Predictions       Int   @default(0)

  // Intelligence Insights
  insightsGenerated Int   @default(0)
  actionsCompleted  Int   @default(0)
  impactRealized    Float @default(0.0)
  roiGenerated      Float @default(0.0)

  createdAt DateTime @default(now())

  @@index([date, period])
  @@index([avgEEATScore])
}

// ===================================
// TASK 69: AUTOMATION ORCHESTRATION
// ===================================

model AutomationWorkflow {
  id                 String    @id @default(cuid())
  name               String
  description        String?
  workflowType       String // n8n, zapier, custom, git, api
  status             String    @default("draft") // draft, active, paused, archived
  trigger            String // publish, schedule, event, webhook, manual
  triggerConfig      String? // JSON config
  actions            String // JSON array of actions
  schedule           String? // cron expression
  priority           String    @default("normal") // low, normal, high, urgent
  retryStrategy      String? // JSON config
  timeoutMs          Int       @default(300000) // 5 minutes
  isActive           Boolean   @default(true)
  lastRunAt          DateTime?
  nextRunAt          DateTime?
  runCount           Int       @default(0)
  successCount       Int       @default(0)
  failureCount       Int       @default(0)
  avgExecutionTimeMs Int?
  createdBy          String
  updatedBy          String?
  tags               String? // JSON array
  metadata           String? // JSON object
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  executions AutomationExecution[]
  alerts     AutomationAlert[]

  @@index([status, isActive])
  @@index([workflowType])
  @@index([trigger])
  @@index([createdBy])
  @@index([lastRunAt])
  @@index([nextRunAt])
}

model AutomationExecution {
  id                String    @id @default(cuid())
  workflowId        String
  status            String    @default("running") // running, completed, failed, cancelled
  triggerType       String // manual, scheduled, event, webhook
  triggerData       String? // JSON input data
  startedAt         DateTime  @default(now())
  completedAt       DateTime?
  executionTimeMs   Int?
  stepsCompleted    Int       @default(0)
  stepsTotal        Int       @default(0)
  currentStep       String?
  output            String? // JSON output data
  errorMessage      String?
  errorStack        String?
  retryCount        Int       @default(0)
  isRetry           Boolean   @default(false)
  parentExecutionId String?
  metadata          String? // JSON object

  workflow AutomationWorkflow        @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  steps    AutomationExecutionStep[]

  @@index([workflowId, status])
  @@index([status, startedAt])
  @@index([triggerType])
}

model AutomationExecutionStep {
  id              String    @id @default(cuid())
  executionId     String
  stepName        String
  stepType        String // action, condition, loop, parallel
  stepOrder       Int
  status          String    @default("pending") // pending, running, completed, failed, skipped
  startedAt       DateTime?
  completedAt     DateTime?
  executionTimeMs Int?
  input           String? // JSON input
  output          String? // JSON output
  errorMessage    String?
  retryCount      Int       @default(0)
  metadata        String? // JSON object

  execution AutomationExecution @relation(fields: [executionId], references: [id], onDelete: Cascade)

  @@index([executionId, stepOrder])
  @@index([status])
}

model AutomationAlert {
  id              String    @id @default(cuid())
  workflowId      String?
  alertType       String // slack, telegram, email, webhook, in_app
  channel         String // channel name, email, webhook URL
  config          String? // JSON config (tokens, credentials)
  events          String // JSON array: workflow_start, workflow_complete, workflow_fail, step_fail
  severity        String    @default("info") // info, warning, error, critical
  isActive        Boolean   @default(true)
  lastTriggeredAt DateTime?
  triggerCount    Int       @default(0)
  successCount    Int       @default(0)
  failureCount    Int       @default(0)
  createdBy       String
  metadata        String? // JSON object
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  workflow AutomationWorkflow? @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId])
  @@index([alertType])
  @@index([isActive])
}

model ContentVersion {
  id                String   @id @default(cuid())
  articleId         String
  versionNumber     Int
  contentSnapshot   String // Full content JSON
  changeDescription String?
  changedBy         String
  changeType        String // created, edited, published, reverted
  gitCommitHash     String?
  diffData          String? // JSON diff
  metadata          String? // JSON object
  createdAt         DateTime @default(now())

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, versionNumber])
  @@index([articleId, createdAt])
  @@index([changedBy])
  @@index([gitCommitHash])
}

model APIOrchestration {
  id                String    @id @default(cuid())
  name              String
  description       String?
  orchestrationType String // sequential, parallel, conditional, pipeline
  apiCalls          String // JSON array of API call configs
  dependencies      String? // JSON dependency graph
  retryStrategy     String? // JSON retry config
  timeoutMs         Int       @default(30000)
  isActive          Boolean   @default(true)
  lastExecutedAt    DateTime?
  executionCount    Int       @default(0)
  successCount      Int       @default(0)
  failureCount      Int       @default(0)
  avgResponseTimeMs Int?
  createdBy         String
  tags              String? // JSON array
  metadata          String? // JSON object
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([orchestrationType])
  @@index([isActive])
  @@index([createdBy])
}

model IntegrationConnection {
  id             String    @id @default(cuid())
  name           String
  platform       String // n8n, zapier, slack, telegram, github
  connectionType String // oauth, api_key, webhook
  credentials    String // Encrypted JSON
  webhookUrl     String?
  isActive       Boolean   @default(true)
  isVerified     Boolean   @default(false)
  lastVerifiedAt DateTime?
  lastUsedAt     DateTime?
  usageCount     Int       @default(0)
  createdBy      String
  metadata       String? // JSON object
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([platform])
  @@index([isActive, isVerified])
  @@index([createdBy])
}

// Task 70: Continuous Learning & Optimization Cycle Models
model PerformanceAudit {
  id               String    @id @default(cuid())
  auditType        String // monthly, quarterly, ad_hoc, automated
  auditPeriod      String // 2024-10, Q4-2024
  status           String    @default("pending") // pending, running, completed, failed
  startDate        DateTime
  endDate          DateTime
  trafficMetrics   String? // JSON: organic, referral, direct traffic
  rankingMetrics   String? // JSON: avg position, top 10 keywords, improvements
  contentMetrics   String? // JSON: top articles, engagement, conversions
  technicalMetrics String? // JSON: speed, core web vitals, errors
  backlinkMetrics  String? // JSON: new links, lost links, quality score
  aiMetrics        String? // JSON: LLM citations, AI overview appearances
  overallScore     Int? // 0-100
  findings         String? // JSON array of issues/opportunities
  recommendations  String? // JSON array of action items
  aiAnalysis       String? // AI-generated insights
  executedBy       String    @default("system")
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  optimizations OptimizationCycle[]

  @@index([auditType, auditPeriod])
  @@index([status, createdAt])
  @@index([startDate, endDate])
}

model OptimizationCycle {
  id               String    @id @default(cuid())
  auditId          String?
  cycleType        String // monthly, quarterly, emergency
  cyclePeriod      String // 2024-10, Q4-2024
  status           String    @default("planned") // planned, active, completed, failed
  targetAreas      String // JSON array: keywords, backlinks, content, technical
  keywordUpdates   String? // JSON: target keywords, optimization actions
  backlinkUpdates  String? // JSON: link building actions, targets
  contentUpdates   String? // JSON: content refresh actions
  technicalUpdates String? // JSON: technical improvements
  expectedImpact   String? // JSON: traffic, rankings predictions
  actualImpact     String? // JSON: measured results
  startDate        DateTime
  endDate          DateTime?
  completedAt      DateTime?
  createdBy        String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  audit   PerformanceAudit? @relation(fields: [auditId], references: [id], onDelete: SetNull)
  abTests ABTest[]

  @@index([cycleType, cyclePeriod])
  @@index([status, startDate])
  @@index([auditId])
}

model ABTest {
  id                      String    @id @default(cuid())
  optimizationCycleId     String?
  testName                String
  testType                String // headline, content_format, layout, cta
  hypothesis              String
  status                  String    @default("draft") // draft, running, completed, cancelled
  variantA                String // JSON: control variant data
  variantB                String // JSON: test variant data
  variantATraffic         Int       @default(0)
  variantBTraffic         Int       @default(0)
  variantAConversions     Int       @default(0)
  variantBConversions     Int       @default(0)
  variantAEngagement      Float?
  variantBEngagement      Float?
  confidenceLevel         Float? // 0-100
  statisticalSignificance Boolean   @default(false)
  winner                  String? // variant_a, variant_b, no_winner
  targetArticleId         String?
  targetCategory          String?
  sampleSize              Int       @default(1000)
  currentSample           Int       @default(0)
  startDate               DateTime?
  endDate                 DateTime?
  results                 String? // JSON: detailed results
  learnings               String? // JSON: key takeaways
  appliedGlobally         Boolean   @default(false)
  appliedAt               DateTime?
  createdBy               String
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  optimizationCycle OptimizationCycle? @relation(fields: [optimizationCycleId], references: [id], onDelete: SetNull)

  @@index([status, startDate])
  @@index([testType])
  @@index([optimizationCycleId])
  @@index([targetArticleId])
  @@index([winner])
}

model AIModelTraining {
  id                  String    @id @default(cuid())
  modelName           String // content_optimizer, ranking_predictor, engagement_scorer
  trainingType        String // initial, incremental, full_retrain
  status              String    @default("queued") // queued, training, evaluating, completed, failed
  datasetSize         Int
  datasetPeriod       String // 30d, 90d, 1y
  features            String // JSON array of feature names
  performanceMetrics  String? // JSON: accuracy, precision, recall, f1
  previousVersion     String?
  newVersion          String
  improvementPercent  Float?
  trainingTimeMinutes Int?
  deploymentStatus    String    @default("pending") // pending, deployed, rolled_back
  deployedAt          DateTime?
  errorMessage        String?
  dataQualityScore    Float?
  modelSize           Int? // Size in MB
  inferenceTimeMs     Int?
  createdBy           String    @default("system")
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  @@index([modelName, status])
  @@index([trainingType])
  @@index([deploymentStatus])
  @@index([createdAt])
}

model UserBehaviorAnalytics {
  id                 String    @id @default(cuid())
  userId             String?
  sessionId          String
  analysisType       String // heatmap, scroll_map, click_map, engagement
  pageUrl            String
  pageType           String // article, category, home, search
  deviceType         String // desktop, mobile, tablet
  browserType        String?
  location           String? // Country/Region
  heatmapData        String? // JSON: click coordinates, intensity
  scrollDepthPercent Int?
  timeOnPageSeconds  Int?
  interactions       String? // JSON: clicks, hovers, selections
  engagementScore    Float? // 0-100
  exitPoint          String?
  conversionEvent    String?
  timestamp          DateTime  @default(now())
  aggregatedAt       DateTime?

  @@index([userId, timestamp])
  @@index([sessionId])
  @@index([analysisType, pageType])
  @@index([timestamp])
  @@index([pageUrl])
}

model OptimizationInsight {
  id              String    @id @default(cuid())
  insightType     String // opportunity, warning, success, trend
  category        String // content, technical, keywords, backlinks, user_behavior
  title           String
  description     String
  priority        String    @default("medium") // low, medium, high, critical
  confidence      Float // 0-100
  dataSource      String // ai_model, analytics, audit, ab_test
  relatedMetrics  String? // JSON: affected metrics
  suggestedAction String?
  expectedImpact  String? // JSON: traffic, rankings, engagement predictions
  status          String    @default("new") // new, reviewed, actioned, dismissed
  actionTaken     String?
  actionResult    String?
  reviewedBy      String?
  reviewedAt      DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([insightType, category])
  @@index([status, priority])
  @@index([createdAt])
  @@index([confidence])
}

model LearningLoop {
  id                    String    @id @default(cuid())
  loopName              String
  loopType              String // content_performance, keyword_optimization, user_engagement, technical_seo
  frequency             String // daily, weekly, monthly
  status                String    @default("active") // active, paused, disabled
  lastRunAt             DateTime?
  nextRunAt             DateTime?
  dataCollectionQuery   String // SQL or config for data collection
  analysisAlgorithm     String // Algorithm/model name
  actionTriggers        String // JSON: conditions for automated actions
  automationLevel       String    @default("assisted") // manual, assisted, automated
  runCount              Int       @default(0)
  successCount          Int       @default(0)
  failureCount          Int       @default(0)
  avgImprovementPercent Float?
  learnings             String? // JSON: accumulated insights
  config                String? // JSON: loop-specific configuration
  createdBy             String
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([loopType, status])
  @@index([nextRunAt])
  @@index([status])
}

// Task 71: RAO Content Structuring & Chunking System Models
model ContentChunk {
  id               String   @id @default(cuid())
  articleId        String
  chunkIndex       Int // Order in document
  chunkType        String // semantic, question, context, facts, canonical_answer, faq, glossary
  content          String // 200-400 words
  wordCount        Int
  embedding        String? // JSON: vector embedding for semantic search
  semanticScore    Float? // 0-100: relevance score
  entities         String? // JSON: extracted entities (coins, protocols, people)
  keywords         String? // JSON: primary keywords
  context          String? // Surrounding context
  sourceReferences String? // JSON: citations and sources
  llmOptimized     Boolean  @default(true)
  qualityScore     Float? // 0-100: chunk quality
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@unique([articleId, chunkIndex])
  @@index([articleId, chunkType])
  @@index([chunkType])
  @@index([semanticScore])
  @@index([llmOptimized])
}

model CanonicalAnswer {
  id               String           @id @default(cuid())
  articleId        String
  question         String // Primary question addressed
  answer           String // Concise 2-3 sentence answer for LLMs
  answerType       String // definition, explanation, how_to, comparison, fact
  confidence       Float // 0-100: answer confidence
  sources          String? // JSON: source citations
  relatedQuestions String? // JSON: related questions
  factClaims       String? // JSON: verifiable facts
  keywords         String? // JSON: target keywords
  entities         String? // JSON: named entities (Task 74)
  llmFormat        String // Formatted for LLM consumption
  qualityScore     Float? // 0-100
  usageCount       Int              @default(0) // Times cited by LLMs (Task 74)
  lastCitedAt      DateTime? // Last citation timestamp (Task 74)
  isVerified       Boolean          @default(false)
  verifiedBy       String?
  verifiedAt       DateTime?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  Citations        SourceCitation[] // Task 74: Explicit source citations

  @@index([articleId])
  @@index([answerType])
  @@index([confidence])
  @@index([isVerified])
  @@index([usageCount])
}

// Task 74: Explicit source attribution for citations
model SourceCitation {
  id                String           @id @default(cuid())
  contentId         String
  canonicalAnswerId String?
  sourceType        String // primary, secondary, academic, news, official
  sourceTitle       String
  sourceUrl         String
  sourceAuthor      String?
  sourceDate        DateTime?
  sourceDomain      String?
  citationText      String // Explicit citation line
  citationStyle     String           @default("APA") // APA, MLA, Chicago, IEEE
  reliability       Int              @default(0) // 0-100 source reliability score
  authorityScore    Int              @default(0) // 0-100 domain authority
  freshness         Int              @default(0) // 0-100 content freshness
  isVerified        Boolean          @default(false)
  verifiedBy        String?
  verifiedAt        DateTime?
  position          Int              @default(0) // Order in citation list
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  CanonicalAnswer   CanonicalAnswer? @relation(fields: [canonicalAnswerId], references: [id])

  @@index([contentId])
  @@index([sourceType])
  @@index([reliability])
  @@index([authorityScore])
  @@index([canonicalAnswerId])
}

model ContentFAQ {
  id              String    @id @default(cuid())
  articleId       String
  question        String
  answer          String
  questionType    String // what, why, how, when, where, who
  relevanceScore  Float // 0-100: relevance to article
  searchVolume    Int? // Estimated monthly searches
  difficulty      Float? // SEO difficulty 0-100
  position        Int // Display order
  isAIGenerated   Boolean   @default(true)
  isHumanReviewed Boolean   @default(false)
  reviewedBy      String?
  reviewedAt      DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([articleId, position])
  @@index([questionType])
  @@index([relevanceScore])
}

model ContentGlossary {
  id            String    @id @default(cuid())
  articleId     String
  term          String
  definition    String
  category      String // crypto, blockchain, defi, trading, technical
  complexity    String    @default("beginner") // beginner, intermediate, advanced
  usageCount    Int       @default(0) // Times used in article
  relatedTerms  String? // JSON: related glossary terms
  externalLinks String? // JSON: reference links
  position      Int // Display order
  isVerified    Boolean   @default(false)
  verifiedBy    String?
  verifiedAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([articleId, term])
  @@index([articleId, position])
  @@index([category])
  @@index([complexity])
  @@index([term])
}

model StructuredContent {
  id                   String    @id @default(cuid())
  articleId            String    @unique
  structure            String // JSON: full content structure
  chunkCount           Int       @default(0)
  faqCount             Int       @default(0)
  glossaryCount        Int       @default(0)
  canonicalAnswerCount Int       @default(0)
  overallQualityScore  Float? // 0-100
  llmReadabilityScore  Float? // 0-100: optimized for LLM retrieval
  semanticCoherence    Float? // 0-100: content flow quality
  entityDensity        Float? // Entities per 100 words
  factDensity          Float? // Facts per 100 words
  lastProcessedAt      DateTime?
  processingTimeMs     Int?
  status               String    @default("pending") // pending, processing, completed, failed
  errorMessage         String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([status])
  @@index([overallQualityScore])
  @@index([lastProcessedAt])
}

model RAOPerformanceMetric {
  id                   String   @id @default(cuid())
  articleId            String
  metricType           String // llm_citation, ai_summary, retrieval_rank, structured_quality
  metricValue          Float
  source               String // chatgpt, perplexity, claude, gemini, google_ai
  timestamp            DateTime @default(now())
  context              String? // JSON: additional context
  comparisonToPrevious Float? // % change
  createdAt            DateTime @default(now())

  @@index([articleId, metricType])
  @@index([metricType, timestamp])
  @@index([source])
  @@index([timestamp])
}

// Task 72: Semantic Embedding & Vector Index Models

model VectorEmbedding {
  id              String    @id @default(cuid())
  contentId       String // Article, chunk, or entity ID
  contentType     String // article, chunk, canonical_answer, faq, glossary
  embeddingModel  String    @default("text-embedding-3-small") // OpenAI model
  embeddingVector String // JSON array of float values (1536 dimensions)
  dimension       Int       @default(1536)
  tokens          Int // Token count for embedding
  metadata        String? // JSON: title, excerpt, keywords, entities
  qualityScore    Float? // 0-100: embedding quality
  version         Int       @default(1)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  lastAccessedAt  DateTime?
  accessCount     Int       @default(0)

  @@unique([contentId, contentType, embeddingModel])
  @@index([contentType, isActive])
  @@index([contentId])
  @@index([embeddingModel])
  @@index([isActive, createdAt])
}

model RecognizedEntity {
  id              String    @id @default(cuid())
  entityType      String // coin, protocol, project, exchange, person, organization
  name            String
  normalizedName  String // Lowercase, standardized
  aliases         String? // JSON array of alternative names
  description     String?
  category        String? // cryptocurrency, defi, nft, exchange, etc.
  metadata        String? // JSON: market cap, founding date, links, etc.
  confidence      Float     @default(1.0) // 0-1: entity recognition confidence
  mentionCount    Int       @default(0)
  lastMentionedAt DateTime?
  embeddingId     String? // Link to entity embedding
  isVerified      Boolean   @default(false)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  EntityMention EntityMention[]

  @@unique([normalizedName, entityType])
  @@index([entityType, isActive])
  @@index([normalizedName])
  @@index([mentionCount])
  @@index([isVerified])
}

model EntityMention {
  id             String   @id @default(cuid())
  entityId       String
  contentId      String // Article or chunk ID
  contentType    String // article, chunk, comment
  position       Int // Character position in content
  context        String? // Surrounding text (50 chars)
  sentiment      String? // positive, negative, neutral
  relevanceScore Float? // 0-1: how relevant to content
  createdAt      DateTime @default(now())

  RecognizedEntity RecognizedEntity @relation(fields: [entityId], references: [id], onDelete: Cascade)

  @@index([entityId, contentType])
  @@index([contentId, entityId])
  @@index([createdAt])
}

model VectorSearchIndex {
  id              String    @id @default(cuid())
  indexName       String    @unique // e.g., "articles_primary", "chunks_semantic"
  indexType       String    @default("hnsw") // hnsw, flat, ivf
  dimension       Int       @default(1536)
  metric          String    @default("cosine") // cosine, euclidean, dot_product
  contentTypes    String // JSON array: ["article", "chunk"]
  configuration   String? // JSON: index-specific config (ef_construction, M, etc.)
  totalVectors    Int       @default(0)
  status          String    @default("active") // active, building, updating, error
  lastBuildAt     DateTime?
  buildDurationMs Int?
  avgQueryTimeMs  Float?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([status])
  @@index([indexName])
}

model HybridSearchLog {
  id              String   @id @default(cuid())
  query           String
  queryEmbedding  String? // JSON: vector representation
  searchType      String // hybrid, vector_only, keyword_only
  keywordResults  String? // JSON: keyword search results
  vectorResults   String? // JSON: vector search results
  hybridResults   String // JSON: combined results with scores
  fusionAlgorithm String   @default("rrf") // rrf (reciprocal rank fusion), linear, weighted
  keywordWeight   Float    @default(0.5)
  vectorWeight    Float    @default(0.5)
  totalResults    Int
  queryTimeMs     Int
  userId          String?
  sessionId       String?
  clickedResultId String? // Track which result was clicked
  clickPosition   Int?
  createdAt       DateTime @default(now())

  @@index([searchType, createdAt])
  @@index([userId, createdAt])
  @@index([query])
  @@index([createdAt])
}

model EmbeddingUpdateQueue {
  id                String    @id @default(cuid())
  contentId         String
  contentType       String // article, chunk, canonical_answer, faq, glossary
  updateType        String // create, update, delete
  priority          String    @default("normal") // urgent, high, normal, low
  status            String    @default("pending") // pending, processing, completed, failed
  retryCount        Int       @default(0)
  maxRetries        Int       @default(3)
  errorMessage      String?
  processingStarted DateTime?
  processingEnded   DateTime?
  createdAt         DateTime  @default(now())

  @@index([status, priority, createdAt])
  @@index([contentId, contentType])
  @@index([status])
}

model VectorSearchMetrics {
  id              String   @id @default(cuid())
  metricType      String // accuracy, latency, recall, precision, ndcg
  metricValue     Float
  testQuery       String?
  expectedResults String? // JSON: ground truth
  actualResults   String? // JSON: search results
  searchType      String // hybrid, vector_only, keyword_only
  timestamp       DateTime @default(now())
  context         String? // JSON: additional context

  @@index([metricType, timestamp])
  @@index([searchType])
  @@index([timestamp])
}

// ============================================
// TASK 73: Knowledge API & LLM Access Layer
// ============================================

model APIKey {
  id               String    @id @default(cuid())
  userId           String?
  keyHash          String    @unique
  name             String
  description      String?
  tier             String    @default("free") // free, basic, pro, enterprise
  rateLimit        Int       @default(100) // requests per hour
  allowedEndpoints String // JSON: array of allowed endpoints
  isActive         Boolean   @default(true)
  expiresAt        DateTime?
  lastUsedAt       DateTime?
  totalRequests    Int       @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  User        User?         @relation(fields: [userId], references: [id])
  APIUsage    APIUsage[]
  CitationLog CitationLog[]

  @@index([keyHash])
  @@index([userId])
  @@index([isActive, tier])
}

model APIUsage {
  id             String   @id @default(cuid())
  apiKeyId       String
  endpoint       String
  method         String
  statusCode     Int
  responseTimeMs Int
  requestSize    Int      @default(0) // bytes
  responseSize   Int      @default(0) // bytes
  ipAddress      String?
  userAgent      String?
  referer        String?
  errorMessage   String?
  metadata       String? // JSON: additional context
  timestamp      DateTime @default(now())

  APIKey APIKey @relation(fields: [apiKeyId], references: [id])

  @@index([apiKeyId, timestamp])
  @@index([endpoint, timestamp])
  @@index([timestamp])
}

model KnowledgeBase {
  id             String   @id @default(cuid())
  articleId      String   @unique
  structuredData String // JSON: processed data for LLMs
  summary        String // Short summary (2-3 sentences)
  keyPoints      String // JSON: array of key points
  entities       String // JSON: extracted entities
  facts          String // JSON: verified facts
  sources        String // JSON: source citations
  lastProcessed  DateTime @default(now())
  qualityScore   Float    @default(0.0) // 0-100
  llmReadability Float    @default(0.0) // 0-100
  citationCount  Int      @default(0)
  accessCount    Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  Article     Article       @relation(fields: [articleId], references: [id], onDelete: Cascade)
  CitationLog CitationLog[]

  @@index([articleId])
  @@index([qualityScore])
  @@index([citationCount])
}

model RAGFeed {
  id              String    @id @default(cuid())
  name            String
  description     String
  feedType        String // rss, json, xml
  endpoint        String    @unique
  category        String?
  region          String?
  language        String    @default("en")
  updateFrequency String    @default("hourly") // realtime, hourly, daily
  isActive        Boolean   @default(true)
  lastGenerated   DateTime?
  accessCount     Int       @default(0)
  subscriberCount Int       @default(0)
  averageQuality  Float     @default(0.0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([feedType])
  @@index([isActive])
  @@index([category])
}

model AIManifest {
  id           String   @id @default(cuid())
  version      String   @default("1.0")
  name         String   @default("CoinDaily Knowledge API")
  description  String
  apiEndpoints String // JSON: array of endpoints
  capabilities String // JSON: what the API can do
  dataTypes    String // JSON: available data types
  rateLimit    String // JSON: rate limit info
  authMethods  String // JSON: authentication methods
  examples     String // JSON: usage examples
  lastUpdated  DateTime @default(now())
  isActive     Boolean  @default(true)

  @@index([isActive])
}

model CitationLog {
  id              String   @id @default(cuid())
  knowledgeBaseId String
  apiKeyId        String?
  sourceType      String // llm, api, rss, manual
  sourceName      String // ChatGPT, Perplexity, Claude, etc.
  citedContent    String // What was cited
  citationContext String? // How it was used
  userQuery       String? // Original user query (if available)
  ipAddress       String?
  userAgent       String?
  referer         String?
  metadata        String? // JSON: additional context
  timestamp       DateTime @default(now())

  KnowledgeBase KnowledgeBase @relation(fields: [knowledgeBaseId], references: [id])
  APIKey        APIKey?       @relation(fields: [apiKeyId], references: [id])

  @@index([knowledgeBaseId, timestamp])
  @@index([sourceType, timestamp])
  @@index([sourceName, timestamp])
  @@index([timestamp])
}

model DeveloperEndpoint {
  id              String   @id @default(cuid())
  name            String
  path            String   @unique
  method          String // GET, POST, etc.
  description     String
  category        String // crypto_data, articles, market, analysis
  isPublic        Boolean  @default(false)
  requiresAuth    Boolean  @default(true)
  rateLimit       Int      @default(100) // per hour
  responseFormat  String // json, xml, rss
  exampleRequest  String? // JSON: example request
  exampleResponse String? // JSON: example response
  documentation   String? // Markdown documentation
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([isActive])
  @@index([category])
  @@index([isPublic])
}

// ============================================================================
// TASK 74: RAO Metadata, Schema & AI Citation Optimization Models
// ============================================================================

// AI-specific schema markup for definitions, facts, quotes
model AISchemaMarkup {
  id           String    @id @default(cuid())
  contentId    String // Article, page, or content ID
  contentType  String // article, definition, fact, quote, how-to, faq
  schemaType   String // DefinedTerm, Claim, Quotation, HowTo, FAQPage, etc.
  schemaJson   String // JSON-LD schema markup
  mainEntity   String? // Primary entity (e.g., "Bitcoin", "Ethereum")
  definitions  String? // JSON: array of term definitions
  facts        String? // JSON: array of factual claims
  quotes       String? // JSON: array of quotations with sources
  confidence   Float     @default(0.0) // 0-1 confidence score
  qualityScore Int       @default(0) // 0-100 quality score
  isValid      Boolean   @default(true) // Validation status
  validatedAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([contentId, contentType])
  @@index([schemaType])
  @@index([mainEntity])
  @@index([qualityScore])
  @@index([isValid])
}

// LLM-friendly metadata with llms.txt and ai-source tags
model LLMMetadata {
  id                   String    @id @default(cuid())
  contentId            String
  contentType          String // article, page, dataset
  llmsTextContent      String // Content for llms.txt
  aiSourceTags         String // JSON: array of AI source tags
  semanticTags         String? // JSON: semantic HTML5 tags
  microdata            String? // JSON: Schema.org microdata
  rdfa                 String? // JSON: RDFa metadata
  openGraphAI          String? // JSON: AI-optimized Open Graph tags
  twitterCardsAI       String? // JSON: AI-optimized Twitter Cards
  canonicalUrl         String?
  languageCode         String    @default("en")
  readabilityScore     Int       @default(0) // 0-100 Flesch-Kincaid
  entityDensity        Float     @default(0.0) // Entity mentions per 100 words
  factDensity          Float     @default(0.0) // Fact claims per 100 words
  citationDensity      Float     @default(0.0) // Citations per 100 words
  structureComplexity  Int       @default(0) // 0-100 content structure score
  llmOptimizationScore Int       @default(0) // 0-100 overall LLM optimization
  lastOptimized        DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@unique([contentId, contentType])
  @@index([contentId])
  @@index([languageCode])
  @@index([llmOptimizationScore])
  @@index([lastOptimized])
}

// Trust signals for authoritative content (Task 74)
model TrustSignal {
  id           String    @id @default(cuid())
  contentId    String
  signalType   String // expert_author, peer_reviewed, official_source, verified_data, consensus
  signalSource String // Where the trust signal comes from
  signalValue  String // The actual trust indicator
  confidence   Float     @default(0.0) // 0-1 confidence in signal
  weight       Float     @default(1.0) // Weight in overall trust score
  expiresAt    DateTime?
  isActive     Boolean   @default(true)
  metadata     String? // JSON: additional signal data
  verifiedBy   String?
  verifiedAt   DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([contentId])
  @@index([signalType])
  @@index([isActive])
  @@index([expiresAt])
}

// Overall RAO citation metrics for tracking (Task 74)
model RAOCitationMetrics {
  id                     String    @id @default(cuid())
  contentId              String    @unique
  totalSchemaMarkups     Int       @default(0)
  totalDefinitions       Int       @default(0)
  totalFacts             Int       @default(0)
  totalQuotes            Int       @default(0)
  totalCanonicalAnswers  Int       @default(0)
  totalCitations         Int       @default(0)
  totalTrustSignals      Int       @default(0)
  avgSchemaQuality       Float     @default(0.0)
  avgCitationReliability Float     @default(0.0)
  avgTrustScore          Float     @default(0.0)
  llmOptimizationScore   Int       @default(0) // 0-100
  citationDensity        Float     @default(0.0)
  authorityScore         Int       @default(0) // 0-100
  aiReadabilityScore     Int       @default(0) // 0-100
  llmCitationCount       Int       @default(0) // Times cited by LLMs
  lastLLMCitedAt         DateTime?
  lastOptimizedAt        DateTime?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  @@index([contentId])
  @@index([llmOptimizationScore])
  @@index([authorityScore])
  @@index([llmCitationCount])
  @@index([lastOptimizedAt])
}

// ============================================================================
// TASK 76: Strategic Content Strategy & Keyword Research Models
// ============================================================================

// Strategic keywords for content targeting (Task 76)
model StrategyKeyword {
  id              String    @id @default(cuid())
  keyword         String    @unique
  region          String    @default("GLOBAL") // NIGERIA, KENYA, SOUTH_AFRICA, GHANA, ETHIOPIA, GLOBAL
  category        String // CRYPTO, BLOCKCHAIN, DEFI, MEMECOINS, BITCOIN, ETHEREUM, etc.
  searchVolume    Int       @default(0) // Monthly search volume
  difficulty      Int       @default(0) // 0-100 keyword difficulty
  cpc             Float     @default(0.0) // Cost per click
  competition     String    @default("MEDIUM") // LOW, MEDIUM, HIGH
  trend           String    @default("STABLE") // RISING, FALLING, STABLE, VIRAL
  intent          String    @default("INFORMATIONAL") // INFORMATIONAL, TRANSACTIONAL, NAVIGATIONAL
  priority        String    @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  status          String    @default("ACTIVE") // ACTIVE, INACTIVE, ARCHIVED
  parentKeyword   String?
  relatedKeywords String? // JSON: array of related keywords
  topRankingUrls  String? // JSON: array of top 10 URLs
  contentGap      String? // JSON: opportunities we can fill
  targetPosition  Int       @default(10) // Target ranking position
  currentPosition Int? // Current ranking position
  topicClusterId  String?
  metrics         String? // JSON: detailed metrics
  lastAnalyzedAt  DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  TopicCluster         TopicCluster?         @relation(fields: [topicClusterId], references: [id])
  ContentCalendarItems ContentCalendarItem[]

  @@index([region])
  @@index([category])
  @@index([priority])
  @@index([status])
  @@index([trend])
  @@index([topicClusterId])
  @@index([searchVolume])
  @@index([difficulty])
}

// Topic clusters for SEO content organization (Task 76)
model TopicCluster {
  id                String   @id @default(cuid())
  name              String
  pillarTopic       String // Main topic for the cluster
  region            String   @default("GLOBAL")
  category          String
  description       String?
  targetAudience    String? // African traders, institutional, retail, etc.
  contentCount      Int      @default(0)
  publishedCount    Int      @default(0)
  draftCount        Int      @default(0)
  avgSearchVolume   Int      @default(0)
  totalSearchVolume Int      @default(0)
  clusterScore      Int      @default(0) // 0-100 cluster quality
  internalLinks     Int      @default(0) // Number of internal links
  externalLinks     Int      @default(0)
  status            String   @default("ACTIVE") // ACTIVE, INACTIVE, ARCHIVED
  priority          String   @default("MEDIUM")
  seoMetrics        String? // JSON: SEO performance
  contentStrategy   String? // JSON: publishing strategy
  keywordIds        String? // JSON: array of keyword IDs
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  Keywords             StrategyKeyword[]
  ContentCalendarItems ContentCalendarItem[]

  @@index([region])
  @@index([category])
  @@index([status])
  @@index([priority])
  @@index([clusterScore])
}

// Competitor analysis for strategic positioning (Task 76)
model CompetitorAnalysis {
  id                   String    @id @default(cuid())
  competitorName       String
  domain               String    @unique
  region               String    @default("GLOBAL")
  category             String // NEWS, ANALYSIS, EXCHANGE, INFLUENCER, etc.
  domainAuthority      Int       @default(0) // 0-100
  monthlyTraffic       Int       @default(0)
  backlinks            Int       @default(0)
  referringDomains     Int       @default(0)
  organicKeywords      Int       @default(0)
  paidKeywords         Int       @default(0)
  contentVelocity      Int       @default(0) // Articles per month
  socialFollowers      String? // JSON: platform followers
  strengths            String? // JSON: what they do well
  weaknesses           String? // JSON: opportunities for us
  contentGaps          String? // JSON: topics they miss
  topKeywords          String? // JSON: their top ranking keywords
  topPages             String? // JSON: their best performing pages
  contentTypes         String? // JSON: their content formats
  publishingSchedule   String? // JSON: their publishing patterns
  targetAudience       String? // JSON: their audience
  monetizationStrategy String? // JSON: how they monetize
  swotAnalysis         String? // JSON: SWOT analysis
  competitiveAdvantage String? // JSON: our advantages
  threatLevel          String    @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  status               String    @default("ACTIVE")
  lastAnalyzedAt       DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([domain])
  @@index([region])
  @@index([category])
  @@index([domainAuthority])
  @@index([threatLevel])
  @@index([status])
}

// Content calendar for strategic publishing (Task 76)
model ContentCalendarItem {
  id                 String    @id @default(cuid())
  title              String
  slug               String?
  contentType        String    @default("ARTICLE") // ARTICLE, VIDEO, INFOGRAPHIC, PODCAST, GUIDE
  region             String    @default("GLOBAL")
  category           String
  primaryKeywordId   String?
  topicClusterId     String?
  targetAudience     String?
  contentBrief       String? // JSON: detailed content brief
  outline            String? // JSON: content outline
  assignedTo         String? // User ID or "AI_AGENT"
  status             String    @default("PLANNED") // PLANNED, ASSIGNED, IN_PROGRESS, REVIEW, SCHEDULED, PUBLISHED
  priority           String    @default("MEDIUM")
  scheduledDate      DateTime
  publishedDate      DateTime?
  estimatedReadTime  Int       @default(0) // Minutes
  wordCount          Int       @default(0)
  seoScore           Int? // 0-100
  qualityScore       Int? // 0-100
  engagementGoal     Int? // Target views/engagement
  keywords           String? // JSON: target keywords
  internalLinks      String? // JSON: suggested internal links
  externalSources    String? // JSON: research sources
  callToAction       String?
  contentGoals       String? // JSON: what this content achieves
  performanceMetrics String? // JSON: actual performance
  notes              String?
  articleId          String? // Links to published article
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  PrimaryKeyword StrategyKeyword? @relation(fields: [primaryKeywordId], references: [id])
  TopicCluster   TopicCluster?    @relation(fields: [topicClusterId], references: [id])

  @@index([status])
  @@index([scheduledDate])
  @@index([region])
  @@index([category])
  @@index([priority])
  @@index([primaryKeywordId])
  @@index([topicClusterId])
  @@index([assignedTo])
}

// Trend monitoring for viral topic identification (Task 76)
model TrendMonitor {
  id                 String    @id @default(cuid())
  trendType          String // KEYWORD, TOPIC, COIN, EVENT, INFLUENCER
  trendName          String
  region             String    @default("GLOBAL")
  category           String
  source             String // GOOGLE_TRENDS, TWITTER, REDDIT, TELEGRAM, NEWS, AI_DETECTION
  trendScore         Int       @default(0) // 0-100 viral potential
  velocity           String    @default("STABLE") // EXPLODING, RISING, STABLE, DECLINING, DEAD
  searchVolume       Int       @default(0)
  socialMentions     Int       @default(0)
  newsArticles       Int       @default(0)
  sentimentScore     Float     @default(0.0) // -1 to 1
  peakDate           DateTime?
  predictedDuration  Int? // Days until trend dies
  contentOpportunity String? // JSON: content ideas
  relatedKeywords    String? // JSON: related trending keywords
  influencers        String? // JSON: key influencers driving trend
  demography         String? // JSON: who's interested
  actionItems        String? // JSON: what we should do
  status             String    @default("ACTIVE") // ACTIVE, DECLINING, EXPIRED
  isActioned         Boolean   @default(false)
  metadata           String? // JSON: additional trend data
  detectedAt         DateTime  @default(now())
  expiresAt          DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@index([trendType])
  @@index([region])
  @@index([category])
  @@index([trendScore])
  @@index([velocity])
  @@index([status])
  @@index([isActioned])
  @@index([detectedAt])
}

// Content strategy metrics for overall tracking (Task 76)
model ContentStrategyMetrics {
  id                      String   @id @default(cuid())
  dateRange               String // WEEK, MONTH, QUARTER, YEAR
  startDate               DateTime
  endDate                 DateTime
  totalKeywords           Int      @default(0)
  activeKeywords          Int      @default(0)
  avgKeywordDifficulty    Float    @default(0.0)
  avgSearchVolume         Int      @default(0)
  topicClusters           Int      @default(0)
  contentItemsPlanned     Int      @default(0)
  contentItemsPublished   Int      @default(0)
  avgContentQuality       Float    @default(0.0)
  avgSEOScore             Float    @default(0.0)
  competitorsTracked      Int      @default(0)
  trendsIdentified        Int      @default(0)
  trendsActioned          Int      @default(0)
  organicTraffic          Int      @default(0)
  keywordRankings         String? // JSON: ranking distribution
  contentPerformance      String? // JSON: top performing content
  competitorGaps          String? // JSON: opportunities identified
  strategyRecommendations String? // JSON: AI-generated recommendations
  regionPerformance       String? // JSON: performance by region
  categoryPerformance     String? // JSON: performance by category
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([dateRange])
  @@index([startDate])
  @@index([endDate])
}

// ============================================
// TASK 77: LINK BUILDING & AUTHORITY DEVELOPMENT
// ============================================

// Backlink tracking and analysis (Task 77)
model Backlink {
  id              String    @id @default(cuid())
  sourceUrl       String // URL where backlink exists
  sourceDomain    String // Domain of source
  targetUrl       String // Our URL being linked to
  anchorText      String?
  linkType        String // DOFOLLOW, NOFOLLOW, UGC, SPONSORED
  context         String? // Surrounding text
  discoveryMethod String // MANUAL, CRAWLER, API, TOOL
  status          String    @default("ACTIVE") // ACTIVE, REMOVED, BROKEN, REDIRECTED
  domainAuthority Int       @default(0) // 0-100 (Moz DA)
  pageAuthority   Int       @default(0) // 0-100 (Moz PA)
  trustFlow       Int       @default(0) // 0-100 (Majestic)
  citationFlow    Int       @default(0) // 0-100 (Majestic)
  spamScore       Int       @default(0) // 0-100 (lower is better)
  trafficEstimate Int       @default(0) // Estimated monthly traffic
  region          String? // NIGERIA, KENYA, SOUTH_AFRICA, GHANA, GLOBAL
  language        String    @default("en")
  category        String? // CRYPTO, BLOCKCHAIN, NEWS, TECH
  qualityScore    Int       @default(0) // 0-100 overall quality
  isVerified      Boolean   @default(false)
  verifiedAt      DateTime?
  firstSeenAt     DateTime  @default(now())
  lastCheckedAt   DateTime  @default(now())
  removedAt       DateTime?
  campaignId      String?
  notes           String?
  metadata        String? // JSON: additional data
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  Campaign LinkBuildingCampaign? @relation(fields: [campaignId], references: [id])

  @@index([sourceDomain])
  @@index([targetUrl])
  @@index([status])
  @@index([qualityScore])
  @@index([region])
  @@index([campaignId])
  @@index([firstSeenAt])
}

// Link building campaigns (Task 77)
model LinkBuildingCampaign {
  id                 String    @id @default(cuid())
  name               String
  campaignType       String // INFLUENCER, GUEST_POST, RESOURCE_PAGE, LOCAL_PARTNERSHIP, SYNDICATION
  status             String    @default("PLANNING") // PLANNING, ACTIVE, PAUSED, COMPLETED, CANCELLED
  region             String    @default("GLOBAL") // Target region
  targetBacklinks    Int       @default(50) // Goal for this campaign
  targetDomainAuth   Int       @default(40) // Minimum DA target
  budget             Float? // Campaign budget
  spent              Float     @default(0.0)
  startDate          DateTime
  endDate            DateTime?
  description        String?
  goals              String? // JSON: campaign objectives
  strategy           String? // JSON: approach and tactics
  resources          String? // JSON: tools, templates, contacts
  kpis               String? // JSON: key metrics to track
  createdBy          String? // User ID
  assignedTo         String? // User ID
  priority           String    @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  backlinksAcquired  Int       @default(0)
  totalReach         Int       @default(0) // Combined audience reach
  avgDomainAuthority Float     @default(0.0)
  successRate        Float     @default(0.0) // 0-1
  notes              String?
  metadata           String? // JSON: additional data
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  Backlinks Backlink[]
  Prospects LinkProspect[]
  Outreach  OutreachActivity[]

  @@index([campaignType])
  @@index([status])
  @@index([region])
  @@index([startDate])
  @@index([priority])
}

// Link prospects and opportunities (Task 77)
model LinkProspect {
  id                   String    @id @default(cuid())
  url                  String
  domain               String
  contactName          String?
  contactEmail         String?
  contactRole          String? // EDITOR, OWNER, MARKETING, PR
  prospectType         String // INFLUENCER, PUBLICATION, RESOURCE_PAGE, DIRECTORY, PARTNER
  region               String?
  category             String?
  domainAuthority      Int       @default(0)
  trafficEstimate      Int       @default(0)
  socialFollowers      String? // JSON: platform -> count
  status               String    @default("NEW") // NEW, CONTACTED, NEGOTIATING, APPROVED, REJECTED, COMPLETED
  priority             String    @default("MEDIUM")
  linkPotential        Int       @default(0) // 0-100 likelihood score
  qualityScore         Int       @default(0) // 0-100 overall quality
  relationshipStrength String    @default("COLD") // COLD, WARM, HOT, PARTNER
  notes                String?
  tags                 String? // JSON: categorization tags
  lastContactedAt      DateTime?
  responseRate         Float? // Historical response rate
  campaignId           String?
  metadata             String? // JSON: additional data
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  Campaign LinkBuildingCampaign? @relation(fields: [campaignId], references: [id])
  Outreach OutreachActivity[]

  @@index([domain])
  @@index([prospectType])
  @@index([status])
  @@index([region])
  @@index([priority])
  @@index([qualityScore])
  @@index([campaignId])
}

// Outreach activities and tracking (Task 77)
model OutreachActivity {
  id            String    @id @default(cuid())
  prospectId    String
  campaignId    String?
  activityType  String // EMAIL, DM, CALL, MEETING, FOLLOW_UP
  channel       String? // EMAIL, TWITTER, LINKEDIN, TELEGRAM, WHATSAPP
  subject       String?
  message       String?
  templateUsed  String? // Template name
  sentBy        String? // User ID
  sentAt        DateTime?
  status        String    @default("PENDING") // PENDING, SENT, OPENED, CLICKED, REPLIED, ACCEPTED, REJECTED
  response      String? // Response text
  respondedAt   DateTime?
  outcome       String? // POSITIVE, NEGATIVE, NEUTRAL, NO_RESPONSE
  followUpDate  DateTime?
  followUpCount Int       @default(0)
  notes         String?
  metadata      String? // JSON: additional tracking data
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  Prospect LinkProspect          @relation(fields: [prospectId], references: [id])
  Campaign LinkBuildingCampaign? @relation(fields: [campaignId], references: [id])

  @@index([prospectId])
  @@index([campaignId])
  @@index([activityType])
  @@index([status])
  @@index([sentAt])
  @@index([followUpDate])
}

// Influencer partnerships (Task 77)
model InfluencerPartnership {
  id                 String    @id @default(cuid())
  influencerName     String
  platform           String // TWITTER, YOUTUBE, LINKEDIN, TELEGRAM, INSTAGRAM
  handle             String
  profileUrl         String
  email              String?
  region             String? // NIGERIA, KENYA, SOUTH_AFRICA, GHANA, GLOBAL
  category           String? // CRYPTO, BLOCKCHAIN, DEFI, TRADING
  followerCount      Int       @default(0)
  engagementRate     Float     @default(0.0) // 0-1
  averageViews       Int       @default(0)
  audienceDemography String? // JSON: audience breakdown
  contentFocus       String? // JSON: topics they cover
  partnershipType    String // CONTENT_COLLAB, BACKLINK, MENTION, SPONSORED, AMBASSADOR
  status             String    @default("PROSPECT") // PROSPECT, CONTACTED, NEGOTIATING, ACTIVE, PAUSED, ENDED
  relationshipLevel  String    @default("COLD") // COLD, WARM, PARTNERSHIP, AMBASSADOR
  contractStart      DateTime?
  contractEnd        DateTime?
  deliverables       String? // JSON: what they'll provide
  compensation       String? // JSON: payment/exchange terms
  budget             Float?
  spent              Float     @default(0.0)
  backlinksGenerated Int       @default(0)
  mentionsCount      Int       @default(0)
  trafficGenerated   Int       @default(0)
  conversions        Int       @default(0)
  roi                Float     @default(0.0)
  performanceScore   Int       @default(0) // 0-100
  lastCollaboration  DateTime?
  nextCollaboration  DateTime?
  notes              String?
  metadata           String? // JSON: additional data
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@index([platform])
  @@index([region])
  @@index([status])
  @@index([partnershipType])
  @@index([performanceScore])
  @@index([followerCount])
}

// Link velocity and health monitoring (Task 77)
model LinkVelocityMetric {
  id                   String   @id @default(cuid())
  metricDate           DateTime @default(now())
  period               String // DAILY, WEEKLY, MONTHLY
  newBacklinks         Int      @default(0)
  lostBacklinks        Int      @default(0)
  netChange            Int      @default(0)
  totalActiveBacklinks Int      @default(0)
  avgDomainAuthority   Float    @default(0.0)
  avgQualityScore      Float    @default(0.0)
  dofollowCount        Int      @default(0)
  nofollowCount        Int      @default(0)
  topDomains           String? // JSON: best new domains
  lostDomains          String? // JSON: removed backlinks
  regionDistribution   String? // JSON: backlinks by region
  categoryDistribution String? // JSON: backlinks by category
  velocityScore        Int      @default(0) // 0-100 health score
  velocityTrend        String   @default("STABLE") // GROWING, STABLE, DECLINING, CONCERNING
  alerts               String? // JSON: any issues detected
  recommendations      String? // JSON: suggested actions
  competitorComparison String? // JSON: how we compare
  createdAt            DateTime @default(now())

  @@index([metricDate])
  @@index([period])
  @@index([velocityTrend])
}

// Authority development metrics (Task 77)
model AuthorityMetrics {
  id               String   @id @default(cuid())
  metricDate       DateTime @default(now())
  domainAuthority  Int      @default(0) // Moz DA
  domainRating     Int      @default(0) // Ahrefs DR
  trustFlow        Int      @default(0) // Majestic TF
  citationFlow     Int      @default(0) // Majestic CF
  organicKeywords  Int      @default(0)
  organicTraffic   Int      @default(0)
  referringDomains Int      @default(0)
  totalBacklinks   Int      @default(0)
  brandMentions    Int      @default(0)
  socialSignals    Int      @default(0)
  contentIndexed   Int      @default(0)
  topRankings      Int      @default(0) // Top 3 positions
  authorityScore   Int      @default(0) // 0-100 overall
  industryRank     Int? // Position in industry
  competitorGap    String? // JSON: vs top competitors
  strengths        String? // JSON: what we're doing well
  weaknesses       String? // JSON: areas to improve
  opportunities    String? // JSON: growth opportunities
  threats          String? // JSON: competitive threats
  recommendations  String? // JSON: strategic actions
  createdAt        DateTime @default(now())

  @@index([metricDate])
  @@index([authorityScore])
  @@index([domainAuthority])
}

// ============================================================================
// SOCIAL MEDIA & COMMUNITY ENGAGEMENT SYSTEM (Task 78)
// ============================================================================

model SocialMediaAccount {
  id             String    @id @default(cuid())
  platform       String // TWITTER, LINKEDIN, TELEGRAM, YOUTUBE, INSTAGRAM, TIKTOK
  accountHandle  String // @username or channel ID
  displayName    String
  profileUrl     String
  accessToken    String? // Encrypted OAuth token
  refreshToken   String? // Encrypted refresh token
  tokenExpiresAt DateTime?
  isActive       Boolean   @default(true)
  isVerified     Boolean   @default(false)
  followerCount  Int       @default(0)
  followingCount Int       @default(0)
  postCount      Int       @default(0)
  engagementRate Float     @default(0) // Percentage
  reachMetrics   String? // JSON: impressions, reach data
  audienceData   String? // JSON: demographics, locations
  lastSyncedAt   DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  SocialMediaPosts SocialMediaPost[]
  SocialSchedules  SocialMediaSchedule[]

  @@unique([platform, accountHandle])
  @@index([platform])
  @@index([isActive])
  @@index([followerCount])
}

model SocialMediaPost {
  id             String    @id @default(cuid())
  accountId      String
  contentId      String? // Link to Article
  postType       String // TEXT, IMAGE, VIDEO, LINK, POLL, THREAD
  platform       String // TWITTER, LINKEDIN, TELEGRAM, etc.
  content        String // Post text
  mediaUrls      String? // JSON array of media URLs
  hashtags       String? // JSON array
  mentions       String? // JSON array
  scheduledAt    DateTime?
  publishedAt    DateTime?
  status         String    @default("DRAFT") // DRAFT, SCHEDULED, PUBLISHED, FAILED
  platformPostId String? // ID from platform (tweet_id, post_id)
  postUrl        String?

  // Engagement Metrics
  likes          Int   @default(0)
  comments       Int   @default(0)
  shares         Int   @default(0)
  impressions    Int   @default(0)
  clicks         Int   @default(0)
  engagementRate Float @default(0)
  reachCount     Int   @default(0)

  // Performance
  performanceScore Float  @default(0) // 0-100
  sentimentScore   Float? // -1 to 1
  viralityScore    Float? // 0-100

  errorMessage String?
  retryCount   Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  Account     SocialMediaAccount @relation(fields: [accountId], references: [id])
  Engagements SocialEngagement[]

  @@index([accountId])
  @@index([status])
  @@index([publishedAt])
  @@index([performanceScore])
  @@index([platform])
}

model SocialMediaSchedule {
  id              String    @id @default(cuid())
  accountId       String
  name            String
  description     String?
  scheduleType    String // ONCE, DAILY, WEEKLY, MONTHLY, CUSTOM
  scheduleData    String // JSON: cron, specific times, days
  contentTemplate String? // Template for auto-posts
  isActive        Boolean   @default(true)
  nextRunAt       DateTime?
  lastRunAt       DateTime?
  totalRuns       Int       @default(0)
  successfulRuns  Int       @default(0)
  failedRuns      Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  Account SocialMediaAccount @relation(fields: [accountId], references: [id])

  @@index([accountId])
  @@index([isActive])
  @@index([nextRunAt])
}

model SocialEngagement {
  id               String   @id @default(cuid())
  postId           String
  userId           String? // Our user who engaged
  engagementType   String // LIKE, COMMENT, SHARE, CLICK, REPLY, RETWEET, MENTION
  platform         String
  platformUserId   String? // External user ID
  platformUsername String?
  content          String? // Comment/reply content
  sentimentScore   Float? // -1 to 1
  isInfluencer     Boolean  @default(false)
  followerCount    Int?
  engagedAt        DateTime
  createdAt        DateTime @default(now())

  Post SocialMediaPost @relation(fields: [postId], references: [id])

  @@index([postId])
  @@index([engagementType])
  @@index([engagedAt])
  @@index([isInfluencer])
}

model CommunityGroup {
  id              String    @id @default(cuid())
  name            String
  platform        String // TELEGRAM, DISCORD, WHATSAPP, REDDIT
  groupId         String // External group/channel ID
  groupUrl        String?
  description     String?
  region          String? // NIGERIA, KENYA, SOUTH_AFRICA, GHANA, GLOBAL
  category        String? // CRYPTO, MEMECOIN, TRADING, DEFI
  memberCount     Int       @default(0)
  isActive        Boolean   @default(true)
  isVerified      Boolean   @default(false)
  engagementScore Float     @default(0) // 0-100
  influenceScore  Float     @default(0) // 0-100
  communityHealth String? // JSON: activity, toxicity, growth
  moderatorStatus String    @default("NONE") // NONE, MEMBER, MODERATOR, ADMIN
  accessToken     String?
  lastActivityAt  DateTime?
  joinedAt        DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  Activities  CommunityActivity[]
  Influencers CommunityInfluencer[]

  @@unique([platform, groupId])
  @@index([platform])
  @@index([region])
  @@index([isActive])
  @@index([memberCount])
}

model CommunityActivity {
  id             String   @id @default(cuid())
  groupId        String
  activityType   String // POST, COMMENT, SHARE, MENTION, JOIN, LEAVE
  userId         String? // External user ID
  username       String?
  content        String?
  sentiment      Float? // -1 to 1
  engagement     Int      @default(0) // reactions/replies count
  isInfluential  Boolean  @default(false)
  topicTags      String? // JSON array
  mentionedCoins String? // JSON array
  activityAt     DateTime
  createdAt      DateTime @default(now())

  Group CommunityGroup @relation(fields: [groupId], references: [id])

  @@index([groupId])
  @@index([activityType])
  @@index([activityAt])
  @@index([isInfluential])
}

model CommunityInfluencer {
  id                String    @id @default(cuid())
  groupId           String?
  platform          String // TWITTER, TELEGRAM, YOUTUBE, etc.
  username          String
  displayName       String?
  profileUrl        String?
  followerCount     Int       @default(0)
  influenceScore    Float     @default(0) // 0-100
  engagementRate    Float     @default(0)
  niche             String? // CRYPTO, MEMECOIN, DEFI, TRADING
  region            String? // NIGERIA, KENYA, etc.
  isPartner         Boolean   @default(false)
  partnershipStatus String    @default("NONE") // NONE, CONTACTED, NEGOTIATING, ACTIVE
  contentCoCreated  Int       @default(0)
  totalReach        Int       @default(0)
  totalEngagement   Int       @default(0)
  lastActivityAt    DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  Group          CommunityGroup?           @relation(fields: [groupId], references: [id])
  Collaborations InfluencerCollaboration[]

  @@unique([platform, username])
  @@index([platform])
  @@index([influenceScore])
  @@index([isPartner])
  @@index([region])
}

model InfluencerCollaboration {
  id                String  @id @default(cuid())
  influencerId      String
  contentId         String? // Link to Article
  collaborationType String // GUEST_POST, INTERVIEW, CONTENT_REVIEW, PROMOTION, CO_CREATE
  status            String  @default("PROPOSED") // PROPOSED, ACCEPTED, IN_PROGRESS, COMPLETED, CANCELLED
  proposalDetails   String? // JSON: terms, deliverables
  deliverables      String? // JSON: content URLs, metrics

  // Performance
  reachGenerated      Int    @default(0)
  engagementGenerated Int    @default(0)
  conversions         Int    @default(0)
  roi                 Float? // Return on investment
  performanceScore    Float? // 0-100

  // Timeline
  proposedAt  DateTime  @default(now())
  acceptedAt  DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Influencer CommunityInfluencer @relation(fields: [influencerId], references: [id])

  @@index([influencerId])
  @@index([status])
  @@index([collaborationType])
}

model SocialMediaCampaign {
  id             String  @id @default(cuid())
  name           String
  description    String?
  objective      String // GROWTH, ENGAGEMENT, AWARENESS, TRAFFIC, CONVERSIONS
  platforms      String // JSON array: ["TWITTER", "LINKEDIN"]
  targetAudience String? // JSON: demographics, interests
  contentThemes  String? // JSON array
  hashtags       String? // JSON array

  // Budget & Resources
  budget      Float?
  spentAmount Float  @default(0)

  // Timeline
  startDate DateTime
  endDate   DateTime

  // Goals
  followerGoal   Int?
  engagementGoal Float? // Target engagement rate
  reachGoal      Int?
  conversionGoal Int?

  // Performance
  followersGained   Int   @default(0)
  totalEngagements  Int   @default(0)
  totalReach        Int   @default(0)
  totalConversions  Int   @default(0)
  avgEngagementRate Float @default(0)
  performanceScore  Float @default(0) // 0-100

  status    String   @default("DRAFT") // DRAFT, ACTIVE, PAUSED, COMPLETED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([startDate])
  @@index([performanceScore])
}

model EngagementAutomation {
  id                String  @id @default(cuid())
  name              String
  description       String?
  automationType    String // AUTO_REPLY, AUTO_LIKE, AUTO_FOLLOW, AUTO_RETWEET, SENTIMENT_RESPONSE
  platform          String
  triggers          String // JSON: conditions that activate automation
  actions           String // JSON: what to do when triggered
  filters           String? // JSON: keywords, user criteria
  responseTemplates String? // JSON: reply templates

  isActive Boolean @default(true)
  priority Int     @default(5) // 1-10

  // Performance
  totalTriggers Int   @default(0)
  totalActions  Int   @default(0)
  successRate   Float @default(0)

  // Safety
  dailyLimit  Int      @default(100)
  dailyUsed   Int      @default(0)
  lastResetAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([platform])
  @@index([isActive])
  @@index([automationType])
}

model SocialMediaAnalytics {
  id         String   @id @default(cuid())
  platform   String
  metricType String // DAILY, WEEKLY, MONTHLY
  metricDate DateTime

  // Growth Metrics
  followerCount  Int @default(0)
  followerGrowth Int @default(0)
  followingCount Int @default(0)

  // Content Metrics
  postsPublished   Int @default(0)
  totalLikes       Int @default(0)
  totalComments    Int @default(0)
  totalShares      Int @default(0)
  totalImpressions Int @default(0)
  totalClicks      Int @default(0)
  totalReach       Int @default(0)

  // Engagement
  engagementRate       Float @default(0)
  avgEngagementPerPost Float @default(0)

  // Performance
  topPerformingPosts   String? // JSON array of post IDs
  worstPerformingPosts String? // JSON array of post IDs
  bestPostingTimes     String? // JSON: optimal times
  audienceInsights     String? // JSON: demographics, behavior

  // Competitive
  industryAvgEngagement Float?
  competitorComparison  String? // JSON: vs competitors

  createdAt DateTime @default(now())

  @@unique([platform, metricType, metricDate])
  @@index([platform])
  @@index([metricDate])
  @@index([engagementRate])
}

// ==================== TASK 79: TECHNICAL SEO AUDIT & IMPLEMENTATION ====================

model TechnicalSEOAudit {
  id        String @id @default(uuid())
  auditType String // FULL, SPEED, MOBILE, CRAWLABILITY, SECURITY, INDEXABILITY
  status    String @default("IN_PROGRESS") // IN_PROGRESS, COMPLETED, FAILED

  // Overall Scores (0-100)
  overallScore      Float @default(0)
  speedScore        Float @default(0)
  mobileScore       Float @default(0)
  crawlabilityScore Float @default(0)
  securityScore     Float @default(0)
  indexabilityScore Float @default(0)

  // Core Web Vitals
  lcpScore  Float? // Largest Contentful Paint
  fidScore  Float? // First Input Delay
  clsScore  Float? // Cumulative Layout Shift
  fcpScore  Float? // First Contentful Paint
  ttfbScore Float? // Time to First Byte
  tbtScore  Float? // Total Blocking Time

  // Issues Found
  criticalIssues Int     @default(0)
  warningIssues  Int     @default(0)
  infoIssues     Int     @default(0)
  issuesDetails  String? // JSON: detailed issues

  // Recommendations
  recommendations String? // JSON: prioritized fixes
  estimatedImpact String? // JSON: impact scores

  // Metadata
  auditDuration     Int? // milliseconds
  pagesAudited      Int     @default(0)
  errorsEncountered String? // JSON: error log

  startedAt          DateTime  @default(now())
  completedAt        DateTime?
  nextAuditScheduled DateTime?

  @@index([auditType])
  @@index([status])
  @@index([overallScore])
  @@index([startedAt])
}

model CoreWebVitals {
  id       String @id @default(uuid())
  url      String
  pageType String // HOME, ARTICLE, CATEGORY, etc.

  // Core Metrics
  lcp  Float // Largest Contentful Paint (ms)
  fid  Float // First Input Delay (ms)
  cls  Float // Cumulative Layout Shift (score)
  fcp  Float // First Contentful Paint (ms)
  ttfb Float // Time to First Byte (ms)
  tbt  Float // Total Blocking Time (ms)

  // Performance Scores
  performanceScore Float  @default(0)
  lcpRating        String // GOOD, NEEDS_IMPROVEMENT, POOR
  fidRating        String
  clsRating        String

  // Page Details
  domContentLoaded Float? // ms
  windowLoad       Float? // ms
  totalPageSize    Float? // KB
  totalRequests    Int?

  // Resource Breakdown
  javascriptSize Float? // KB
  cssSize        Float? // KB
  imageSize      Float? // KB
  fontSize       Float? // KB

  // Device & Network
  deviceType     String // MOBILE, DESKTOP, TABLET
  connectionType String // 4G, 3G, etc.

  measuredAt DateTime @default(now())

  @@index([url])
  @@index([pageType])
  @@index([performanceScore])
  @@index([measuredAt])
}

model MobileSEO {
  id  String @id @default(uuid())
  url String

  // Mobile Friendliness
  isMobileFriendly Boolean @default(false)
  mobileScore      Float   @default(0)

  // Viewport
  hasViewportMeta Boolean @default(false)
  viewportContent String?

  // Touch Elements
  touchTargetsProper Boolean @default(false)
  minTouchTargetSize Int? // pixels
  touchElementsCount Int     @default(0)

  // Content Sizing
  contentFitsViewport Boolean @default(false)
  textSizeAppropriate Boolean @default(false)

  // Mobile Performance
  mobileLCP Float? // ms
  mobileFID Float? // ms
  mobileCLS Float?

  // Mobile-Specific Issues
  flashUsed           Boolean @default(false)
  incompatiblePlugins String? // JSON array

  // Responsive Design
  hasMediaQueries Boolean @default(false)
  breakpoints     String? // JSON array

  // Mobile Indexing
  mobileIndexable Boolean @default(true)
  mobileErrors    String? // JSON array

  auditedAt DateTime @default(now())

  @@index([url])
  @@index([isMobileFriendly])
  @@index([mobileScore])
  @@index([auditedAt])
}

model CrawlabilityAudit {
  id String @id @default(uuid())

  // Robots.txt
  hasRobotsTxt     Boolean @default(false)
  robotsTxtValid   Boolean @default(false)
  robotsTxtContent String?
  robotsTxtErrors  String? // JSON array

  // Sitemap
  hasSitemap      Boolean @default(false)
  sitemapUrl      String?
  sitemapValid    Boolean @default(false)
  sitemapUrlCount Int     @default(0)
  sitemapErrors   String? // JSON array

  // Crawl Stats
  crawlablePages Int @default(0)
  blockedPages   Int @default(0)
  crawlErrors    Int @default(0)

  // Internal Links
  totalInternalLinks  Int @default(0)
  brokenInternalLinks Int @default(0)
  redirectChains      Int @default(0)

  // External Links
  totalExternalLinks  Int @default(0)
  brokenExternalLinks Int @default(0)

  // Crawl Budget
  crawlRate       Float? // pages per day
  crawlEfficiency Float  @default(0) // 0-100

  // Status Codes
  pages200 Int @default(0)
  pages301 Int @default(0)
  pages302 Int @default(0)
  pages404 Int @default(0)
  pages500 Int @default(0)

  // Issues
  orphanedPages    String? // JSON array
  deepPages        String? // JSON: pages > 3 clicks deep
  duplicateContent String? // JSON array

  auditedAt DateTime @default(now())

  @@index([crawlEfficiency])
  @@index([auditedAt])
}

model IndexabilityCheck {
  id  String @id @default(uuid())
  url String

  // Index Status
  isIndexable       Boolean @default(true)
  isIndexed         Boolean @default(false)
  googleIndexStatus String? // INDEXED, NOT_INDEXED, BLOCKED

  // Meta Robots
  hasNoIndex        Boolean @default(false)
  hasNoFollow       Boolean @default(false)
  metaRobotsContent String?

  // Canonical
  hasCanonical     Boolean @default(false)
  canonicalUrl     String?
  canonicalSelfRef Boolean @default(false)

  // Structured Data
  hasStructuredData    Boolean @default(false)
  structuredDataTypes  String? // JSON array: Article, BreadcrumbList, etc.
  structuredDataErrors String? // JSON array

  // Page Quality
  contentLength      Int     @default(0)
  contentQuality     Float   @default(0) // 0-100
  hasH1              Boolean @default(false)
  h1Count            Int     @default(0)
  hasMetaDescription Boolean @default(false)
  metaDescLength     Int?
  hasTitleTag        Boolean @default(false)
  titleLength        Int?

  // Blocking Factors
  blockingFactors String? // JSON array

  // HTTP Headers
  xRobotsTag String?

  checkedAt DateTime @default(now())

  @@index([url])
  @@index([isIndexable])
  @@index([isIndexed])
  @@index([checkedAt])
}

model SecurityAudit {
  id String @id @default(uuid())

  // HTTPS
  hasHTTPS           Boolean   @default(false)
  httpRedirectsHTTPS Boolean   @default(false)
  sslCertValid       Boolean   @default(false)
  sslProvider        String?
  sslExpiresAt       DateTime?

  // Security Headers
  hasHSTS           Boolean @default(false)
  hstsMaxAge        Int?
  hasCSP            Boolean @default(false)
  cspDirectives     String? // JSON
  hasXFrameOptions  Boolean @default(false)
  xFrameOptions     String?
  hasXContentType   Boolean @default(false)
  hasXXSSProtection Boolean @default(false)

  // Security Score
  securityScore Float @default(0) // 0-100

  // Mixed Content
  hasMixedContent  Boolean @default(false)
  mixedContentUrls String? // JSON array

  // Vulnerabilities
  knownVulnerabilities String? // JSON array
  securityRisks        String? // JSON array

  // Malware & Blacklists
  malwareDetected  Boolean @default(false)
  blacklisted      Boolean @default(false)
  blacklistSources String? // JSON array

  auditedAt DateTime @default(now())

  @@index([securityScore])
  @@index([hasHTTPS])
  @@index([auditedAt])
}

model SEOPerformanceMetrics {
  id         String   @id @default(uuid())
  metricDate DateTime

  // Overall Health
  seoHealthScore Float @default(0) // 0-100

  // Technical Scores
  speedScore        Float @default(0)
  mobileScore       Float @default(0)
  crawlabilityScore Float @default(0)
  securityScore     Float @default(0)
  indexabilityScore Float @default(0)

  // Core Web Vitals Averages
  avgLCP  Float?
  avgFID  Float?
  avgCLS  Float?
  avgFCP  Float?
  avgTTFB Float?

  // Page Stats
  totalPages     Int @default(0)
  indexedPages   Int @default(0)
  indexablePages Int @default(0)
  blockedPages   Int @default(0)

  // Issues Summary
  totalCriticalIssues Int @default(0)
  totalWarningIssues  Int @default(0)
  totalInfoIssues     Int @default(0)

  // Performance Trends
  scoreChange    Float? // vs previous day
  issuesResolved Int    @default(0)
  newIssuesFound Int    @default(0)

  createdAt DateTime @default(now())

  @@unique([metricDate])
  @@index([seoHealthScore])
  @@index([metricDate])
}

// ============================================================================
// TASK 80: Local SEO & Google My Business Optimization
// ============================================================================

model GoogleMyBusiness {
  id String @id @default(uuid())

  // Business Information
  businessName        String
  businessDescription String?
  businessCategory    String // PRIMARY, SECONDARY, TERTIARY
  categories          String // JSON array of categories

  // Location
  country    String
  city       String
  region     String // State/Province
  address    String?
  postalCode String?
  latitude   Float?
  longitude  Float?

  // Contact
  phone   String?
  email   String?
  website String?

  // Profile Completeness
  completionScore Float  @default(0) // 0-100
  profileStatus   String @default("INCOMPLETE") // INCOMPLETE, COMPLETE, VERIFIED, OPTIMIZED

  // Verification
  isVerified         Boolean   @default(false)
  verificationMethod String? // PHONE, EMAIL, POSTCARD, VIDEO
  verifiedAt         DateTime?

  // Business Hours (JSON)
  businessHours String? // JSON object

  // Media
  logoUrl       String?
  coverImageUrl String?
  photoCount    Int     @default(0)
  videoCount    Int     @default(0)

  // SEO Metrics
  localSearchRanking Int? // Position in local search
  mapPackRanking     Int? // Position in map pack (top 3)
  avgRating          Float?
  reviewCount        Int    @default(0)

  // Performance
  profileViews      Int @default(0)
  searchViews       Int @default(0)
  directionsClicked Int @default(0)
  phoneClicked      Int @default(0)
  websiteClicked    Int @default(0)

  // Optimization Status
  lastOptimizedAt DateTime?
  nextAuditAt     DateTime?

  // Relations
  keywords  LocalKeyword[]
  citations LocalCitation[]
  reviews   LocalReview[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([country, city])
  @@index([completionScore])
  @@index([localSearchRanking])
  @@index([isVerified])
}

model LocalKeyword {
  id String @id @default(uuid())

  // GMB Relation
  gmbId String
  gmb   GoogleMyBusiness @relation(fields: [gmbId], references: [id], onDelete: Cascade)

  // Keyword Information
  keyword     String
  keywordType String // CITY, REGION, SERVICE, PRODUCT, BRANDED

  // Location
  targetCity    String
  targetRegion  String?
  targetCountry String

  // SEO Metrics
  searchVolume Int    @default(0)
  difficulty   Float  @default(0) // 0-100
  competition  String @default("MEDIUM") // LOW, MEDIUM, HIGH

  // Ranking
  currentRanking  Int?
  previousRanking Int?
  bestRanking     Int?
  rankingChange   Int  @default(0)

  // Performance
  clicks      Int   @default(0)
  impressions Int   @default(0)
  ctr         Float @default(0)

  // Optimization
  isTargeted        Boolean  @default(true)
  optimizationScore Float    @default(0) // 0-100
  lastTrackedAt     DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([gmbId])
  @@index([targetCity, targetCountry])
  @@index([currentRanking])
  @@index([keywordType])
}

model LocalCitation {
  id String @id @default(uuid())

  // GMB Relation
  gmbId String
  gmb   GoogleMyBusiness @relation(fields: [gmbId], references: [id], onDelete: Cascade)

  // Directory Information
  directoryName String
  directoryUrl  String
  directoryType String // LOCAL, NATIONAL, INDUSTRY, SOCIAL

  // Business Listing
  listingUrl      String?
  businessName    String
  businessAddress String?
  businessPhone   String?
  businessWebsite String?

  // NAP Consistency (Name, Address, Phone)
  napConsistent Boolean @default(true)
  napIssues     String? // JSON array

  // Authority Metrics
  domainAuthority Float @default(0) // 0-100
  trustFlow       Float @default(0)
  citationFlow    Float @default(0)

  // Status
  citationStatus String  @default("PENDING") // PENDING, VERIFIED, CLAIMED, INCONSISTENT
  isClaimed      Boolean @default(false)
  isVerified     Boolean @default(false)

  // Performance
  referralTraffic Int   @default(0)
  localRelevance  Float @default(0) // 0-100

  // Dates
  submittedAt   DateTime?
  verifiedAt    DateTime?
  lastCheckedAt DateTime  @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([gmbId])
  @@index([citationStatus])
  @@index([directoryType])
  @@index([domainAuthority])
}

model LocalReview {
  id String @id @default(uuid())

  // GMB Relation
  gmbId String
  gmb   GoogleMyBusiness @relation(fields: [gmbId], references: [id], onDelete: Cascade)

  // Review Information
  reviewerName   String
  reviewerAvatar String?

  // Rating
  rating Float // 1-5 stars

  // Content
  reviewTitle    String?
  reviewText     String
  reviewLanguage String  @default("en")

  // Platform
  platform         String // GOOGLE, FACEBOOK, TRUSTPILOT, YELP, etc.
  platformReviewId String?
  reviewUrl        String?

  // Sentiment Analysis
  sentiment      String? // POSITIVE, NEUTRAL, NEGATIVE
  sentimentScore Float? // -1 to 1
  keyTopics      String? // JSON array

  // Response
  hasResponse    Boolean   @default(false)
  responseText   String?
  respondedAt    DateTime?
  responseAuthor String?

  // Verification
  isVerified         Boolean @default(false)
  isPurchaseVerified Boolean @default(false)

  // Helpful Votes
  helpfulCount    Int @default(0)
  notHelpfulCount Int @default(0)

  // Moderation
  isFlagged        Boolean @default(false)
  flagReason       String?
  moderationStatus String  @default("APPROVED") // PENDING, APPROVED, REJECTED, FLAGGED

  // Dates
  reviewDate  DateTime
  publishedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([gmbId])
  @@index([rating])
  @@index([platform])
  @@index([sentiment])
  @@index([reviewDate])
}

model LocalContent {
  id String @id @default(uuid())

  // Content Information
  articleId String?
  title     String
  slug      String  @unique

  // Location Targeting
  targetCity    String
  targetRegion  String?
  targetCountry String

  // Content Type
  contentType String // ARTICLE, GUIDE, NEWS, EVENT, DIRECTORY

  // SEO
  localKeywords String // JSON array
  geoTags       String? // JSON array

  // Performance
  localViews      Int   @default(0)
  localShares     Int   @default(0)
  localEngagement Float @default(0) // 0-100

  // Ranking
  localSearchRanking Int?

  // Optimization
  optimizationScore Float   @default(0) // 0-100
  isOptimized       Boolean @default(false)

  // Publication
  publishedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([targetCity, targetCountry])
  @@index([contentType])
  @@index([localSearchRanking])
  @@index([publishedAt])
}

model LocalSEOMetrics {
  id         String   @id @default(uuid())
  metricDate DateTime

  // GMB Performance
  avgCompletionScore Float @default(0)
  verifiedBusinesses Int   @default(0)
  totalBusinesses    Int   @default(0)

  // Local Rankings
  avgLocalRanking    Float?
  mapPackAppearances Int    @default(0) // Top 3 appearances
  localTop3Count     Int    @default(0)
  localTop10Count    Int    @default(0)

  // Keywords
  totalLocalKeywords Int @default(0)
  rankedKeywords     Int @default(0)
  top3Keywords       Int @default(0)
  top10Keywords      Int @default(0)

  // Citations
  totalCitations     Int   @default(0)
  verifiedCitations  Int   @default(0)
  claimedCitations   Int   @default(0)
  napConsistencyRate Float @default(0) // 0-100

  // Reviews
  totalReviews    Int    @default(0)
  avgRating       Float?
  positiveReviews Int    @default(0)
  negativeReviews Int    @default(0)
  responseRate    Float  @default(0) // 0-100

  // Content
  localContentCount Int   @default(0)
  avgContentScore   Float @default(0)

  // Traffic
  localSearchViews  Int @default(0)
  directionsClicked Int @default(0)
  phoneClicked      Int @default(0)
  websiteClicked    Int @default(0)

  // Overall Health
  localSEOScore Float @default(0) // 0-100

  createdAt DateTime @default(now())

  @@unique([metricDate])
  @@index([metricDate])
  @@index([localSEOScore])
}

// ============================================================
// TASK 81: IMAGE OPTIMIZATION SYSTEM
// ============================================================

model OptimizedImage {
  id             String @id @default(uuid())
  originalPath   String // Original image path/URL
  originalSize   Int // Size in bytes
  originalFormat String // jpeg, png, svg, etc.
  originalWidth  Int
  originalHeight Int

  // Processing Status
  status         String  @default("pending") // pending, processing, completed, failed
  processingTime Int? // Processing time in milliseconds
  errorMessage   String?

  // Optimized Versions
  webpPath String?
  webpSize Int?
  avifPath String?
  avifSize Int?

  // Thumbnails
  smallPath  String? // 320px
  smallSize  Int?
  mediumPath String? // 640px
  mediumSize Int?
  largePath  String? // 1024px
  largeSize  Int?

  // Metadata
  hasWatermark      Boolean @default(false)
  watermarkPosition String? // top-left, top-right, bottom-left, bottom-right, center
  focalPointX       Float? // 0-1 (smart cropping)
  focalPointY       Float? // 0-1 (smart cropping)
  altText           String?
  metadata          String? // JSON: EXIF, copyright, etc.

  // Optimization Metrics
  compressionRatio Float @default(0) // 0-100
  qualityScore     Int   @default(80) // 1-100
  sizeSavings      Int   @default(0) // Bytes saved
  savingsPercent   Float @default(0) // 0-100

  // Lazy Loading
  placeholderBase64 String? // Tiny blurred placeholder

  // Usage Tracking
  viewCount      Int @default(0)
  bandwidthSaved Int @default(0) // Total bytes saved from serving optimized versions

  // Batch Processing
  batchId String?
  Batch   ImageBatch? @relation(fields: [batchId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([batchId])
  @@index([originalPath])
  @@index([createdAt])
}

model ImageBatch {
  id          String  @id @default(uuid())
  name        String
  description String?

  // Batch Status
  status          String @default("pending") // pending, processing, completed, failed, paused
  totalImages     Int    @default(0)
  processedImages Int    @default(0)
  failedImages    Int    @default(0)

  // Progress Tracking
  progressPercent   Float @default(0) // 0-100
  currentImageIndex Int   @default(0)
  estimatedTimeLeft Int? // Seconds

  // Batch Configuration
  config String // JSON: quality, formats, watermark, etc.

  // Results
  totalOriginalSize  Int  @default(0)
  totalOptimizedSize Int  @default(0)
  totalSizeSavings   Int  @default(0)
  avgProcessingTime  Int? // Milliseconds per image

  // Batch Metadata
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  Images OptimizedImage[]

  @@index([status])
  @@index([createdAt])
}

model ImageFormat {
  id       String @id @default(uuid())
  format   String @unique // webp, avif, jpeg, png, svg
  mimeType String // image/webp, image/avif, etc.

  // Format Capabilities
  supportsAlpha     Boolean @default(false)
  supportsAnimation Boolean @default(false)
  isLossy           Boolean @default(true)

  // Browser Support
  browserSupport String // JSON: { chrome: 23, firefox: 65, safari: 14, edge: 18 }

  // Performance
  avgCompressionRatio Float @default(0) // Compared to JPEG baseline
  avgQualityScore     Float @default(80)

  // Usage Statistics
  usageCount      Int @default(0)
  totalBytesSaved Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([format])
}

model ImageWatermark {
  id        String @id @default(uuid())
  name      String
  imagePath String // Path to watermark image

  // Position & Styling
  defaultPosition String @default("bottom-right") // top-left, top-right, bottom-left, bottom-right, center
  defaultOpacity  Float  @default(0.3) // 0-1
  defaultScale    Float  @default(0.1) // 0-1 (relative to image size)

  // Usage
  isActive   Boolean @default(true)
  usageCount Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
}

model ImageOptimizationMetrics {
  id         String   @id @default(uuid())
  metricDate DateTime @unique

  // Processing Stats
  totalImagesProcessed Int   @default(0)
  totalProcessingTime  Int   @default(0) // Milliseconds
  avgProcessingTime    Int   @default(0) // Milliseconds per image
  failedProcessing     Int   @default(0)
  successRate          Float @default(0) // 0-100

  // Format Distribution
  webpGenerated Int @default(0)
  avifGenerated Int @default(0)
  jpegGenerated Int @default(0)
  pngGenerated  Int @default(0)

  // Optimization Results
  totalOriginalSize   Int   @default(0) // Bytes
  totalOptimizedSize  Int   @default(0) // Bytes
  totalBytesSaved     Int   @default(0)
  avgCompressionRatio Float @default(0) // 0-100

  // Bandwidth Savings
  totalBandwidthSaved  Int   @default(0) // Bytes saved from serving optimized images
  estimatedCostSavings Float @default(0) // USD

  // Thumbnails Generated
  smallThumbnails  Int @default(0)
  mediumThumbnails Int @default(0)
  largeThumbnails  Int @default(0)

  // Watermarks Applied
  watermarksApplied Int @default(0)

  // Quality Metrics
  avgQualityScore Float @default(0) // 0-100

  // Cache Performance
  cacheHitRate Float @default(0) // 0-100
  cachedImages Int   @default(0)

  createdAt DateTime @default(now())

  @@index([metricDate])
}

// ============================================
// TASK 84: Security Alert System
// ============================================

model SecurityAlert {
  id String @id @default(uuid())

  // Alert Information
  title    String
  message  String
  severity String // low, medium, high, critical
  category String // threat, recommendation, compliance, seo_security

  // Threat Details (for threat category)
  threatType   String? // sql_injection, xss, ddos, brute_force, negative_seo, ranking_manipulation
  threatSource String? // IP address or source identifier
  isBlocked    Boolean @default(false)
  blockDetails String? // JSON: how the threat was blocked

  // Recommendation Details (for recommendation category)
  recommendationType String? // security_patch, configuration_change, dependency_update, seo_improvement
  priority           String  @default("medium") // low, medium, high, urgent
  actionRequired     String? // Specific action to take
  actionUrl          String? // URL to take action (e.g., settings page)

  // Compliance Details (for compliance category)
  complianceType String? // gdpr, ccpa, pci_dss, google_guidelines, eeat_standards
  regulatoryBody String? // EU, FTC, PCI Council, Google, etc.
  deadline       DateTime? // Compliance deadline if applicable

  // SEO Security Details (for seo_security category)
  seoThreatType String? // negative_seo, link_spam, content_scraping, ranking_manipulation
  affectedUrls  String? // JSON array of affected URLs
  impactScore   Float? // 0-100, estimated impact on rankings

  // Display & Behavior
  isRead         Boolean   @default(false)
  isDismissed    Boolean   @default(false)
  dismissedBy    String? // User ID who dismissed
  dismissedAt    DateTime?
  isPinned       Boolean   @default(false)
  showOnHomepage Boolean   @default(true)

  // Actions Taken
  actionTaken   Boolean   @default(false)
  actionDetails String? // JSON: details of action taken
  actionTakenAt DateTime?
  actionTakenBy String? // User ID who took action

  // Metadata
  metadata      String? // JSON: additional alert-specific data
  relatedAlerts String? // JSON: array of related alert IDs

  // Timestamps
  detectedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([severity, createdAt])
  @@index([category, createdAt])
  @@index([isDismissed, isRead])
  @@index([showOnHomepage])
  @@index([detectedAt])
}

model ThreatLog {
  id String @id @default(uuid())

  // Threat Information
  threatType   String // sql_injection, xss, ddos, brute_force, etc.
  threatSource String // IP address or source identifier
  threatVector String // http_request, api_call, form_submission, etc.

  // Request Details
  requestUrl     String?
  requestMethod  String? // GET, POST, PUT, DELETE
  requestHeaders String? // JSON
  requestBody    String? // JSON (sanitized)
  userAgent      String?

  // Detection Details
  detectionMethod String // waf, ids, rate_limiter, pattern_matching, ai_detection
  detectionRule   String? // Specific rule that triggered detection
  confidenceScore Float   @default(0) // 0-100

  // Response
  wasBlocked    Boolean @default(false)
  blockMethod   String? // ip_block, rate_limit, captcha, deny_access
  blockDuration Int? // Duration in minutes (null = permanent)

  // Impact
  potentialDamage String? // Description of what could have happened
  actualDamage    String? // Description of any actual damage

  // Geolocation
  country String?
  region  String?
  city    String?

  // Timestamps
  detectedAt DateTime  @default(now())
  blockedAt  DateTime?
  createdAt  DateTime  @default(now())

  @@index([threatType, detectedAt])
  @@index([threatSource])
  @@index([wasBlocked])
  @@index([detectedAt])
}

model SecurityRecommendation {
  id String @id @default(uuid())

  // Recommendation Information
  title       String
  description String
  category    String // security_patch, configuration, dependency, seo, performance
  priority    String @default("medium") // low, medium, high, urgent

  // Details
  currentState       String? // Description of current configuration/state
  recommendedState   String? // Description of recommended configuration/state
  impactDescription  String? // What happens if not implemented
  benefitDescription String? // What happens if implemented

  // Implementation
  actionRequired String // Specific action to take
  actionUrl      String? // URL to take action
  estimatedTime  Int? // Estimated time in minutes
  difficulty     String  @default("medium") // easy, medium, hard, expert

  // Documentation
  documentationUrl String?
  tutorialUrl      String?

  // Status
  status        String    @default("pending") // pending, in_progress, completed, dismissed
  implementedBy String? // User ID
  implementedAt DateTime?
  dismissedBy   String? // User ID
  dismissedAt   DateTime?
  dismissReason String?

  // Tracking
  viewCount  Int @default(0)
  clickCount Int @default(0)

  // Auto-Implementation
  canAutoImplement    Boolean @default(false)
  autoImplementScript String? // Script to auto-implement

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category, priority])
  @@index([status, createdAt])
  @@index([priority, status])
}

model ComplianceUpdate {
  id String @id @default(uuid())

  // Update Information
  title          String
  description    String
  complianceType String // gdpr, ccpa, pci_dss, google_guidelines, eeat_standards
  regulatoryBody String // EU, FTC, PCI Council, Google, etc.

  // Details
  changeType    String // new_requirement, updated_requirement, removed_requirement
  effectiveDate DateTime // When the change takes effect
  deadline      DateTime? // Compliance deadline if applicable

  // Impact Assessment
  impactLevel       String  @default("medium") // low, medium, high, critical
  impactDescription String? // How this affects the platform
  affectedAreas     String? // JSON: list of affected areas

  // Required Actions
  actionsRequired String // JSON: list of actions needed
  estimatedEffort String? // Time estimate for implementation

  // Documentation
  officialUrl      String? // Link to official announcement
  documentationUrl String? // Link to detailed documentation
  internalGuideUrl String? // Link to internal implementation guide

  // Status
  status        String    @default("pending") // pending, in_progress, completed
  implementedBy String? // User ID
  implementedAt DateTime?
  notes         String? // Implementation notes

  // Tracking
  viewCount      Int       @default(0)
  isAcknowledged Boolean   @default(false)
  acknowledgedBy String? // User ID
  acknowledgedAt DateTime?

  // Timestamps
  announcedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([complianceType, effectiveDate])
  @@index([status, deadline])
  @@index([effectiveDate])
}

model SEOSecurityIncident {
  id String @id @default(uuid())

  // Incident Information
  incidentType String // negative_seo, link_spam, content_scraping, ranking_manipulation, algorithm_penalty
  title        String
  description  String
  severity     String @default("medium") // low, medium, high, critical

  // Detection
  detectionMethod String // manual, automated, google_search_console, rank_tracking, backlink_monitor
  detectedBy      String? // User ID or system
  confidenceScore Float   @default(0) // 0-100

  // Impact
  affectedUrls     String? // JSON: array of affected URLs
  affectedKeywords String? // JSON: array of affected keywords
  rankingImpact    Float? // Percentage change in rankings
  trafficImpact    Float? // Percentage change in traffic
  impactScore      Float   @default(0) // 0-100, overall impact

  // Link Spam Details (if applicable)
  spamLinks       String? // JSON: array of spam links
  spamDomains     String? // JSON: array of spam domains
  disavowRequired Boolean @default(false)
  disavowFileUrl  String?

  // Content Scraping Details (if applicable)
  scrapedUrls    String? // JSON: array of URLs where content was scraped
  scraperDomains String? // JSON: array of scraper domains
  dmcaFiled      Boolean @default(false)
  dmcaDetails    String? // JSON: DMCA filing details

  // Recovery
  status            String    @default("investigating") // investigating, mitigating, recovering, resolved
  resolutionSteps   String? // JSON: array of steps taken
  recoveryProgress  Float     @default(0) // 0-100
  estimatedRecovery DateTime? // Estimated recovery date

  // Actions Taken
  actionsTaken      String? // JSON: detailed actions
  googleReportFiled Boolean @default(false)
  googleReportUrl   String?

  // Timestamps
  detectedAt DateTime  @default(now())
  resolvedAt DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([incidentType, detectedAt])
  @@index([severity, status])
  @@index([status, detectedAt])
}

model SecurityAlertMetrics {
  id         String   @id @default(uuid())
  metricDate DateTime @unique

  // Alert Statistics
  totalAlerts       Int @default(0)
  newAlerts         Int @default(0)
  dismissedAlerts   Int @default(0)
  actionTakenAlerts Int @default(0)

  // By Severity
  lowSeverity      Int @default(0)
  mediumSeverity   Int @default(0)
  highSeverity     Int @default(0)
  criticalSeverity Int @default(0)

  // By Category
  threatAlerts         Int @default(0)
  recommendationAlerts Int @default(0)
  complianceAlerts     Int @default(0)
  seoSecurityAlerts    Int @default(0)

  // Threat Statistics
  totalThreats        Int   @default(0)
  blockedThreats      Int   @default(0)
  blockRate           Float @default(0) // 0-100
  avgThreatConfidence Float @default(0) // 0-100

  // Top Threats
  topThreatType   String?
  topThreatSource String?

  // Recommendations
  totalRecommendations       Int   @default(0)
  implementedRecommendations Int   @default(0)
  implementationRate         Float @default(0) // 0-100

  // Compliance
  totalComplianceUpdates Int   @default(0)
  pendingCompliance      Int   @default(0)
  completedCompliance    Int   @default(0)
  complianceRate         Float @default(0) // 0-100

  // SEO Security
  totalSEOIncidents    Int   @default(0)
  resolvedSEOIncidents Int   @default(0)
  activeSEOIncidents   Int   @default(0)
  avgImpactScore       Float @default(0) // 0-100

  // Response Time
  avgResponseTime   Int @default(0) // Minutes from detection to action
  avgResolutionTime Int @default(0) // Minutes from detection to resolution

  // Overall Security Score
  securityScore Float @default(0) // 0-100

  createdAt DateTime @default(now())

  @@index([metricDate])
}

// ============================================
// TASK 85: COMPLIANCE MONITORING DASHBOARD
// ============================================

model ComplianceMonitorRule {
  id String @id @default(uuid())

  // Rule Information
  title          String
  description    String
  ruleType       String // gdpr, ccpa, pci_dss, google_guidelines, eeat_standards, seo_compliance
  regulatoryBody String // EU, FTC, PCI Council, Google, etc.

  // Requirements
  requirement         String // What needs to be compliant
  implementationGuide String // How to implement
  verificationMethod  String // How to verify compliance

  // Priority and Impact
  priority    String @default("medium") // low, medium, high, critical
  impactLevel String @default("medium") // low, medium, high, critical

  // Status
  isActive           Boolean @default(true)
  isAutoVerified     Boolean @default(false) // Can be verified automatically
  verificationScript String? // Automated verification script

  // Documentation
  officialUrl      String?
  documentationUrl String?
  internalGuideUrl String?

  // Metadata
  tags     String? // JSON: array of tags
  category String? // technical, content, privacy, security, seo

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ComplianceMonitorCheck ComplianceMonitorCheck[]

  @@index([ruleType, isActive])
  @@index([priority, isActive])
  @@index([category, isActive])
}

model ComplianceMonitorCheck {
  id     String @id @default(uuid())
  ruleId String

  // Check Details
  checkDate   DateTime @default(now())
  checkMethod String // manual, automated, scheduled
  checkedBy   String? // User ID or 'system'

  // Results
  status          String // compliant, non_compliant, partial, needs_review
  complianceScore Float  @default(0) // 0-100

  // Findings
  findings        String? // JSON: detailed findings
  issues          String? // JSON: array of issues found
  recommendations String? // JSON: array of recommendations

  // Evidence
  evidenceUrls String? // JSON: array of evidence URLs
  evidenceData String? // JSON: supporting data
  screenshots  String? // JSON: array of screenshot URLs

  // Actions
  actionsRequired String? // JSON: required actions
  actionsTaken    String? // JSON: actions already taken
  estimatedEffort String? // Time estimate

  // Follow-up
  nextCheckDate DateTime?
  reminderDate  DateTime?
  isResolved    Boolean   @default(false)
  resolvedAt    DateTime?
  resolvedBy    String? // User ID

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  ComplianceMonitorRule ComplianceMonitorRule @relation(fields: [ruleId], references: [id])

  @@index([ruleId, checkDate])
  @@index([status, checkDate])
  @@index([checkDate])
  @@index([nextCheckDate])
}

model SEOComplianceMonitorRule {
  id String @id @default(uuid())

  // Rule Information
  title         String
  description   String
  guidelineType String // google_guidelines, eeat_standards, core_web_vitals, schema_markup
  source        String // Google, Bing, Industry Standard

  // E-E-A-T Components (if applicable)
  eeatComponent String? // experience, expertise, authoritativeness, trustworthiness, overall

  // Requirements
  requirement    String
  bestPractices  String // JSON: array of best practices
  commonMistakes String? // JSON: array of common mistakes

  // Metrics
  targetMetric String? // What to measure
  targetValue  String? // Target value
  currentValue String? // Current value

  // Priority
  priority         String @default("medium") // low, medium, high, critical
  impactOnRankings String @default("medium") // low, medium, high, critical

  // Implementation
  implementationGuide String
  verificationSteps   String // JSON: array of verification steps
  tools               String? // JSON: recommended tools

  // Status
  isActive            Boolean @default(true)
  isAutoMonitored     Boolean @default(false)
  monitoringFrequency String? // daily, weekly, monthly

  // Documentation
  officialUrl      String?
  documentationUrl String?
  tutorialUrl      String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  SEOComplianceMonitorCheck SEOComplianceMonitorCheck[]

  @@index([guidelineType, isActive])
  @@index([eeatComponent, isActive])
  @@index([priority, isActive])
}

model SEOComplianceMonitorCheck {
  id        String  @id @default(uuid())
  ruleId    String
  contentId String? // Article ID or null for site-wide

  // Check Details
  checkDate   DateTime @default(now())
  checkMethod String // manual, automated, scheduled, real_time
  checkedBy   String? // User ID or 'system'

  // Results
  status          String // compliant, non_compliant, partial, warning, passed
  complianceScore Float  @default(0) // 0-100
  eeatScore       Float? // 0-100 if E-E-A-T related

  // Findings
  passedChecks String? // JSON: array of passed checks
  failedChecks String? // JSON: array of failed checks
  warnings     String? // JSON: array of warnings

  // Metrics
  measuredValue String? // Actual measured value
  targetValue   String? // Target value
  deviation     Float? // Percentage deviation

  // Impact
  impactAssessment String? // How non-compliance affects rankings
  urgencyLevel     String  @default("normal") // low, normal, high, urgent

  // Recommendations
  recommendations String? // JSON: detailed recommendations
  quickFixes      String? // JSON: quick fix suggestions
  estimatedEffort String?

  // Actions
  actionsRequired String? // JSON: required actions
  actionsTaken    String? // JSON: actions taken
  isResolved      Boolean   @default(false)
  resolvedAt      DateTime?

  // Follow-up
  nextCheckDate DateTime?
  reminderSent  Boolean   @default(false)

  // Notes
  notes String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  SEOComplianceMonitorRule SEOComplianceMonitorRule @relation(fields: [ruleId], references: [id])

  @@index([ruleId, checkDate])
  @@index([status, checkDate])
  @@index([contentId, status])
  @@index([checkDate])
  @@index([nextCheckDate])
}

model ComplianceMonitorScore {
  id        String   @id @default(uuid())
  scoreDate DateTime @unique

  // Overall Scores
  overallScore    Float @default(0) // 0-100
  regulatoryScore Float @default(0) // GDPR, CCPA, PCI DSS
  seoScore        Float @default(0) // Google guidelines, E-E-A-T
  securityScore   Float @default(0) // Security compliance

  // Regulatory Compliance
  gdprScore   Float @default(0) // 0-100
  ccpaScore   Float @default(0) // 0-100
  pciDssScore Float @default(0) // 0-100

  // SEO Compliance
  googleGuidelinesScore Float @default(0) // 0-100
  eeatScore             Float @default(0) // 0-100
  coreWebVitalsScore    Float @default(0) // 0-100
  schemaMarkupScore     Float @default(0) // 0-100

  // E-E-A-T Components
  experienceScore        Float @default(0) // 0-100
  expertiseScore         Float @default(0) // 0-100
  authoritativenessScore Float @default(0) // 0-100
  trustworthinessScore   Float @default(0) // 0-100

  // Statistics
  totalRules        Int @default(0)
  compliantRules    Int @default(0)
  nonCompliantRules Int @default(0)
  partialCompliance Int @default(0)

  totalChecks   Int @default(0)
  passedChecks  Int @default(0)
  failedChecks  Int @default(0)
  warningChecks Int @default(0)

  // Trends
  scoreTrend  String @default("stable") // improving, stable, declining
  scoreChange Float  @default(0) // Change from previous score

  // Risk Assessment
  highRiskIssues   Int @default(0)
  mediumRiskIssues Int @default(0)
  lowRiskIssues    Int @default(0)

  // Actions
  openActions      Int @default(0)
  completedActions Int @default(0)
  overdueActions   Int @default(0)

  // Timestamps
  createdAt DateTime @default(now())

  @@index([scoreDate])
}

model ComplianceMonitorNotification {
  id String @id @default(uuid())

  // Notification Details
  type     String // rule_update, check_failed, deadline_approaching, new_requirement
  title    String
  message  String
  priority String @default("medium") // low, medium, high, urgent

  // Related Items
  ruleId   String?
  checkId  String?
  updateId String? // ComplianceUpdate ID

  // Recipients
  recipientRole   String? // admin, super_admin, compliance_officer
  recipientUserId String?

  // Delivery
  channels       String // JSON: email, in_app, slack, etc.
  deliveryStatus String    @default("pending") // pending, sent, failed
  sentAt         DateTime?

  // Interaction
  isRead      Boolean   @default(false)
  readAt      DateTime?
  isDismissed Boolean   @default(false)
  dismissedAt DateTime?

  // Actions
  actionRequired Boolean   @default(false)
  actionUrl      String?
  actionTaken    Boolean   @default(false)
  actionTakenAt  DateTime?

  // Metadata
  metadata String? // JSON: additional data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type, createdAt])
  @@index([recipientUserId, isRead])
  @@index([priority, deliveryStatus])
  @@index([createdAt])
}

model ComplianceMonitorMetrics {
  id         String   @id @default(uuid())
  metricDate DateTime @unique

  // Overall Metrics
  totalRules  Int @default(0)
  activeRules Int @default(0)

  totalChecks     Int @default(0)
  checksToday     Int @default(0)
  checksThisWeek  Int @default(0)
  checksThisMonth Int @default(0)

  // Compliance Status
  compliantItems    Int @default(0)
  nonCompliantItems Int @default(0)
  partialCompliant  Int @default(0)
  needsReview       Int @default(0)

  complianceRate Float @default(0) // 0-100

  // By Type
  gdprCompliance   Int @default(0)
  ccpaCompliance   Int @default(0)
  pciCompliance    Int @default(0)
  googleCompliance Int @default(0)
  eeatCompliance   Int @default(0)

  // Issues
  criticalIssues Int @default(0)
  highIssues     Int @default(0)
  mediumIssues   Int @default(0)
  lowIssues      Int @default(0)

  resolvedIssues Int @default(0)
  openIssues     Int @default(0)

  // Actions
  totalActions     Int @default(0)
  completedActions Int @default(0)
  pendingActions   Int @default(0)
  overdueActions   Int @default(0)

  avgResolutionTime Int @default(0) // Minutes

  // Notifications
  totalNotifications Int @default(0)
  sentNotifications  Int @default(0)
  readNotifications  Int @default(0)

  // Scores
  avgComplianceScore Float @default(0) // 0-100
  avgSEOScore        Float @default(0) // 0-100
  avgEEATScore       Float @default(0) // 0-100

  // Timestamps
  createdAt DateTime @default(now())

  @@index([metricDate])
}

model UserFeedback {
  id               String  @id @default(uuid())
  userId           String
  articleId        String?
  feedbackType     String // content, translation, recommendation
  feedbackCategory String? // helpful, not_helpful, inaccurate, well_written, poor_quality, etc.
  rating           Int? // 1-5 stars
  comment          String?

  // Translation-specific
  language            String?
  issueType           String? // inaccurate, missing_context, grammatical, cultural, formatting, unclear
  severity            String? // low, normal, high, urgent
  suggestedCorrection String?
  ticketId            String?

  // Metadata
  metadata String? // JSON: additional data

  // Impact tracking
  impactScore Float?    @default(0)
  isResolved  Boolean   @default(false)
  resolvedAt  DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  User    User     @relation(fields: [userId], references: [id])
  Article Article? @relation(fields: [articleId], references: [id])

  @@index([userId, createdAt])
  @@index([articleId])
  @@index([feedbackType, createdAt])
  @@index([rating])
  @@index([isResolved])
  @@index([language])
}

// AI Content Moderation Models

model ViolationReport {
  id            String  @id @default(cuid())
  userId        String
  contentType   String // article, comment, post, message
  contentId     String
  violationType String // religious, hate_speech, harassment, sexual, spam, other
  severity      String // low, medium, high, critical
  confidence    Float // AI confidence score 0-1
  aiModel       String // which AI model detected it
  content       String // the violating content
  context       String? // surrounding context for analysis

  // Detection details
  detectedPatterns String? // JSON: specific patterns detected
  keywords         String? // JSON: flagged keywords

  // Status tracking
  status     String    @default("PENDING") // pending, confirmed, false_positive, dismissed
  reviewedAt DateTime?
  reviewedBy String? // admin user ID

  // Penalty tracking
  penaltyApplied  String? // shadow_ban, outright_ban, official_ban
  penaltyDuration Int? // duration in hours
  penaltyReason   String?

  // Resolution
  resolution      String? // confirmed, false_positive, adjusted
  resolutionNotes String?

  // Metadata
  metadata String? // JSON: additional data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  User          User            @relation(fields: [userId], references: [id])
  UserPenalty   UserPenalty[]
  FalsePositive FalsePositive[]

  @@index([userId, createdAt])
  @@index([violationType, severity])
  @@index([status, createdAt])
  @@index([contentType, contentId])
  @@index([confidence])
  @@index([severity, createdAt])
}

model UserPenalty {
  id                String @id @default(cuid())
  userId            String
  violationReportId String
  penaltyType       String // shadow_ban, outright_ban, official_ban
  severity          String // level_1, level_2, level_3

  // Duration and status
  startDate DateTime  @default(now())
  endDate   DateTime?
  duration  Int // duration in hours
  isActive  Boolean   @default(true)

  // Escalation tracking
  escalationLevel Int     @default(1) // 1, 2, 3
  isAutomatic     Boolean @default(true)

  // Impact
  contentHidden Boolean @default(true)
  accountFrozen Boolean @default(false)
  ipBanned      Boolean @default(false)
  emailBanned   Boolean @default(false)

  // Appeal process
  appealStatus      String? // none, submitted, under_review, approved, denied
  appealReason      String?
  appealSubmittedAt DateTime?
  appealResolvedAt  DateTime?
  appealResolvedBy  String? // admin user ID

  // Resolution
  resolvedAt       DateTime?
  resolvedBy       String? // admin user ID
  resolutionReason String?

  // Admin tracking
  appliedBy String? // admin user ID who applied the penalty
  notes     String? // admin notes

  // Metadata
  metadata String? // JSON: additional data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  User            User            @relation(fields: [userId], references: [id])
  ViolationReport ViolationReport @relation(fields: [violationReportId], references: [id])
  appliedByUser   User?           @relation(fields: [appliedBy], references: [id], name: "AppliedPenalties")

  @@index([userId, isActive])
  @@index([penaltyType, isActive])
  @@index([escalationLevel])
  @@index([startDate, endDate])
  @@index([appealStatus])
}

model UserReputation {
  id     String @id @default(cuid())
  userId String @unique

  // Reputation scores
  overallScore        Float @default(100.0) // 0-100
  contentQualityScore Float @default(100.0)
  communityScore      Float @default(100.0)
  violationScore      Float @default(0.0) // penalty score

  // Violation statistics
  totalViolations      Int @default(0)
  religiousViolations  Int @default(0)
  hateSpeechViolations Int @default(0)
  harassmentViolations Int @default(0)
  sexualViolations     Int @default(0)
  spamViolations       Int @default(0)

  // Penalty statistics
  shadowBanCount   Int @default(0)
  outrightBanCount Int @default(0)
  officialBanCount Int @default(0)
  totalPenaltyDays Int @default(0)

  // Trust metrics
  trustLevel String @default("NORMAL") // high, normal, low, untrusted
  accountAge Int    @default(0) // days since creation

  // Content priority tier
  priorityTier  String @default("FREE") // super_admin, admin, premium, free
  priorityScore Float  @default(1.0) // multiplier for content visibility

  // False positive tracking
  falsePositiveCount   Int @default(0)
  accurateReportsCount Int @default(0)

  // Recent activity
  lastViolationAt      DateTime?
  lastPenaltyAt        DateTime?
  consecutiveCleanDays Int       @default(0)

  // Metadata
  metadata String? // JSON: additional reputation data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  User User @relation(fields: [userId], references: [id])

  @@index([overallScore])
  @@index([trustLevel])
  @@index([priorityTier])
  @@index([violationScore])
  @@index([totalViolations])
}

model FalsePositive {
  id                String @id @default(cuid())
  violationReportId String
  userId            String

  // Original detection
  originalViolationType String
  originalContent       String
  originalConfidence    Float
  originalModel         String

  // Correction details
  correctedBy         String // admin user ID
  correctionReason    String
  actualViolationType String? // if it was a different violation

  // Learning data
  trainingData String? // JSON: data for model retraining
  patterns     String? // JSON: patterns to whitelist

  // Impact tracking
  userImpact   String? // how this affected the user
  systemImpact String? // how to improve detection

  // Status
  processedForTraining Boolean   @default(false)
  processedAt          DateTime?

  // Metadata
  metadata String? // JSON: additional learning data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ViolationReport ViolationReport @relation(fields: [violationReportId], references: [id])
  User            User            @relation(fields: [userId], references: [id])

  @@index([originalViolationType])
  @@index([originalModel])
  @@index([processedForTraining])
  @@index([createdAt])
}

model ModerationSettings {
  id String @id @default(cuid())

  // Detection thresholds
  toxicityThreshold         Float @default(0.7)
  religiousContentThreshold Float @default(0.5) // lower threshold for religious content
  hateSpeechThreshold       Float @default(0.8)
  harassmentThreshold       Float @default(0.75)
  sexualContentThreshold    Float @default(0.8)
  spamThreshold             Float @default(0.6)

  // Auto-penalty settings
  autoShadowBanEnabled   Boolean @default(true)
  autoOutrightBanEnabled Boolean @default(false) // requires manual review
  autoOfficialBanEnabled Boolean @default(false) // requires manual review

  // Escalation rules
  level1Threshold Int @default(3) // violations before level 1 penalty
  level2Threshold Int @default(6) // violations before level 2 penalty
  level3Threshold Int @default(10) // violations before level 3 penalty

  // Duration settings (hours)
  shadowBanDuration   Int @default(168) // 7 days
  outrightBanDuration Int @default(720) // 30 days
  officialBanDuration Int @default(-1) // permanent (-1)

  // Monitoring settings
  backgroundMonitoringEnabled Boolean @default(true)
  realTimeAlertsEnabled       Boolean @default(true)
  monitoringInterval          Int     @default(30) // seconds

  // Content priority settings
  superAdminBypass      Boolean @default(true)
  adminLightChecks      Boolean @default(true)
  premiumFastTrack      Boolean @default(true)
  freeUserThoroughCheck Boolean @default(true)

  // False positive handling
  falsePositiveThreshold Float   @default(0.05) // 5%
  retrainingEnabled      Boolean @default(true)
  weeklyModelUpdates     Boolean @default(true)

  // Metadata
  metadata String? // JSON: additional settings

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([updatedAt])
}

model ModerationAlert {
  id String @id @default(cuid())

  // Alert details
  alertType String // high_severity_violation, mass_violations, ban_escalation, false_positive_spike
  severity  String // low, medium, high, critical
  priority  Int    @default(1) // 1-5, 5 being highest

  // Related entities
  userId            String?
  violationReportId String?
  contentType       String? // article, comment, post, message
  contentId         String?

  // Message details
  title          String
  message        String
  actionRequired String? // suggested action for admin

  // Metrics
  affectedUsers  Int? // number of users affected
  violationCount Int? // count of related violations
  timeWindow     Int? // time window in minutes

  // Status tracking
  status          String    @default("UNREAD") // unread, read, acknowledged, resolved
  acknowledgedAt  DateTime?
  acknowledgedBy  String? // super admin user ID
  resolvedAt      DateTime?
  resolvedBy      String? // super admin user ID
  resolutionNotes String?

  // Delivery tracking
  deliveredViaWebSocket Boolean @default(false)
  deliveredViaEmail     Boolean @default(false)
  deliveredViaPush      Boolean @default(false)

  // Metadata
  metadata String? // JSON: additional alert data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([alertType, status])
  @@index([severity, status])
  @@index([priority, createdAt])
  @@index([status, createdAt])
  @@index([userId])
  @@index([violationReportId])
}

model ModerationQueue {
  id String @id @default(cuid())

  // Content to moderate
  contentType String // article, comment, post, message
  contentId   String
  content     String

  // Author details
  authorId   String
  authorRole String // from UserRole enum

  // Moderation details
  status         String   @default("PENDING") // pending, in_review, approved, rejected
  priority       Int      @default(1) // 1-5, 5 being highest
  flagReason     String? // reason for flagging
  assignedTo     String? // moderator user ID
  assignedAt     DateTime?
  reviewedBy     String? // moderator user ID
  reviewedAt     DateTime?
  reviewNotes    String?
  autoFlagged    Boolean  @default(false)
  aiConfidence   Float? // 0-1, confidence score from AI

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status, priority, createdAt])
  @@index([authorId])
  @@index([assignedTo])
  @@index([contentType, contentId])
}

model AdminAction {
  id String @id @default(cuid())

  // Action details
  actionType String // ban_user, unban_user, delete_content, restore_content, update_penalty, etc.
  targetType String // user, content, penalty, violation
  targetId   String

  // Admin details
  adminId      String
  adminRole    String
  adminComment String?

  // Action metadata
  previousState String? // JSON: state before action
  newState      String? // JSON: state after action
  reason        String?
  
  // Timestamps
  createdAt DateTime @default(now())

  Admin User @relation(fields: [adminId], references: [id], name: "AdminActionsPerformed")

  @@index([adminId, createdAt])
  @@index([actionType, createdAt])
  @@index([targetType, targetId])
}

// ================================
// AI AUDIT & COMPLIANCE LOGGING
// ================================

model AIOperationLog {
  id String @id

  // Operation details
  operationType     String // content_generation, translation, moderation, image_generation, etc.
  operationCategory String // content, market_analysis, moderation, recommendation, etc.
  agentType         String // content_agent, translation_agent, moderation_agent, etc.
  agentId           String? // Reference to specific AI agent if applicable

  // Request details
  userId     String? // User who initiated the operation (null for system operations)
  requestId  String // Unique request identifier for tracing
  endpoint   String? // API endpoint called
  httpMethod String? // GET, POST, PUT, DELETE

  // Input data
  inputData   String // JSON: The input provided to the AI
  inputHash   String // SHA-256 hash for deduplication
  inputTokens Int? // Number of input tokens (for cost tracking)

  // Output data
  outputData   String? // JSON: The output generated by the AI
  outputHash   String? // SHA-256 hash of output
  outputTokens Int? // Number of output tokens

  // AI decision details
  modelProvider String // openai, google, meta, x_ai, etc.
  modelName     String // gpt-4-turbo, gemini-pro, etc.
  modelVersion  String? // Model version for reproducibility
  reasoning     String? // AI's reasoning/explanation for decision
  confidence    Float? // Confidence score (0-1)
  alternatives  String? // JSON: Alternative outputs considered

  // Quality metrics
  qualityScore Float? // Overall quality score (0-1)
  thresholds   String? // JSON: Quality thresholds applied
  passed       Boolean? // Whether quality checks passed

  // Data sources & citations
  dataSources  String? // JSON: Sources used by AI
  citations    String? // JSON: Citations and references
  externalAPIs String? // JSON: External APIs called

  // Human oversight
  humanReviewed  Boolean   @default(false)
  reviewedBy     String? // User ID of human reviewer
  reviewedAt     DateTime?
  humanDecision  String? // approved, rejected, modified
  overrideReason String? // Justification for human override
  feedbackToAI   String? // Feedback sent back to AI for learning

  // Cost tracking
  estimatedCost Float? // Estimated API cost
  actualCost    Float? // Actual cost incurred
  currency      String @default("USD")

  // Performance metrics
  processingTimeMs Int? // Time taken to process
  cacheHit         Boolean @default(false)
  retryCount       Int     @default(0)

  // Error handling
  status       String // success, failed, partial, timeout
  errorMessage String? // Error details if failed
  errorCode    String? // Error code for categorization

  // Compliance & retention
  gdprCompliant     Boolean   @default(true)
  retentionCategory String // standard_2year, extended_5year, permanent
  archivedAt        DateTime? // When log was archived to cold storage
  deletionScheduled DateTime? // Scheduled deletion date (2 years default)

  // Metadata
  metadata String? // JSON: Additional context
  tags     String? // JSON: Tags for categorization

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  User          User?        @relation(fields: [userId], references: [id])
  AIDecisionLog AIDecision[]

  @@index([operationType, createdAt])
  @@index([operationCategory, createdAt])
  @@index([agentType, createdAt])
  @@index([userId, createdAt])
  @@index([status, createdAt])
  @@index([humanReviewed, createdAt])
  @@index([deletionScheduled])
  @@index([requestId])
  @@index([inputHash])
  @@index([createdAt])
  @@map("ai_audit_log")
}

model AIDecision {
  id String @id

  // Link to audit log
  auditLogId String
  AIAuditLog AIOperationLog @relation(fields: [auditLogId], references: [id], onDelete: Cascade)

  // Decision details
  decisionPoint   String // what decision was made
  decisionType    String // classification, generation, ranking, filtering, etc.
  decisionOutcome String // final decision made

  // Reasoning & explanation
  primaryReason       String // Main reason for decision
  contributingFactors String? // JSON: Other factors considered
  confidenceScore     Float // Confidence in decision (0-1)
  alternativeOptions  String? // JSON: Other options considered

  // Data used for decision
  dataPoints String? // JSON: Specific data points used
  weights    String? // JSON: Weights applied to factors
  thresholds String? // JSON: Thresholds applied

  // Rule & policy compliance
  rulesApplied     String? // JSON: Rules that influenced decision
  policiesFollowed String? // JSON: Policies adhered to
  exceptions       String? // JSON: Any exceptions made

  // Impact assessment
  expectedImpact String? // Expected outcome
  riskLevel      String? // low, medium, high, critical
  biasCheck      String? // JSON: Bias detection results

  // Explainability
  humanExplanation String? // Human-readable explanation
  technicalDetails String? // Technical details for developers
  visualData       String? // JSON: Data for visualization

  // User consent & rights
  requiresConsent    Boolean  @default(false)
  consentObtained    Boolean?
  userNotified       Boolean  @default(false)
  rightToExplanation Boolean  @default(true)

  // Timestamps
  createdAt DateTime @default(now())

  @@index([auditLogId])
  @@index([decisionType, createdAt])
  @@index([requiresConsent])
  @@map("ai_decision_log")
}

model ComplianceReport {
  id String @id

  // Report details
  reportType  String // gdpr_export, audit_summary, cost_analysis, quality_review
  title       String
  description String?

  // Time period
  startDate DateTime
  endDate   DateTime

  // Report scope
  userId         String? // Specific user (for GDPR requests)
  agentTypes     String? // JSON: Agent types included
  operationTypes String? // JSON: Operation types included

  // Statistics
  totalOperations Int
  successfulOps   Int
  failedOps       Int
  humanOverrides  Int
  averageQuality  Float?
  totalCost       Float?

  // Compliance metrics
  gdprCompliant Int // Count of GDPR-compliant operations
  dataRetention String // JSON: Retention statistics
  consentStatus String? // JSON: Consent statistics

  // Generated data
  reportData      String // JSON: Full report data
  summary         String? // Executive summary
  recommendations String? // JSON: Recommendations

  // Export details
  format        String  @default("JSON") // JSON, PDF, CSV, XML
  fileUrl       String? // URL to exported file (if stored)
  fileSize      Int? // File size in bytes
  downloadCount Int     @default(0)

  // Access control
  requestedBy String // User ID who requested report
  accessLevel String // public, internal, confidential, restricted
  expiresAt   DateTime? // When report access expires

  // Status
  status       String // generating, completed, failed, expired
  generatedAt  DateTime?
  errorMessage String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  User User @relation(fields: [requestedBy], references: [id])

  @@index([reportType, createdAt])
  @@index([userId, createdAt])
  @@index([requestedBy, createdAt])
  @@index([status, createdAt])
  @@index([expiresAt])
}

model UserConsent {
  id String @id

  // User details
  userId String
  User   User   @relation(fields: [userId], references: [id])

  // Consent details
  consentType String // ai_content_generation, ai_personalization, ai_moderation, data_processing
  purpose     String // What the consent is for
  scope       String // JSON: Specific scopes of consent

  // Consent status
  consented      Boolean
  consentMethod  String? // explicit_opt_in, implicit, terms_acceptance
  consentVersion String // Version of terms consented to

  // Legal basis (GDPR)
  legalBasis String // consent, legitimate_interest, contract, legal_obligation

  // User rights
  rightToWithdraw    Boolean @default(true)
  rightToExplanation Boolean @default(true)
  rightToPortability Boolean @default(true)
  rightToErasure     Boolean @default(true)

  // Withdrawal tracking
  withdrawnAt      DateTime?
  withdrawalReason String?
  dataDeleted      Boolean   @default(false)
  deletedAt        DateTime?

  // Metadata
  ipAddress String? // IP when consent was given
  userAgent String? // Browser/device info
  metadata  String? // JSON: Additional context

  // Timestamps
  givenAt   DateTime  @default(now())
  expiresAt DateTime? // When consent expires (if applicable)
  updatedAt DateTime  @updatedAt

  @@index([userId, consentType])
  @@index([userId, consented])
  @@index([consentType, consented])
  @@index([expiresAt])
}

// ===================================
// AI COST CONTROL & BUDGET MANAGEMENT
// Task 10.3 - AI Cost Tracking System
// ===================================

model AICostTracking {
  id String @id

  // Operation details
  operationType String // api_call, agent_task, workflow, batch_processing
  agentId       String? // Related AI agent
  agentType     String? // content_generation, translation, moderation, etc.
  taskId        String? // Related AI task
  workflowId    String? // Related workflow

  // API call details
  provider    String // openai, anthropic, google, meta, xai
  model       String // gpt-4-turbo, claude-3, gemini-pro, etc.
  apiEndpoint String? // Specific API endpoint called

  // Token/usage tracking
  inputTokens  Int? // Tokens in request
  outputTokens Int? // Tokens in response
  totalTokens  Int? // Total tokens used

  // Cost calculation
  inputCostPer1k  Float // Cost per 1k input tokens
  outputCostPer1k Float // Cost per 1k output tokens
  totalCost       Float // Total cost for this operation
  currency        String @default("USD")

  // Performance metrics
  responseTimeMs Int? // Response time in milliseconds
  retryCount     Int     @default(0)
  failed         Boolean @default(false)
  errorCode      String? // Error code if failed

  // User/context
  userId         String? // User who triggered operation
  organizationId String? // Organization if applicable
  ipAddress      String? // IP address for tracking

  // Metadata
  requestMetadata  String? // JSON: Additional request details
  responseMetadata String? // JSON: Additional response details
  tags             String? // JSON: Custom tags for categorization

  // Timestamps
  timestamp     DateTime @default(now())
  billingPeriod String // YYYY-MM format for billing aggregation

  @@index([agentId, timestamp])
  @@index([agentType, timestamp])
  @@index([provider, timestamp])
  @@index([userId, timestamp])
  @@index([billingPeriod, agentType])
  @@index([billingPeriod, provider])
  @@index([operationType, timestamp])
  @@index([timestamp])
}

model BudgetLimit {
  id String @id

  // Budget scope
  scope   String // global, agent_type, user, organization
  scopeId String? // ID of agent_type/user/organization

  // Budget amounts (in USD)
  dailyLimit   Float? // Daily budget limit
  weeklyLimit  Float? // Weekly budget limit
  monthlyLimit Float? // Monthly budget limit

  // Current spending
  dailySpent   Float @default(0)
  weeklySpent  Float @default(0)
  monthlySpent Float @default(0)

  // Reset tracking
  lastDailyReset   DateTime @default(now())
  lastWeeklyReset  DateTime @default(now())
  lastMonthlyReset DateTime @default(now())

  // Throttling settings
  throttleEnabled Boolean   @default(true)
  throttleAt      Float     @default(100) // Percentage (80, 90, 100)
  isThrottled     Boolean   @default(false)
  throttledAt     DateTime?

  // Alert settings
  alertEnabled    Boolean   @default(true)
  alertThresholds String // JSON: [80, 90, 100] percentages
  lastAlertSent   DateTime?
  lastAlertLevel  Int? // Last threshold that triggered alert

  // Status
  isActive Boolean @default(true)

  // Metadata
  description String?
  createdBy   String? // User ID who created budget
  notes       String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  alerts BudgetAlert[]

  @@index([scope, scopeId])
  @@index([isActive, scope])
  @@index([isThrottled])
}

model BudgetAlert {
  id String @id

  // Budget reference
  budgetLimitId String
  BudgetLimit   BudgetLimit @relation(fields: [budgetLimitId], references: [id])

  // Alert details
  alertType String // threshold_warning, budget_exceeded, throttling_activated
  severity  String // info, warning, critical
  period    String // daily, weekly, monthly

  // Threshold info
  thresholdPercent Float // Percentage that triggered alert (80, 90, 100)
  currentSpent     Float // Amount spent when alert triggered
  budgetLimit      Float // Budget limit for the period

  // Budget scope (denormalized for quick queries)
  scope   String // global, agent_type, user, organization
  scopeId String? // ID of agent_type/user/organization

  // Alert message
  message        String // Human-readable alert message
  recommendation String? // Cost optimization recommendation

  // Notification tracking
  notificationSent Boolean   @default(false)
  sentAt           DateTime?
  recipients       String? // JSON: List of user IDs/emails notified

  // Resolution
  acknowledged   Boolean   @default(false)
  acknowledgedBy String? // User ID who acknowledged
  acknowledgedAt DateTime?
  resolvedAt     DateTime?

  // Metadata
  metadata String? // JSON: Additional context

  // Timestamps
  createdAt DateTime @default(now())

  @@index([budgetLimitId, createdAt])
  @@index([alertType, createdAt])
  @@index([severity, acknowledged])
  @@index([notificationSent])
  @@index([createdAt])
}

model CostReport {
  id String @id

  // Report period
  reportType    String // daily, weekly, monthly, quarterly, custom
  startDate     DateTime
  endDate       DateTime
  billingPeriod String? // YYYY-MM format

  // Report scope
  scope   String // global, agent_type, provider, user, organization
  scopeId String? // ID if scoped to specific entity

  // Cost summary
  totalCost        Float
  totalOperations  Int
  averageCostPerOp Float

  // Breakdown by agent type
  contentGenCost     Float @default(0)
  translationCost    Float @default(0)
  moderationCost     Float @default(0)
  marketAnalysisCost Float @default(0)
  imageGenCost       Float @default(0)
  otherCost          Float @default(0)

  // Breakdown by provider
  openaiCost    Float @default(0)
  anthropicCost Float @default(0)
  googleCost    Float @default(0)
  metaCost      Float @default(0)
  xaiCost       Float @default(0)

  // Usage metrics
  totalTokens       Int @default(0)
  totalInputTokens  Int @default(0)
  totalOutputTokens Int @default(0)

  // Performance metrics
  avgResponseTime Float? // Average response time in ms
  successRate     Float? // Percentage of successful operations
  retryRate       Float? // Percentage of operations that needed retry

  // Comparisons
  previousPeriodCost Float? // Cost from previous period
  costChange         Float? // Percentage change from previous period
  costChangeAmount   Float? // Absolute change in cost

  // Trends and forecasts
  trendDirection     String? // increasing, decreasing, stable
  forecastNextPeriod Float? // Predicted cost for next period
  forecastConfidence Float? // Confidence in forecast (0-100)

  // Recommendations
  recommendations    String? // JSON: Cost optimization recommendations
  highCostOperations String? // JSON: List of expensive operations

  // Budget comparison
  budgetLimit       Float? // Budget limit for period
  budgetUtilization Float? // Percentage of budget used
  budgetRemaining   Float? // Remaining budget

  // Report data
  detailedData String // JSON: Detailed breakdown
  chartData    String? // JSON: Data for visualizations

  // Generation details
  generatedBy    String? // User ID or 'system' for automated
  generationType String // manual, scheduled, automatic

  // Export details
  format   String  @default("JSON") // JSON, PDF, CSV, Excel
  fileUrl  String? // URL to exported file
  fileSize Int? // File size in bytes

  // Status
  status       String // generating, completed, failed
  errorMessage String?

  // Timestamps
  generatedAt DateTime?
  createdAt   DateTime  @default(now())

  @@index([reportType, startDate])
  @@index([billingPeriod, scope])
  @@index([scope, scopeId])
  @@index([createdAt])
  @@index([status])
}

// ============================================================================
// DELEGATION & RBAC SYSTEM MODELS
// ============================================================================

// Delegated Permission Model - Tracks granular permission delegation
model DelegatedPermission {
  id String @id @default(cuid())

  // Permission assignment
  delegatedToUserId String // Admin who receives the permission
  delegatedByUserId String // Super Admin who granted it
  permissionKey     String // Permission constant (e.g., USER_CREATE)

  // Scope and constraints
  scope       String  @default("ALL") // ALL, SPECIFIC, LIMITED
  scopeData   String? // JSON: Additional scope restrictions
  constraints String? // JSON: Limits (e.g., max users to create)

  // Metadata
  reason String? // Why this permission was delegated
  notes  String? // Additional notes

  // Status and expiry
  isActive     Boolean   @default(true)
  expiresAt    DateTime? // Optional expiration
  revokedAt    DateTime?
  revokedBy    String? // User ID who revoked it
  revokeReason String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  delegatedTo User @relation("DelegatedPermissionsReceived", fields: [delegatedToUserId], references: [id], onDelete: Cascade)
  delegatedBy User @relation("DelegatedPermissionsGranted", fields: [delegatedByUserId], references: [id], onDelete: Cascade)

  @@unique([delegatedToUserId, permissionKey])
  @@index([delegatedToUserId, isActive])
  @@index([permissionKey])
  @@index([delegatedByUserId])
  @@index([isActive, expiresAt])
}

// Permission Usage Log - Tracks when permissions are used
model PermissionUsageLog {
  id            String   @id @default(cuid())
  userId        String // User who performed the action
  permissionKey String // Permission used
  actionType    String // CREATE, UPDATE, DELETE, VIEW
  resourceType  String // USER, ARTICLE, WALLET, etc.
  resourceId    String? // ID of affected resource
  success       Boolean // Whether action succeeded
  errorMessage  String? // Error if action failed
  metadata      String? // JSON: Additional context
  ipAddress     String
  userAgent     String
  timestamp     DateTime @default(now())

  @@index([userId, timestamp])
  @@index([permissionKey, timestamp])
  @@index([resourceType, resourceId])
  @@index([success])
}

// ============================================================================
// FINANCE & WALLET SYSTEM MODELS
// ============================================================================

// Wallet Model - User and platform wallets
model Wallet {
  id String @id @default(cuid())

  // Wallet identification
  walletType    WalletType // USER_WALLET, WE_WALLET, ESCROW_WALLET, etc.
  userId        String? // Null for platform wallets (WE_WALLET)
  walletAddress String     @unique // Unique wallet identifier

  // Balance tracking
  availableBalance Float @default(0.0)
  lockedBalance    Float @default(0.0)
  stakedBalance    Float @default(0.0)
  totalBalance     Float @default(0.0) // Sum of all balances

  // Multi-currency support
  currency  String @default("PLATFORM_TOKEN")
  cePoints  Float  @default(0.0) // CE Points balance
  joyTokens Float  @default(0.0) // JOY Tokens balance

  // Wallet limits and settings
  dailyWithdrawalLimit Float?
  transactionLimit     Float?
  whitelistedAddresses String? // JSON: Array of whitelisted addresses

  // Security settings
  twoFactorRequired Boolean   @default(false)
  otpRequired       Boolean   @default(true)
  isLocked          Boolean   @default(false)
  lockReason        String?
  lockedAt          DateTime?
  lockedBy          String? // Admin ID who locked it

  // Status
  status WalletStatus @default(ACTIVE)

  // Timestamps
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  lastTransactionAt DateTime?

  // Relations
  user             User?               @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactionsFrom WalletTransaction[] @relation("TransactionsFrom")
  transactionsTo   WalletTransaction[] @relation("TransactionsTo")
  whitelists       WalletWhitelist[] // Whitelisted addresses
  fraudAlerts      FraudAlert[] // Fraud detection alerts
  withdrawalRequests WithdrawalRequest[] // Withdrawal requests
  whitelistChanges WhitelistChange[] // Whitelist change history

  @@index([userId])
  @@index([walletType])
  @@index([status])
  @@index([walletAddress])
}

// Wallet Transaction Model - All financial transactions
model WalletTransaction {
  id String @id @default(cuid())

  // Transaction identification
  transactionHash String          @unique
  transactionType TransactionType // DEPOSIT, WITHDRAWAL, TRANSFER, etc.
  operationType   String // Specific operation (e.g., DEPOSIT_MOBILE_MONEY)

  // Wallet references
  fromWalletId String? // Source wallet (null for deposits)
  toWalletId   String? // Destination wallet (null for withdrawals)

  // Amount details
  amount    Float
  currency  String @default("PLATFORM_TOKEN")
  fee       Float  @default(0.0)
  netAmount Float // Amount after fees

  // Exchange rate (if currency conversion)
  exchangeRate     Float?
  originalCurrency String?
  originalAmount   Float?

  // Transaction purpose and metadata
  purpose     String // SUBSCRIPTION, PURCHASE, REWARD, etc.
  description String?
  metadata    String? // JSON: Additional data
  referenceId String? // External reference (payment gateway ID)

  // Status and verification
  status               TransactionStatus @default(PENDING)
  verificationRequired Boolean           @default(false)
  otpVerified          Boolean           @default(false)
  otpCode              String?
  otpExpiresAt         DateTime?

  // Approval workflow
  requiresApproval Boolean   @default(false)
  approvedBy       String? // Admin ID
  approvedAt       DateTime?
  rejectedBy       String?
  rejectedAt       DateTime?
  rejectionReason  String?

  // External transaction details
  blockchainTxHash        String? // Blockchain transaction hash
  blockchainConfirmations Int? // Number of confirmations
  paymentMethod           PaymentMethod? // Payment method used
  paymentGateway          String? // STRIPE, PAYPAL, MPESA, etc.
  paymentGatewayTxId      String? // Gateway transaction ID
  externalReference       String? // External reference ID

  // Error handling
  errorCode    String?
  errorMessage String?
  retryCount   Int     @default(0)
  maxRetries   Int     @default(3)

  // Risk and fraud
  riskScore        Float? // 0-100, fraud detection score
  flaggedForReview Boolean   @default(false)
  reviewedBy       String?
  reviewedAt       DateTime?
  reviewNotes      String?

  // Timestamps
  initiatedAt DateTime  @default(now())
  processedAt DateTime?
  completedAt DateTime?
  failedAt    DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  fromWallet Wallet? @relation("TransactionsFrom", fields: [fromWalletId], references: [id])
  toWallet   Wallet? @relation("TransactionsTo", fields: [toWalletId], references: [id])
  withdrawalRequest WithdrawalRequest? // Link to withdrawal request if applicable

  @@index([transactionHash])
  @@index([fromWalletId, status])
  @@index([toWalletId, status])
  @@index([status, createdAt])
  @@index([transactionType, createdAt])
  @@index([operationType])
  @@index([referenceId])
  @@index([paymentGatewayTxId])
  @@index([blockchainTxHash])
}

// Finance Operation Log - Detailed logging of all finance operations
model FinanceOperationLog {
  id String @id @default(cuid())

  // Operation details
  operationType     String // Specific operation from financeOperations.ts
  operationCategory String // DEPOSITS, WITHDRAWALS, TRANSFERS, etc.
  transactionId     String? // Related transaction ID

  // User and actor
  userId      String? // User affected
  performedBy String // User who performed operation

  // Operation data
  inputData  String // JSON: Input parameters
  outputData String? // JSON: Operation result

  // Status
  status       String // SUCCESS, FAILED, PENDING
  errorCode    String?
  errorMessage String?

  // Performance
  executionTimeMs Int? // Execution time in milliseconds

  // Audit trail
  ipAddress String
  userAgent String
  timestamp DateTime @default(now())

  @@index([operationType, timestamp])
  @@index([userId, timestamp])
  @@index([performedBy, timestamp])
  @@index([status])
  @@index([transactionId])
}

// Staking Record - Track staked tokens
model StakingRecord {
  id String @id @default(cuid())

  // Staking details
  walletId String
  userId   String

  // Amount and duration
  stakedAmount   Float
  lockPeriodDays Int // 30, 60, 90, 180, 365
  rewardRate     Float // APY percentage

  // Rewards
  accumulatedRewards  Float     @default(0.0)
  lastRewardClaimAt   DateTime?
  totalRewardsClaimed Float     @default(0.0)

  // Status
  status StakingStatus @default(ACTIVE)

  // Timestamps
  stakedAt   DateTime  @default(now())
  unlockAt   DateTime // When staking can be unlocked
  unlockedAt DateTime?

  // Early unlock penalty
  earlyUnlockPenalty Float? // Penalty percentage if unlocked early

  @@index([walletId, status])
  @@index([userId, status])
  @@index([unlockAt])
  @@index([status])
}

// Conversion Record - Track token conversions
model ConversionRecord {
  id String @id @default(cuid())

  // User and wallet
  userId   String
  walletId String

  // Conversion details
  fromCurrency   String // CE_POINTS, JOY_TOKENS, PLATFORM_TOKEN
  toCurrency     String
  fromAmount     Float
  toAmount       Float
  conversionRate Float

  // Fee
  conversionFee Float @default(0.0)
  netAmount     Float

  // Status
  status String @default("COMPLETED") // COMPLETED, FAILED

  // Timestamps
  convertedAt DateTime @default(now())

  @@index([userId, convertedAt])
  @@index([walletId])
  @@index([fromCurrency, toCurrency])
}

// Airdrop Campaign - Manage airdrop distributions
model AirdropCampaign {
  id String @id @default(cuid())

  // Campaign details
  campaignName String
  name         String
  description  String?

  // Airdrop allocation
  totalAmount       Float
  totalSupply       Float
  distributedAmount Float  @default(0.0)
  remainingAmount   Float
  currency          String @default("PLATFORM_TOKEN")

  // Eligibility
  eligibilityCriteria Json // Criteria for eligibility

  // Distribution settings
  amountPerUser    Float? // Fixed amount per user
  distributionDate DateTime
  distributedAt    DateTime?
  vestingSchedule  String? // JSON: Vesting schedule

  // Claim settings
  claimStartDate DateTime
  claimEndDate   DateTime
  isClaimable    Boolean  @default(true)

  // Status
  status AirdropStatus @default(PENDING)

  // Creator
  createdByUserId String // Admin ID
  createdBy       String // Admin ID

  // Metadata
  metadata Json? // Additional campaign data

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  claims AirdropClaim[]

  @@index([status])
  @@index([claimStartDate, claimEndDate])
  @@index([distributionDate])
}

// Airdrop Claim - Individual airdrop claims
model AirdropClaim {
  id String @id @default(cuid())

  // Campaign and user
  campaignId String
  userId     String
  walletId   String

  // Claim details
  amount         Float
  claimAmount    Float
  vestedAmount   Float   @default(0.0)
  releasedAmount Float   @default(0.0)
  transactionId  String? // Reference to WalletTransaction

  // Status
  status String @default("PENDING") // PENDING, CLAIMED, VESTED

  // Timestamps
  eligibleAt DateTime  @default(now())
  claimedAt  DateTime?

  // Relations
  campaign AirdropCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, userId])
  @@index([userId, status])
  @@index([campaignId, status])
}

// Escrow Transaction - Manage escrow transactions
model EscrowTransaction {
  id String @id @default(cuid())

  // Parties involved
  buyerId        String
  sellerId       String
  escrowWalletId String?

  // Amount
  amount       Float
  escrowAmount Float
  currency     String @default("PLATFORM_TOKEN")
  escrowFee    Float  @default(0.0)

  // Description and conditions
  description       String
  releaseConditions String // Release conditions
  conditions        String // JSON: Escrow release conditions

  // Dispute
  disputeRaised     Boolean   @default(false)
  disputeRaisedBy   String?
  disputeRaisedAt   DateTime?
  disputeReason     String?
  disputeEvidence   String? // JSON: Evidence submitted
  mediatorId        String?
  disputeResolution String?
  disputeResolvedAt DateTime?

  // Status
  status EscrowStatus @default(PENDING)

  // Metadata
  metadata Json?

  // Timestamps
  createdAt  DateTime  @default(now())
  releasedAt DateTime?
  resolvedAt DateTime?

  @@index([buyerId])
  @@index([sellerId])
  @@index([status])
}

// Subscription Payment Record - Detailed subscription transactions
model SubscriptionPaymentRecord {
  id String @id @default(cuid())

  // Subscription details
  userId         String
  subscriptionId String

  // Payment details
  amount         Float
  currency       String  @default("USD")
  paymentMethod  String // CARD, MOBILE_MONEY, WALLET
  paymentGateway String? // STRIPE, PAYPAL, MPESA

  // Transaction reference
  transactionId String? // WalletTransaction ID
  gatewayTxId   String? // External gateway transaction ID

  // Invoice
  invoiceNumber String  @unique
  invoiceUrl    String?

  // Status
  status String @default("COMPLETED") // COMPLETED, FAILED, REFUNDED

  // Proration
  proratedAmount Float?
  proratedDays   Int?

  // Timestamps
  paymentDate     DateTime  @default(now())
  paidAt          DateTime  @default(now())
  nextBillingDate DateTime?

  @@index([userId, paidAt])
  @@index([subscriptionId])
  @@index([status])
  @@index([invoiceNumber])
}

// Refund Record - Track all refunds
model RefundRecord {
  id String @id @default(cuid())

  // Original transaction
  originalTransactionId String // Original WalletTransaction ID
  originalTxId          String // Original WalletTransaction ID (alias)
  refundTransactionId   String? // Refund WalletTransaction ID

  // Refund details
  userId       String
  walletId     String
  refundAmount Float
  refundReason String
  refundType   String // FULL, PARTIAL, SUBSCRIPTION

  // Reason and approval
  reason         String
  reasonCategory String? // CUSTOMER_REQUEST, ERROR, DISPUTE, etc.
  requestedBy    String // User or admin ID
  approvedBy     String? // Admin ID

  // Refund method
  refundMethod    String // ORIGINAL_METHOD, WALLET, BANK
  refundReference String? // External refund reference

  // Status
  status String @default("PENDING") // PENDING, APPROVED, COMPLETED, REJECTED

  // Processing
  processedAt      DateTime?
  processingTimeMs Int?

  // Metadata
  metadata Json?

  // Timestamps
  requestedAt DateTime  @default(now())
  approvedAt  DateTime?
  completedAt DateTime?
  rejectedAt  DateTime?

  @@index([userId, status])
  @@index([originalTxId])
  @@index([status])
}

// ============================================================================
// ENUMS FOR FINANCE SYSTEM
// ============================================================================

enum WalletType {
  USER_WALLET // Regular user wallet
  ADMIN_WALLET // Admin wallet (same structure as user)
  SUPER_ADMIN_WALLET // Super admin wallet
  WE_WALLET // Platform central wallet (revenue receiver)
  ESCROW_WALLET // Escrow for transactions
  BONUS_WALLET // For promotional bonuses
  AIRDROP_WALLET // For airdrop distributions
  STAKING_VAULT // Staking locked funds
  REFUND_POOL // Refund reserve pool
}

enum WalletStatus {
  ACTIVE // Wallet is active
  LOCKED // Temporarily locked
  SUSPENDED // Suspended (requires investigation)
  FROZEN // Frozen (security issue)
  CLOSED // Permanently closed
}

enum TransactionType {
  DEPOSIT // Deposit to wallet
  WITHDRAWAL // Withdrawal from wallet
  TRANSFER // Transfer between wallets
  PAYMENT // Payment for services/products
  REFUND // Refund transaction
  REWARD // Reward/bonus
  FEE // Transaction fee
  COMMISSION // Commission payment
  STAKE // Staking transaction
  UNSTAKE // Unstaking transaction
  CONVERSION // Currency conversion
  AIRDROP // Airdrop distribution
  ESCROW // Escrow transaction
  GIFT // Gift to another user
  DONATION // Donation
}

enum TransactionStatus {
  PENDING // Transaction initiated
  PROCESSING // Being processed
  COMPLETED // Successfully completed
  FAILED // Transaction failed
  CANCELLED // Cancelled by user/admin
  REFUNDED // Transaction refunded
  EXPIRED // Transaction expired (time limit)
  REQUIRES_APPROVAL // Waiting for admin approval
  REJECTED // Rejected by admin
}

enum StakingStatus {
  ACTIVE // Currently staked
  UNLOCKING // In cooldown period
  UNLOCKED // Unlocked and returned
  COMPLETED // Completed successfully
  CANCELLED // Cancelled (with penalty)
}

enum EscrowStatus {
  PENDING // Escrow created, awaiting conditions
  LOCKED // Funds locked in escrow
  RELEASED // Released to seller
  DISPUTED // Dispute raised
  RESOLVED // Dispute resolved
  REFUNDED // Refunded to buyer
  EXPIRED // Escrow expired
}

enum PaymentMethod {
  CRYPTO // Cryptocurrency payment
  CARD // Credit/debit card
  BANK_TRANSFER // Bank wire transfer
  MOBILE_MONEY // M-Pesa, Orange Money, etc.
  WALLET // Platform wallet
}

enum AirdropStatus {
  PENDING // Airdrop created, not distributed
  ACTIVE // Airdrop active, can be claimed
  COMPLETED // Airdrop fully distributed
  CANCELLED // Airdrop cancelled
  EXPIRED // Airdrop expired
}

// ============================================================================
// PLATFORM SETTINGS (JOY TOKEN CONFIGURATION)
// ============================================================================

model PlatformSettings {
  id String @id @default(cuid())

  // JOY Token (JY) Exchange Rate Configuration
  joyTokenUsdRate Float  @default(1.0) // Current value of 1 JY in USD
  joyTokenSymbol  String @default("JY") // Token symbol
  joyTokenName    String @default("JOY Token") // Full token name

  // Rate Management
  lastRateUpdate   DateTime @default(now()) // Last time rate was updated
  rateUpdatedBy    String? // Super admin who updated the rate
  rateUpdateReason String? // Reason for rate change
  previousRate     Float? // Previous rate for tracking

  // CE Points Conversion Configuration
  cePointsToJyRate Int     @default(100) // How many CE Points = 1 JY
  cePointsEnabled  Boolean @default(true)

  // Currency Settings
  defaultCurrency     String @default("JY") // Platform default currency
  supportedCurrencies String @default("JY,USD,EUR,KES,NGN,GHS,ZAR") // Comma-separated

  // Platform Configuration
  platformName    String  @default("CoinDaily")
  platformUrl     String?
  maintenanceMode Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ensure only one settings record exists
  @@unique([id])
  @@index([lastRateUpdate])
}

model CurrencyRateHistory {
  id String @id @default(cuid())

  // Rate Information
  currency         String // Currency code (JY, USD, etc.)
  usdRate          Float // Value in USD
  previousRate     Float? // Previous rate
  changePercentage Float? // Percentage change

  // Change Tracking
  updatedBy    String // Super admin user ID
  updateReason String? // Reason for update
  notes        String? // Additional notes

  // Market Data (if applicable)
  marketCap Float? // Market capitalization
  volume24h Float? // 24-hour trading volume

  // Timestamps
  effectiveFrom DateTime  @default(now())
  effectiveTo   DateTime? // When this rate expires/is replaced
  createdAt     DateTime  @default(now())

  @@index([currency, effectiveFrom])
  @@index([createdAt])
}

// ============================================================================
// OTP SYSTEM
// ============================================================================

model OTP {
  id String @id @default(cuid())

  // User identification
  userId String

  // OTP details
  code    String // Encrypted OTP code
  purpose String // WITHDRAWAL, PAYMENT, TRANSFER, etc.

  // Validation
  expiresAt   DateTime
  attempts    Int       @default(0)
  maxAttempts Int       @default(3)
  verified    Boolean   @default(false)
  verifiedAt  DateTime?
  isValid     Boolean   @default(true)

  // Metadata
  metadata String? // JSON

  // Timestamps
  createdAt DateTime @default(now())

  @@index([userId, purpose, verified])
  @@index([expiresAt])
  @@index([createdAt])
}

// ============================================================================
// WE WALLET AUTHENTICATION
// ============================================================================

model WeWalletAuthSession {
  id        String @id @default(cuid())
  sessionId String @unique

  // Operation details
  operationType  String // TRANSFER_OUT, TRANSFER_IN, VIEW_BALANCE, etc.
  initiatedBy    String // Super Admin user ID
  amount         Float?
  targetWalletId String?
  reason         String?
  metadata       String? // JSON

  // OTP tracking
  otpIds         String // JSON array of OTP IDs
  verifiedEmails String // JSON array of verified emails

  // Status
  status          String // PENDING, PARTIAL, APPROVED, REJECTED, EXPIRED
  rejectionReason String?

  // Timestamps
  initiatedAt DateTime  @default(now())
  expiresAt   DateTime
  completedAt DateTime?

  @@index([sessionId])
  @@index([initiatedBy, status])
  @@index([status, expiresAt])
}

// ============================================================================
// WALLET WHITELIST
// ============================================================================

model WalletWhitelist {
  id String @id @default(cuid())

  // Wallet reference
  walletId String

  // Address details
  address     String // External wallet/bank/mobile address
  addressType String // WALLET, BANK_ACCOUNT, MOBILE_MONEY
  label       String? // User-friendly label

  // Verification
  verificationMethod String // EMAIL, SMS, DOCUMENT
  isVerified         Boolean   @default(false)
  verifiedAt         DateTime?

  // Status
  isActive    Boolean   @default(true)
  activatesAt DateTime? // 24-hour waiting period
  deletedAt   DateTime?

  // Metadata
  metadata String? // JSON

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  wallet Wallet @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@unique([walletId, address, addressType])
  @@index([walletId, isActive])
  @@index([address, addressType])
  @@index([isVerified])
}

// ============================================================================
// SECURITY & AUDIT LOGGING
// ============================================================================

model SecurityLog {
  id String @id @default(cuid())

  // User identification
  userId String

  // Action details
  action    String // Action performed
  ipAddress String
  userAgent String

  // Additional data
  metadata Json?

  // Timestamp
  timestamp DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, timestamp])
  @@index([action, timestamp])
  @@index([timestamp])
}

// ============================================================================
// FRAUD DETECTION & SECURITY MONITORING
// ============================================================================

model FraudAlert {
  id          String   @id @default(cuid())
  walletId    String
  userId      String
  alertType   String   // UNUSUAL_WITHDRAWAL_AMOUNT, RAPID_TRANSACTIONS, NEW_WALLET_WITHDRAWAL, etc.
  severity    String   // LOW, MEDIUM, HIGH, CRITICAL
  fraudScore  Float    // 0-100 risk score
  description String
  evidence    String   // JSON - Detailed evidence (transaction IDs, IPs, amounts, timestamps, etc.)
  autoFrozen  Boolean  @default(false) // Was wallet auto-frozen due to this alert
  resolved    Boolean  @default(false) // Has admin reviewed and resolved this alert
  resolvedBy  String?  // Admin user ID who resolved the alert
  resolvedAt  DateTime?
  resolution  String?  // Admin notes on resolution
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  wallet Wallet @relation(fields: [walletId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([walletId, createdAt])
  @@index([userId, createdAt])
  @@index([severity, resolved])
  @@index([alertType, createdAt])
  @@index([fraudScore])
  @@map("fraud_alerts")
}

model WithdrawalRequest {
  id                 String    @id @default(cuid())
  walletId           String
  userId             String
  amount             Float
  currency           String    @default("JY") // JY token
  destinationAddress String    // Whitelisted wallet address
  status             String    @default("PENDING") // PENDING, APPROVED, REJECTED, PROCESSED, CANCELLED
  requestedAt        DateTime  @default(now())

  // Admin approval
  reviewedBy  String? // Admin user ID
  reviewedAt  DateTime?
  adminNotes  String? // Admin notes on approval/rejection

  // Processing
  processedAt     DateTime?
  transactionId   String?  @unique // WalletTransaction ID after processing
  transactionHash String? // Blockchain transaction hash (if applicable)

  // Cooldown tracking
  lastWithdrawalAt DateTime? // Timestamp of user's last withdrawal
  cooldownHours    Float? // Hours since last withdrawal

  // Metadata
  ipAddress String?
  userAgent String?
  location  String?
  metadata  String? // JSON

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  wallet      Wallet             @relation(fields: [walletId], references: [id], onDelete: Cascade)
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  transaction WalletTransaction? @relation(fields: [transactionId], references: [id])

  @@index([walletId, status])
  @@index([userId, status])
  @@index([status, requestedAt])
  @@index([reviewedBy, reviewedAt])
  @@map("withdrawal_requests")
}

model WhitelistChange {
  id       String @id @default(cuid())
  userId   String
  walletId String
  address  String // Wallet address being whitelisted/removed
  operation String // ADD or REMOVE
  reason    String? // Optional reason for the change

  // Approval tracking
  requestedBy String // User who requested the change
  approvedBy  String? // Admin who approved (if approval required)
  approvedAt  DateTime?

  // Metadata
  ipAddress String?
  userAgent String?
  metadata  String? // JSON

  // Tracking for annual limit (3 changes per year)
  changeYear  Int // Year of the change (for counting annual limit)
  changeCount Int // Sequential count for this user in this year

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  wallet Wallet @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([userId, changeYear])
  @@index([walletId, operation])
  @@index([operation, createdAt])
  @@map("whitelist_changes")
}
