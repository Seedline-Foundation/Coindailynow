# Data Model: CoinDaily Platform

**Phase**: 1 (Design & Contracts)  
**Date**: 2025-09-21  
**Status**: Complete

## Core Entities

### User Management

#### User
```typescript
interface User {
  id: string;                    // UUID primary key
  email: string;                 // Unique, required
  username: string;              // Unique, required
  password_hash: string;         // Bcrypt hashed
  first_name?: string;
  last_name?: string;
  avatar_url?: string;
  bio?: string;
  location?: string;             // African country/region
  preferred_language: string;    // Default: 'en', supports 15 African languages
  subscription_tier: SubscriptionTier;
  email_verified: boolean;
  phone_verified: boolean;
  two_factor_enabled: boolean;
  created_at: Date;
  updated_at: Date;
  last_login_at?: Date;
  status: UserStatus;            // active, suspended, banned
}

enum SubscriptionTier {
  FREE = 'free',
  PREMIUM = 'premium',
  ENTERPRISE = 'enterprise'
}

enum UserStatus {
  ACTIVE = 'active',
  SUSPENDED = 'suspended',
  BANNED = 'banned',
  PENDING_VERIFICATION = 'pending_verification'
}
```

#### UserProfile
```typescript
interface UserProfile {
  user_id: string;               // Foreign key to User
  trading_experience: string;    // beginner, intermediate, advanced
  investment_portfolio_size: string; // small, medium, large
  preferred_exchanges: string[]; // Array of African exchange preferences
  notification_preferences: NotificationSettings;
  privacy_settings: PrivacySettings;
  content_preferences: ContentPreferences;
  created_at: Date;
  updated_at: Date;
}

interface NotificationSettings {
  email_notifications: boolean;
  push_notifications: boolean;
  sms_notifications: boolean;
  breaking_news_alerts: boolean;
  price_alerts: boolean;
  community_mentions: boolean;
}

interface PrivacySettings {
  profile_visibility: 'public' | 'private' | 'friends';
  show_investment_data: boolean;
  show_trading_activity: boolean;
  allow_message_requests: boolean;
}

interface ContentPreferences {
  categories: string[];          // Preferred content categories
  languages: string[];           // Preferred languages for content
  content_difficulty: 'beginner' | 'intermediate' | 'advanced';
  auto_translate: boolean;
}
```

### Content Management

#### Article
```typescript
interface Article {
  id: string;                    // UUID primary key
  title: string;                 // Required
  slug: string;                  // SEO-friendly URL, unique
  excerpt: string;               // Article summary
  content: string;               // Full article content (Markdown/JSON)
  featured_image_url?: string;
  author_id: string;             // Foreign key to User
  category_id: string;           // Foreign key to Category
  tags: string[];                // Array of tag names
  status: ArticleStatus;
  priority: ArticlePriority;
  is_premium: boolean;           // Paywall flag
  view_count: number;
  like_count: number;
  comment_count: number;
  share_count: number;
  reading_time_minutes: number;  // Estimated reading time
  seo_title?: string;
  seo_description?: string;
  publish_scheduled_at?: Date;
  published_at?: Date;
  created_at: Date;
  updated_at: Date;
  deleted_at?: Date;
}

enum ArticleStatus {
  DRAFT = 'draft',
  PENDING_REVIEW = 'pending_review',
  APPROVED = 'approved',
  PUBLISHED = 'published',
  ARCHIVED = 'archived',
  REJECTED = 'rejected'
}

enum ArticlePriority {
  LOW = 'low',
  NORMAL = 'normal',
  HIGH = 'high',
  BREAKING = 'breaking'
}
```

#### ArticleTranslation
```typescript
interface ArticleTranslation {
  id: string;
  article_id: string;            // Foreign key to Article
  language_code: string;         // ISO 639-1 language code
  title: string;
  excerpt: string;
  content: string;
  translation_status: TranslationStatus;
  ai_generated: boolean;         // Whether generated by AI
  human_reviewed: boolean;       // Whether reviewed by human translator
  translator_id?: string;        // Foreign key to User (human translator)
  quality_score?: number;        // AI quality assessment (0-100)
  created_at: Date;
  updated_at: Date;
}

enum TranslationStatus {
  PENDING = 'pending',
  IN_PROGRESS = 'in_progress',
  COMPLETED = 'completed',
  REVIEWED = 'reviewed',
  REJECTED = 'rejected'
}
```

#### Category
```typescript
interface Category {
  id: string;
  name: string;                  // Display name
  slug: string;                  // URL-friendly name
  description?: string;
  parent_id?: string;            // Self-referencing for subcategories
  icon_url?: string;
  color_hex?: string;            // Category color for UI
  sort_order: number;
  is_active: boolean;
  article_count: number;         // Cached count
  created_at: Date;
  updated_at: Date;
}
```

#### Tag
```typescript
interface Tag {
  id: string;
  name: string;                  // Unique tag name
  slug: string;                  // URL-friendly version
  description?: string;
  usage_count: number;           // How many articles use this tag
  trending_score: number;        // Calculated trending score
  created_at: Date;
  updated_at: Date;
}
```

### Cryptocurrency Data

#### Token
```typescript
interface Token {
  id: string;
  symbol: string;                // e.g., "BTC", "ETH"
  name: string;                  // e.g., "Bitcoin", "Ethereum"
  slug: string;                  // e.g., "bitcoin", "ethereum"
  description?: string;
  logo_url?: string;
  website_url?: string;
  whitepaper_url?: string;
  blockchain: string;            // e.g., "Ethereum", "Binance Smart Chain"
  contract_address?: string;     // For ERC-20 tokens
  token_type: TokenType;
  market_cap?: number;
  circulating_supply?: number;
  total_supply?: number;
  max_supply?: number;
  is_memecoin: boolean;
  is_listed: boolean;            // Whether allowed on platform
  listing_status: ListingStatus;
  created_at: Date;
  updated_at: Date;
}

enum TokenType {
  CRYPTOCURRENCY = 'cryptocurrency',
  MEMECOIN = 'memecoin',
  UTILITY_TOKEN = 'utility_token',
  SECURITY_TOKEN = 'security_token',
  STABLECOIN = 'stablecoin'
}

enum ListingStatus {
  APPROVED = 'approved',
  PENDING_REVIEW = 'pending_review',
  REJECTED = 'rejected',
  DELISTED = 'delisted'
}
```

#### MarketData
```typescript
interface MarketData {
  id: string;
  token_id: string;              // Foreign key to Token
  exchange: string;              // Exchange name
  price_usd: number;
  price_change_24h: number;      // Percentage change
  volume_24h: number;
  market_cap: number;
  timestamp: Date;
  high_24h: number;
  low_24h: number;
  trading_pairs: string[];       // e.g., ["BTC/USDT", "BTC/BUSD"]
}
```

#### ExchangeIntegration
```typescript
interface ExchangeIntegration {
  id: string;
  name: string;                  // e.g., "Binance Africa", "Luno"
  slug: string;
  api_endpoint: string;
  websocket_endpoint?: string;
  region: string;                // African region focus
  supported_countries: string[]; // ISO country codes
  api_key_encrypted?: string;    // Encrypted API credentials
  is_active: boolean;
  rate_limit_per_minute: number;
  last_sync_at?: Date;
  created_at: Date;
  updated_at: Date;
}
```

### Community Features

#### CommunityPost
```typescript
interface CommunityPost {
  id: string;
  author_id: string;             // Foreign key to User
  title?: string;                // Optional for short posts
  content: string;               // Post content (Markdown)
  post_type: PostType;
  parent_id?: string;            // For replies/comments
  token_mentions: string[];      // Array of mentioned token symbols
  media_urls: string[];          // Array of image/video URLs
  upvote_count: number;
  downvote_count: number;
  comment_count: number;
  share_count: number;
  is_pinned: boolean;
  is_locked: boolean;
  moderation_status: ModerationStatus;
  violation_reason?: string;
  penalty_applied?: PenaltyType;
  created_at: Date;
  updated_at: Date;
  deleted_at?: Date;
}

enum PostType {
  TEXT = 'text',
  LINK = 'link',
  IMAGE = 'image',
  VIDEO = 'video',
  POLL = 'poll'
}

enum ModerationStatus {
  APPROVED = 'approved',
  PENDING = 'pending',
  FLAGGED = 'flagged',
  SHADOW_BANNED = 'shadow_banned',
  REMOVED = 'removed'
}

enum PenaltyType {
  WARNING = 'warning',
  SHADOW_BAN = 'shadow_ban',
  TEMPORARY_BAN = 'temporary_ban',
  PERMANENT_BAN = 'permanent_ban'
}
```

#### Vote
```typescript
interface Vote {
  id: string;
  user_id: string;               // Foreign key to User
  post_id: string;               // Foreign key to CommunityPost
  vote_type: 'upvote' | 'downvote';
  created_at: Date;
}

// Composite unique constraint on (user_id, post_id)
```

### AI System

#### AIAgent
```typescript
interface AIAgent {
  id: string;
  name: string;                  // e.g., "Market Analysis Agent"
  type: AgentType;
  model_provider: string;        // e.g., "openai", "google", "meta"
  model_name: string;            // e.g., "gpt-4-turbo", "gemini-pro"
  configuration: Record<string, any>; // JSON configuration
  is_active: boolean;
  performance_metrics: AgentMetrics;
  created_at: Date;
  updated_at: Date;
}

enum AgentType {
  CONTENT_GENERATION = 'content_generation',
  MARKET_ANALYSIS = 'market_analysis',
  SENTIMENT_ANALYSIS = 'sentiment_analysis',
  TRANSLATION = 'translation',
  IMAGE_GENERATION = 'image_generation',
  MODERATION = 'moderation',
  QUALITY_REVIEW = 'quality_review'
}

interface AgentMetrics {
  total_requests: number;
  successful_requests: number;
  average_response_time_ms: number;
  quality_score: number;
  cost_per_request: number;
  last_performance_check: Date;
}
```

#### AITask
```typescript
interface AITask {
  id: string;
  agent_id: string;              // Foreign key to AIAgent
  task_type: string;             // Specific task within agent type
  input_data: Record<string, any>; // JSON input
  output_data?: Record<string, any>; // JSON output
  status: TaskStatus;
  priority: TaskPriority;
  estimated_cost: number;
  actual_cost?: number;
  processing_time_ms?: number;
  quality_score?: number;
  error_message?: string;
  retry_count: number;
  max_retries: number;
  scheduled_at?: Date;
  started_at?: Date;
  completed_at?: Date;
  created_at: Date;
}

enum TaskStatus {
  QUEUED = 'queued',
  PROCESSING = 'processing',
  COMPLETED = 'completed',
  FAILED = 'failed',
  CANCELLED = 'cancelled'
}

enum TaskPriority {
  LOW = 'low',
  NORMAL = 'normal',
  HIGH = 'high',
  URGENT = 'urgent'
}
```

### Analytics & Engagement

#### UserEngagement
```typescript
interface UserEngagement {
  id: string;
  user_id: string;               // Foreign key to User
  article_id?: string;           // Foreign key to Article
  post_id?: string;              // Foreign key to CommunityPost
  action_type: EngagementAction;
  duration_seconds?: number;     // For reading time tracking
  scroll_percentage?: number;    // How much of content was viewed
  device_type: string;           // mobile, desktop, tablet
  user_agent: string;
  ip_address: string;            // For analytics, anonymized
  referrer_url?: string;
  created_at: Date;
}

enum EngagementAction {
  VIEW = 'view',
  LIKE = 'like',
  SHARE = 'share',
  COMMENT = 'comment',
  BOOKMARK = 'bookmark',
  SUBSCRIBE = 'subscribe',
  DOWNLOAD = 'download'
}
```

#### ContentPerformance
```typescript
interface ContentPerformance {
  id: string;
  content_id: string;            // Article or Post ID
  content_type: 'article' | 'post';
  date: Date;                    // Daily aggregation
  views: number;
  unique_views: number;
  likes: number;
  shares: number;
  comments: number;
  reading_time_avg: number;      // Average reading time in seconds
  bounce_rate: number;           // Percentage who left quickly
  conversion_rate: number;       // Subscription conversions from this content
  revenue_generated: number;     // For premium content
}
```

### Subscription & Monetization

#### Subscription
```typescript
interface Subscription {
  id: string;
  user_id: string;               // Foreign key to User
  plan_id: string;               // Foreign key to SubscriptionPlan
  status: SubscriptionStatus;
  current_period_start: Date;
  current_period_end: Date;
  trial_end?: Date;
  cancel_at_period_end: boolean;
  cancelled_at?: Date;
  stripe_subscription_id?: string;
  created_at: Date;
  updated_at: Date;
}

enum SubscriptionStatus {
  ACTIVE = 'active',
  CANCELLED = 'cancelled',
  PAST_DUE = 'past_due',
  INCOMPLETE = 'incomplete',
  TRIALING = 'trialing'
}
```

#### SubscriptionPlan
```typescript
interface SubscriptionPlan {
  id: string;
  name: string;                  // e.g., "Premium Monthly"
  description: string;
  price_cents: number;           // Price in cents USD
  currency: string;              // Default: "USD"
  billing_interval: 'month' | 'year';
  trial_period_days: number;
  features: string[];            // Array of feature descriptions
  is_active: boolean;
  sort_order: number;
  stripe_price_id?: string;
  created_at: Date;
  updated_at: Date;
}
```

## Relationships

### Primary Relationships
- User has many Articles (author)
- User has one UserProfile
- User has many CommunityPosts
- User has many Votes
- User has many UserEngagements
- User has one Subscription

- Article belongs to Category
- Article has many ArticleTranslations
- Article has many Tags (many-to-many)
- Article has many UserEngagements

- Token has many MarketData records
- CommunityPost can mention many Tokens

- AIAgent has many AITasks
- AITask belongs to AIAgent

### Indexes for Performance
```sql
-- User queries
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_subscription_tier ON users(subscription_tier);

-- Article queries
CREATE INDEX idx_articles_status_published ON articles(status, published_at);
CREATE INDEX idx_articles_category_published ON articles(category_id, published_at);
CREATE INDEX idx_articles_author_status ON articles(author_id, status);
CREATE INDEX idx_articles_is_premium ON articles(is_premium);

-- Market data queries
CREATE INDEX idx_market_data_token_timestamp ON market_data(token_id, timestamp);
CREATE INDEX idx_market_data_exchange_timestamp ON market_data(exchange, timestamp);

-- Community posts
CREATE INDEX idx_community_posts_author_created ON community_posts(author_id, created_at);
CREATE INDEX idx_community_posts_status_created ON community_posts(moderation_status, created_at);

-- AI tasks
CREATE INDEX idx_ai_tasks_agent_status ON ai_tasks(agent_id, status);
CREATE INDEX idx_ai_tasks_priority_created ON ai_tasks(priority, created_at);

-- Engagement tracking
CREATE INDEX idx_user_engagement_user_created ON user_engagement(user_id, created_at);
CREATE INDEX idx_user_engagement_content ON user_engagement(article_id, action_type);
```

## Data Validation Rules

### User Data
- Email must be valid email format
- Username must be 3-50 characters, alphanumeric plus underscore
- Password must meet complexity requirements (handled at application layer)
- Phone numbers must be valid international format

### Content Data
- Article titles must be 10-200 characters
- Slugs must be unique and URL-safe
- Content must not be empty for published articles
- Tags must be 2-50 characters each

### Financial Data
- Prices must be positive numbers
- Market cap calculations must be consistent
- Subscription prices must be in valid currency format

### Community Data
- Posts must not mention unlisted tokens
- Content must pass AI moderation checks
- User penalties must follow escalation rules

This data model supports all the functional requirements while maintaining data integrity, performance, and scalability for the African cryptocurrency news platform.